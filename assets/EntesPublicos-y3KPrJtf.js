import{j as t}from"./index-Cd8XIyZm.js";import{b as n}from"./vendor-DEA9Ikep.js";import{u as V,a as G,b as q,c as H,B as v}from"./Button-BNeHdZ8F.js";import{D as J}from"./DataTable-BqJ8iuZr.js";import{M as U}from"./Modal-BCn8lzlD.js";import{I as o}from"./Input-CLsDV4a8.js";import{S}from"./Select-DacXmymb.js";import{B as M}from"./Badge-CAgi_6r3.js";import{C as W}from"./ConfirmDialog-f9v0CfLD.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const p="ente_publico",P=[{value:"federal",label:"Federal"},{value:"estatal",label:"Estatal"},{value:"municipal",label:"Municipal"}],T=[{value:"ejecutivo",label:"Poder Ejecutivo"},{value:"legislativo",label:"Poder Legislativo"},{value:"judicial",label:"Poder Judicial"},{value:"autonomo",label:"Organo Autonomo"},{value:"paraestatal",label:"Paraestatal"},{value:"municipio",label:"Municipio"},{value:"alcaldia",label:"Alcaldia"}],X=Object.fromEntries(P.map(a=>[a.value,a.label])),Y=Object.fromEntries(T.map(a=>[a.value,a.label])),C={clave:"",nombre:"",nombre_corto:"",nivel_gobierno:"",tipo_ente:"",entidad_federativa:"",municipio:"",rfc:"",domicilio:"",titular:"",activo:!0},$=[{key:"clave",label:"Clave",width:"120px"},{key:"nombre",label:"Nombre"},{key:"nivel_gobierno",label:"Nivel de Gobierno",width:"160px",render:a=>{const b={federal:"primary",estatal:"info",municipal:"warning"};return t.jsx(M,{variant:b[a]||"default",children:X[a]||a||"--"})}},{key:"tipo_ente",label:"Tipo de Ente",width:"170px",render:a=>Y[a]||a||"--"},{key:"entidad_federativa",label:"Entidad Federativa",width:"180px"},{key:"activo",label:"Estado",width:"100px",render:a=>t.jsx(M,{variant:a?"success":"danger",children:a?"Activo":"Inactivo"})}];function se(){const{data:a=[],isLoading:b}=V(p),g=G(p),x=q(p),y=H(p),[O,h]=n.useState(!1),[r,f]=n.useState(null),[i,d]=n.useState(C),[s,c]=n.useState({}),[A,j]=n.useState(!1),[m,_]=n.useState(null),D=()=>{f(null),d({...C}),c({}),h(!0)},L=e=>{f(e),d({clave:e.clave??"",nombre:e.nombre??"",nombre_corto:e.nombre_corto??"",nivel_gobierno:e.nivel_gobierno??"",tipo_ente:e.tipo_ente??"",entidad_federativa:e.entidad_federativa??"",municipio:e.municipio??"",rfc:e.rfc??"",domicilio:e.domicilio??"",titular:e.titular??"",activo:e.activo??!0}),c({}),h(!0)},E=()=>{h(!1),f(null),d(C),c({})},l=(e,u)=>{d(N=>({...N,[e]:u})),s[e]&&c(N=>{const k={...N};return delete k[e],k})},B=()=>{const e={};return i.clave.trim()||(e.clave="La clave es requerida"),i.nombre.trim()||(e.nombre="El nombre es requerido"),i.nivel_gobierno||(e.nivel_gobierno="Seleccione un nivel de gobierno"),i.tipo_ente||(e.tipo_ente="Seleccione un tipo de ente"),c(e),Object.keys(e).length===0},F=async e=>{if(e.preventDefault(),!B())return;const u={clave:i.clave.trim(),nombre:i.nombre.trim(),nombre_corto:i.nombre_corto.trim()||null,nivel_gobierno:i.nivel_gobierno,tipo_ente:i.tipo_ente,entidad_federativa:i.entidad_federativa.trim()||null,municipio:i.nivel_gobierno==="municipal"&&i.municipio.trim()||null,rfc:i.rfc.trim()||null,domicilio:i.domicilio.trim()||null,titular:i.titular.trim()||null,activo:i.activo};try{r?await x.mutateAsync({id:r.id,...u}):await g.mutateAsync(u),E()}catch{}},R=e=>{_(e),j(!0)},I=async()=>{if(m)try{await y.mutateAsync(m.id),j(!1),_(null)}catch{}},z=()=>{j(!1),_(null)},w=g.isPending||x.isPending;return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Entes Publicos"}),t.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Administracion del catalogo de entes publicos del sistema"})]}),t.jsxs(v,{onClick:D,children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Nuevo Ente"]})]}),t.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:b?t.jsxs("div",{className:"flex items-center justify-center py-16",children:[t.jsxs("svg",{className:"animate-spin h-6 w-6 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t.jsx("span",{className:"ml-3 text-sm text-text-muted",children:"Cargando entes publicos..."})]}):t.jsx(J,{columns:$,data:a,onRowClick:L})}),t.jsx(U,{open:O,onClose:E,title:r?"Editar Ente Publico":"Nuevo Ente Publico",size:"lg",children:t.jsxs("form",{onSubmit:F,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(o,{label:"Clave *",placeholder:"Ej. MUN-001",value:i.clave,onChange:e=>l("clave",e.target.value),error:s.clave}),t.jsx("div",{className:"md:col-span-2",children:t.jsx(o,{label:"Nombre completo *",placeholder:"Nombre oficial del ente publico",value:i.nombre,onChange:e=>l("nombre",e.target.value),error:s.nombre})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(o,{label:"Nombre corto",placeholder:"Nombre abreviado",value:i.nombre_corto,onChange:e=>l("nombre_corto",e.target.value)}),t.jsx(o,{label:"RFC",placeholder:"RFC del ente publico",value:i.rfc,onChange:e=>l("rfc",e.target.value)})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(S,{label:"Nivel de Gobierno *",placeholder:"Seleccionar nivel...",options:P,value:i.nivel_gobierno,onChange:e=>l("nivel_gobierno",e.target.value),error:s.nivel_gobierno}),t.jsx(S,{label:"Tipo de Ente *",placeholder:"Seleccionar tipo...",options:T,value:i.tipo_ente,onChange:e=>l("tipo_ente",e.target.value),error:s.tipo_ente})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(o,{label:"Entidad Federativa",placeholder:"Ej. Jalisco, CDMX...",value:i.entidad_federativa,onChange:e=>l("entidad_federativa",e.target.value)}),i.nivel_gobierno==="municipal"&&t.jsx(o,{label:"Municipio",placeholder:"Nombre del municipio",value:i.municipio,onChange:e=>l("municipio",e.target.value)})]}),t.jsx(o,{label:"Titular",placeholder:"Nombre del titular del ente publico",value:i.titular,onChange:e=>l("titular",e.target.value)}),t.jsxs("div",{className:"w-full",children:[t.jsx("label",{htmlFor:"domicilio",className:"block text-sm font-medium text-text-secondary mb-1",children:"Domicilio"}),t.jsx("textarea",{id:"domicilio",rows:3,placeholder:"Direccion completa del ente publico",value:i.domicilio,onChange:e=>l("domicilio",e.target.value),className:"block w-full rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 py-2.5 placeholder:text-text-muted transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-bg-hover resize-none"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{id:"activo",type:"checkbox",checked:i.activo,onChange:e=>l("activo",e.target.checked),className:"h-4 w-4 rounded border-border text-primary focus:ring-primary/30 cursor-pointer"}),t.jsx("label",{htmlFor:"activo",className:"text-sm font-medium text-text-secondary cursor-pointer select-none",children:"Ente publico activo"})]}),(g.isError||x.isError)&&t.jsx("div",{className:"p-3 rounded-lg border border-danger/30 bg-danger/5 text-sm text-danger",children:"Ocurrio un error al guardar. Por favor intente de nuevo."}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[t.jsx("div",{children:r&&t.jsx(v,{variant:"danger",type:"button",size:"sm",onClick:()=>R(r),children:"Eliminar"})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(v,{variant:"ghost",type:"button",onClick:E,disabled:w,children:"Cancelar"}),t.jsx(v,{type:"submit",loading:w,children:r?"Guardar Cambios":"Crear Ente"})]})]})]})}),t.jsx(W,{open:A,onClose:z,onConfirm:I,title:"Eliminar Ente Publico",message:m?`Esta seguro de eliminar el ente publico "${m.nombre}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger",loading:y.isPending})]})}export{se as default};
