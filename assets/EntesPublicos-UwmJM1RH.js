import{s as N,j as o}from"./index-CyKkzz21.js";import{b}from"./vendor-DEA9Ikep.js";import{u as H,a as J,b as q,c as $}from"./useCrud-bUfgzWCS.js";import{D as U}from"./DataTable-DfIEqyJf.js";import{M as W}from"./Modal-CR5BegYj.js";import{B as j}from"./Button-BA780zlq.js";import{I as p}from"./Input-CofDiIdZ.js";import{S as z}from"./Select-B7MIUx36.js";import{B as w}from"./Badge-BiItYtys.js";import{C as X}from"./ConfirmDialog-DPG7zYiO.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const I=[{codigo:"1",nombre:"Activo",nivel:1,tipo:"activo",nat:"deudora"},{codigo:"1.1",nombre:"Activo Circulante",nivel:2,tipo:"activo",nat:"deudora"},{codigo:"1.1.1",nombre:"Efectivo y Equivalentes",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.1.2",nombre:"Derechos a Recibir Efectivo o Equivalentes",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.1.3",nombre:"Derechos a Recibir Bienes o Servicios",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.1.4",nombre:"Inventarios",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.1.5",nombre:"Almacenes",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.1.6",nombre:"Estimaciones y Provisiones",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.1.7",nombre:"Otros Activos Circulantes",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2",nombre:"Activo No Circulante",nivel:2,tipo:"activo",nat:"deudora"},{codigo:"1.2.1",nombre:"Inversiones Financieras a Largo Plazo",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.2",nombre:"Derechos a Recibir Efectivo o Equivalentes a Largo Plazo",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.3",nombre:"Bienes Inmuebles, Infraestructura y Construcciones en Proceso",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.4",nombre:"Bienes Muebles",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.5",nombre:"Activos Intangibles",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.6",nombre:"Depreciacion, Deterioro y Amortizacion Acumulada de Bienes",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.7",nombre:"Activos Diferidos",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.8",nombre:"Estimaciones y Provisiones a Largo Plazo",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"1.2.9",nombre:"Otros Activos No Circulantes",nivel:3,tipo:"activo",nat:"deudora"},{codigo:"2",nombre:"Pasivo",nivel:1,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1",nombre:"Pasivo Circulante",nivel:2,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.1",nombre:"Cuentas por Pagar a Corto Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.2",nombre:"Documentos por Pagar a Corto Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.3",nombre:"Porcion a Corto Plazo de la Deuda Publica a Largo Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.4",nombre:"Titulos y Valores a Corto Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.5",nombre:"Pasivos Diferidos a Corto Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.6",nombre:"Fondos y Bienes de Terceros en Garantia y/o Administracion a Corto Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.7",nombre:"Provisiones a Corto Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.1.9",nombre:"Otros Pasivos a Corto Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.2",nombre:"Pasivo No Circulante",nivel:2,tipo:"pasivo",nat:"acreedora"},{codigo:"2.2.1",nombre:"Cuentas por Pagar a Largo Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.2.2",nombre:"Documentos por Pagar a Largo Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.2.3",nombre:"Deuda Publica a Largo Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.2.4",nombre:"Pasivos Diferidos a Largo Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.2.5",nombre:"Fondos y Bienes de Terceros en Garantia y/o Administracion a Largo Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"2.2.6",nombre:"Provisiones a Largo Plazo",nivel:3,tipo:"pasivo",nat:"acreedora"},{codigo:"3",nombre:"Hacienda Publica Contribuida",nivel:1,tipo:"hacienda",nat:"acreedora"},{codigo:"3.1",nombre:"Hacienda Publica Contribuida",nivel:2,tipo:"hacienda",nat:"acreedora"},{codigo:"3.1.1",nombre:"Contribuciones de Capital",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.1.2",nombre:"Donaciones de Capital",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.1.3",nombre:"Actualizacion de la Hacienda Publica",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.2",nombre:"Hacienda Publica Generada",nivel:2,tipo:"hacienda",nat:"acreedora"},{codigo:"3.2.1",nombre:"Resultados del Ejercicio (Ahorro/Desahorro)",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.2.2",nombre:"Resultados de Ejercicios Anteriores",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.2.3",nombre:"Revaluos",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.2.4",nombre:"Reservas",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.2.5",nombre:"Rectificaciones de Resultados de Ejercicios Anteriores",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.3",nombre:"Exceso o Insuficiencia en la Actualizacion de la Hacienda Publica",nivel:2,tipo:"hacienda",nat:"acreedora"},{codigo:"3.3.1",nombre:"Resultado por Posicion Monetaria",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"3.3.2",nombre:"Resultado por Tenencia de Activos No Monetarios",nivel:3,tipo:"hacienda",nat:"acreedora"},{codigo:"4",nombre:"Ingresos y Otros Beneficios",nivel:1,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1",nombre:"Ingresos de Gestion",nivel:2,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.1",nombre:"Impuestos",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.2",nombre:"Cuotas y Aportaciones de Seguridad Social",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.3",nombre:"Contribuciones de Mejoras",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.4",nombre:"Derechos",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.5",nombre:"Productos de Tipo Corriente",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.6",nombre:"Aprovechamientos de Tipo Corriente",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.7",nombre:"Ingresos por Venta de Bienes, Prestacion de Servicios y Otros Ingresos",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.1.9",nombre:"Ingresos No Comprendidos en las Fracciones de la Ley de Ingresos",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.2",nombre:"Participaciones, Aportaciones, Transferencias, Asignaciones, Subsidios y Otras Ayudas",nivel:2,tipo:"ingresos",nat:"acreedora"},{codigo:"4.2.1",nombre:"Participaciones y Aportaciones",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.2.2",nombre:"Transferencias, Asignaciones, Subsidios y Subvenciones, y Pensiones y Jubilaciones",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.2.3",nombre:"Transferencias del Fondo Mexicano del Petroleo",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.3",nombre:"Otros Ingresos y Beneficios",nivel:2,tipo:"ingresos",nat:"acreedora"},{codigo:"4.3.1",nombre:"Ingresos Financieros",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.3.2",nombre:"Incremento por Variacion de Inventarios",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.3.3",nombre:"Disminucion del Exceso de Estimaciones por Perdida o Deterioro u Obsolescencia",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.3.4",nombre:"Disminucion del Exceso de Provisiones",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.3.5",nombre:"Otros Ingresos y Beneficios Varios",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"4.3.9",nombre:"Otros Ingresos Contables No Presupuestarios",nivel:3,tipo:"ingresos",nat:"acreedora"},{codigo:"5",nombre:"Gastos y Otras Perdidas",nivel:1,tipo:"gastos",nat:"deudora"},{codigo:"5.1",nombre:"Gastos de Funcionamiento",nivel:2,tipo:"gastos",nat:"deudora"},{codigo:"5.1.1",nombre:"Servicios Personales",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.1.2",nombre:"Materiales y Suministros",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.1.3",nombre:"Servicios Generales",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2",nombre:"Transferencias, Asignaciones, Subsidios y Otras Ayudas",nivel:2,tipo:"gastos",nat:"deudora"},{codigo:"5.2.1",nombre:"Transferencias Internas y Asignaciones al Sector Publico",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.2",nombre:"Transferencias al Resto del Sector Publico",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.3",nombre:"Subsidios y Subvenciones",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.4",nombre:"Ayudas Sociales",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.5",nombre:"Pensiones y Jubilaciones",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.6",nombre:"Transferencias a Fideicomisos, Mandatos y Contratos Analogos",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.7",nombre:"Transferencias a la Seguridad Social",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.8",nombre:"Donativos",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.2.9",nombre:"Transferencias al Exterior",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.3",nombre:"Participaciones y Aportaciones",nivel:2,tipo:"gastos",nat:"deudora"},{codigo:"5.3.1",nombre:"Participaciones de la Federacion a Entidades Federativas y Municipios",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.3.2",nombre:"Aportaciones de la Federacion a Entidades Federativas y Municipios",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.3.3",nombre:"Participaciones de las Entidades Federativas a los Municipios",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.4",nombre:"Intereses, Comisiones y Otros Gastos de la Deuda Publica",nivel:2,tipo:"gastos",nat:"deudora"},{codigo:"5.4.1",nombre:"Intereses de la Deuda Publica",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.4.2",nombre:"Comisiones de la Deuda Publica",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.4.3",nombre:"Gastos de la Deuda Publica",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.4.4",nombre:"Costo por Coberturas",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.4.5",nombre:"Apoyos Financieros",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.5",nombre:"Otros Gastos y Perdidas Extraordinarias",nivel:2,tipo:"gastos",nat:"deudora"},{codigo:"5.5.1",nombre:"Estimaciones, Depreciaciones, Deterioros, Obsolescencias y Amortizaciones",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.5.2",nombre:"Provisiones",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.5.3",nombre:"Disminucion de Inventarios",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.5.4",nombre:"Aumento por Insuficiencia de Estimaciones por Perdida o Deterioro u Obsolescencia",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.5.5",nombre:"Aumento por Insuficiencia de Provisiones",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"5.5.9",nombre:"Otros Gastos",nivel:3,tipo:"gastos",nat:"deudora"},{codigo:"6",nombre:"Cuentas de Cierre Contable",nivel:1,tipo:"cierre",nat:"deudora"},{codigo:"6.1",nombre:"Resumen de Ingresos y Gastos",nivel:2,tipo:"cierre",nat:"deudora"},{codigo:"6.1.1",nombre:"Resumen de Ingresos",nivel:3,tipo:"cierre",nat:"acreedora"},{codigo:"6.1.2",nombre:"Resumen de Gastos",nivel:3,tipo:"cierre",nat:"deudora"},{codigo:"6.2",nombre:"Ahorro de la Gestion",nivel:2,tipo:"cierre",nat:"acreedora"},{codigo:"6.2.1",nombre:"Ahorro de la Gestion",nivel:3,tipo:"cierre",nat:"acreedora"},{codigo:"6.3",nombre:"Desahorro de la Gestion",nivel:2,tipo:"cierre",nat:"deudora"},{codigo:"6.3.1",nombre:"Desahorro de la Gestion",nivel:3,tipo:"cierre",nat:"deudora"},{codigo:"7",nombre:"Cuentas de Orden Contables",nivel:1,tipo:"orden_contable",nat:"deudora"},{codigo:"7.1",nombre:"Valores",nivel:2,tipo:"orden_contable",nat:"deudora"},{codigo:"7.1.1",nombre:"Valores en Custodia",nivel:3,tipo:"orden_contable",nat:"deudora"},{codigo:"7.1.2",nombre:"Custodia de Valores",nivel:3,tipo:"orden_contable",nat:"acreedora"},{codigo:"7.2",nombre:"Emprestitos y Deuda Publica",nivel:2,tipo:"orden_contable",nat:"deudora"},{codigo:"7.2.1",nombre:"Autorizacion de Emprestitos y Deuda Publica",nivel:3,tipo:"orden_contable",nat:"deudora"},{codigo:"7.2.2",nombre:"Contratos de Emprestitos y Deuda Publica",nivel:3,tipo:"orden_contable",nat:"acreedora"},{codigo:"7.3",nombre:"Avales y Garantias",nivel:2,tipo:"orden_contable",nat:"deudora"},{codigo:"7.3.1",nombre:"Avales Autorizados",nivel:3,tipo:"orden_contable",nat:"deudora"},{codigo:"7.3.2",nombre:"Avales Firmados",nivel:3,tipo:"orden_contable",nat:"acreedora"},{codigo:"7.3.3",nombre:"Fianzas y Garantias Recibidas",nivel:3,tipo:"orden_contable",nat:"deudora"},{codigo:"7.3.4",nombre:"Fianzas y Garantias Otorgadas",nivel:3,tipo:"orden_contable",nat:"acreedora"},{codigo:"7.4",nombre:"Juicios",nivel:2,tipo:"orden_contable",nat:"deudora"},{codigo:"7.4.1",nombre:"Demandas Judiciales en Proceso de Resolucion",nivel:3,tipo:"orden_contable",nat:"deudora"},{codigo:"7.4.2",nombre:"Resolucion de Demandas en Proceso Judicial",nivel:3,tipo:"orden_contable",nat:"acreedora"},{codigo:"7.5",nombre:"Bienes en Concesion o Comodato",nivel:2,tipo:"orden_contable",nat:"deudora"},{codigo:"7.5.1",nombre:"Bienes Bajo Contrato en Concesion",nivel:3,tipo:"orden_contable",nat:"deudora"},{codigo:"7.5.2",nombre:"Contrato de Concesion por Bienes",nivel:3,tipo:"orden_contable",nat:"acreedora"},{codigo:"7.5.3",nombre:"Bienes Bajo Contrato en Comodato",nivel:3,tipo:"orden_contable",nat:"deudora"},{codigo:"7.5.4",nombre:"Contrato de Comodato por Bienes",nivel:3,tipo:"orden_contable",nat:"acreedora"},{codigo:"8",nombre:"Cuentas de Orden Presupuestarias",nivel:1,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.1",nombre:"Ley de Ingresos",nivel:2,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.1.1",nombre:"Ley de Ingresos Estimada",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.1.2",nombre:"Ley de Ingresos por Ejecutar",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.1.3",nombre:"Modificaciones a la Ley de Ingresos Estimada",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.1.4",nombre:"Ley de Ingresos Devengada",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.1.5",nombre:"Ley de Ingresos Recaudada",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2",nombre:"Presupuesto de Egresos",nivel:2,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2.1",nombre:"Presupuesto de Egresos Aprobado",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2.2",nombre:"Presupuesto de Egresos por Ejercer",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2.3",nombre:"Modificaciones al Presupuesto de Egresos Aprobado",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2.4",nombre:"Presupuesto de Egresos Comprometido",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2.5",nombre:"Presupuesto de Egresos Devengado",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2.6",nombre:"Presupuesto de Egresos Ejercido",nivel:3,tipo:"orden_presupuestario",nat:"deudora"},{codigo:"8.2.7",nombre:"Presupuesto de Egresos Pagado",nivel:3,tipo:"orden_presupuestario",nat:"deudora"}];async function Y(n){const d={},h=I.filter(i=>i.nivel===1),f=I.filter(i=>i.nivel===2),P=I.filter(i=>i.nivel===3),D=h.map(i=>({ente_id:n,codigo:i.codigo,nombre:i.nombre,nivel:i.nivel,tipo_cuenta:i.tipo,naturaleza:i.nat,padre_id:null,es_detalle:!1,activo:!0})),{data:m,error:s}=await N.from("plan_de_cuentas").insert(D).select("id, codigo");if(s)throw s;for(const i of m)d[i.codigo]=i.id;const C=f.map(i=>{const t=i.codigo.split(".")[0];return{ente_id:n,codigo:i.codigo,nombre:i.nombre,nivel:i.nivel,tipo_cuenta:i.tipo,naturaleza:i.nat,padre_id:d[t]||null,es_detalle:!1,activo:!0}}),{data:a,error:c}=await N.from("plan_de_cuentas").insert(C).select("id, codigo");if(c)throw c;for(const i of a)d[i.codigo]=i.id;const l=P.map(i=>{const t=i.codigo.split("."),x=`${t[0]}.${t[1]}`;return{ente_id:n,codigo:i.codigo,nombre:i.nombre,nivel:i.nivel,tipo_cuenta:i.tipo,naturaleza:i.nat,padre_id:d[x]||null,es_detalle:!1,activo:!0}}),{data:u,error:_}=await N.from("plan_de_cuentas").insert(l).select("id, codigo");if(_)throw _;return m.length+a.length+u.length}const A="ente_publico",T=[{value:"federal",label:"Federal"},{value:"estatal",label:"Estatal"},{value:"municipal",label:"Municipal"}],L=[{value:"ejecutivo",label:"Poder Ejecutivo"},{value:"legislativo",label:"Poder Legislativo"},{value:"judicial",label:"Poder Judicial"},{value:"autonomo",label:"Organo Autonomo"},{value:"paraestatal",label:"Paraestatal"},{value:"municipio",label:"Municipio"},{value:"alcaldia",label:"Alcaldia"}],K=Object.fromEntries(T.map(n=>[n.value,n.label])),Q=Object.fromEntries(L.map(n=>[n.value,n.label])),S={clave:"",nombre:"",nombre_corto:"",nivel_gobierno:"",tipo_ente:"",entidad_federativa:"",municipio:"",rfc:"",domicilio:"",titular:"",activo:!0},Z=[{key:"clave",label:"Clave",width:"120px"},{key:"nombre",label:"Nombre"},{key:"nivel_gobierno",label:"Nivel de Gobierno",width:"160px",render:n=>{const d={federal:"primary",estatal:"info",municipal:"warning"};return o.jsx(w,{variant:d[n]||"default",children:K[n]||n||"--"})}},{key:"tipo_ente",label:"Tipo de Ente",width:"170px",render:n=>Q[n]||n||"--"},{key:"entidad_federativa",label:"Entidad Federativa",width:"180px"},{key:"activo",label:"Estado",width:"100px",render:n=>o.jsx(w,{variant:n?"success":"danger",children:n?"Activo":"Inactivo"})}];function pe(){const{data:n=[],isLoading:d}=H(A),h=J(A),f=q(A),P=$(A),[D,m]=b.useState(!1),[s,C]=b.useState(null),[a,c]=b.useState(S),[l,u]=b.useState({}),[_,i]=b.useState(!1),[t,x]=b.useState(null),M=()=>{C(null),c({...S}),u({}),m(!0)},R=e=>{C(e),c({clave:e.clave??"",nombre:e.nombre??"",nombre_corto:e.nombre_corto??"",nivel_gobierno:e.nivel_gobierno??"",tipo_ente:e.tipo_ente??"",entidad_federativa:e.entidad_federativa??"",municipio:e.municipio??"",rfc:e.rfc??"",domicilio:e.domicilio??"",titular:e.titular??"",activo:e.activo??!0}),u({}),m(!0)},y=()=>{m(!1),C(null),c(S),u({})},r=(e,E)=>{c(v=>({...v,[e]:E})),l[e]&&u(v=>{const g={...v};return delete g[e],g})},B=()=>{const e={};return a.clave.trim()||(e.clave="La clave es requerida"),a.nombre.trim()||(e.nombre="El nombre es requerido"),a.nivel_gobierno||(e.nivel_gobierno="Seleccione un nivel de gobierno"),a.tipo_ente||(e.tipo_ente="Seleccione un tipo de ente"),u(e),Object.keys(e).length===0},F=async e=>{if(e.preventDefault(),!B())return;const E={clave:a.clave.trim(),nombre:a.nombre.trim(),nombre_corto:a.nombre_corto.trim()||null,nivel_gobierno:a.nivel_gobierno,tipo_ente:a.tipo_ente,entidad_federativa:a.entidad_federativa.trim()||null,municipio:a.nivel_gobierno==="municipal"&&a.municipio.trim()||null,rfc:a.rfc.trim()||null,domicilio:a.domicilio.trim()||null,titular:a.titular.trim()||null,activo:a.activo};try{if(s)await f.mutateAsync({id:s.id,...E});else{const v=await h.mutateAsync(E);try{const g=await Y(v.id);console.log(`Plan de Cuentas CONAC: ${g} cuentas creadas para ente ${v.clave}`)}catch(g){console.error("Error al crear Plan de Cuentas CONAC:",g)}}y()}catch{}},G=e=>{x(e),i(!0)},k=async()=>{if(t)try{await N.from("usuarios").delete().eq("ente_id",t.id),await P.mutateAsync(t.id),i(!1),x(null),y()}catch{}},V=()=>{i(!1),x(null)},O=h.isPending||f.isPending;return o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Entes Publicos"}),o.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Administracion del catalogo de entes publicos del sistema"})]}),o.jsxs(j,{onClick:M,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Nuevo Ente"]})]}),o.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:d?o.jsxs("div",{className:"flex items-center justify-center py-16",children:[o.jsxs("svg",{className:"animate-spin h-6 w-6 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o.jsx("span",{className:"ml-3 text-sm text-text-muted",children:"Cargando entes publicos..."})]}):o.jsx(U,{columns:Z,data:n,onRowClick:R})}),o.jsx(W,{open:D,onClose:y,title:s?"Editar Ente Publico":"Nuevo Ente Publico",size:"lg",children:o.jsxs("form",{onSubmit:F,className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsx(p,{label:"Clave *",placeholder:"Ej. MUN-001",value:a.clave,onChange:e=>r("clave",e.target.value),error:l.clave}),o.jsx("div",{className:"md:col-span-2",children:o.jsx(p,{label:"Nombre completo *",placeholder:"Nombre oficial del ente publico",value:a.nombre,onChange:e=>r("nombre",e.target.value),error:l.nombre})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx(p,{label:"Nombre corto",placeholder:"Nombre abreviado",value:a.nombre_corto,onChange:e=>r("nombre_corto",e.target.value)}),o.jsx(p,{label:"RFC",placeholder:"RFC del ente publico",value:a.rfc,onChange:e=>r("rfc",e.target.value)})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx(z,{label:"Nivel de Gobierno *",placeholder:"Seleccionar nivel...",options:T,value:a.nivel_gobierno,onChange:e=>r("nivel_gobierno",e.target.value),error:l.nivel_gobierno}),o.jsx(z,{label:"Tipo de Ente *",placeholder:"Seleccionar tipo...",options:L,value:a.tipo_ente,onChange:e=>r("tipo_ente",e.target.value),error:l.tipo_ente})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx(p,{label:"Entidad Federativa",placeholder:"Ej. Jalisco, CDMX...",value:a.entidad_federativa,onChange:e=>r("entidad_federativa",e.target.value)}),a.nivel_gobierno==="municipal"&&o.jsx(p,{label:"Municipio",placeholder:"Nombre del municipio",value:a.municipio,onChange:e=>r("municipio",e.target.value)})]}),o.jsx(p,{label:"Titular",placeholder:"Nombre del titular del ente publico",value:a.titular,onChange:e=>r("titular",e.target.value)}),o.jsxs("div",{className:"w-full",children:[o.jsx("label",{htmlFor:"domicilio",className:"block text-sm font-medium text-text-secondary mb-1",children:"Domicilio"}),o.jsx("textarea",{id:"domicilio",rows:3,placeholder:"Direccion completa del ente publico",value:a.domicilio,onChange:e=>r("domicilio",e.target.value),className:"block w-full rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 py-2.5 placeholder:text-text-muted transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-bg-hover resize-none"})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("input",{id:"activo",type:"checkbox",checked:a.activo,onChange:e=>r("activo",e.target.checked),className:"h-4 w-4 rounded border-border text-primary focus:ring-primary/30 cursor-pointer"}),o.jsx("label",{htmlFor:"activo",className:"text-sm font-medium text-text-secondary cursor-pointer select-none",children:"Ente publico activo"})]}),(h.isError||f.isError)&&o.jsx("div",{className:"p-3 rounded-lg border border-danger/30 bg-danger/5 text-sm text-danger",children:"Ocurrio un error al guardar. Por favor intente de nuevo."}),o.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[o.jsx("div",{children:s&&o.jsx(j,{variant:"danger",type:"button",size:"sm",onClick:()=>G(s),children:"Eliminar"})}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(j,{variant:"ghost",type:"button",onClick:y,disabled:O,children:"Cancelar"}),o.jsx(j,{type:"submit",loading:O,children:s?"Guardar Cambios":"Crear Ente"})]})]})]})}),o.jsx(X,{open:_,onClose:V,onConfirm:k,title:"Eliminar Ente Publico",message:t?`Esta seguro de eliminar el ente publico "${t.nombre}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger",loading:P.isPending})]})}export{pe as default};
