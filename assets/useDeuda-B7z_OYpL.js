import{s as a,u as d,o as m}from"./index-w8y8owqO.js";function f(){return{disposiciones:0,amortizaciones:0,pago_intereses:0,comisiones:0}}function l(){return{saldo_total:0,intereses_pagados:0,amortizaciones:0,total_instrumentos:0}}function _(n){const t={};for(const e of n){const o=e.instrumento_id;t[o]||(t[o]=f());const i=Number(e.monto)||0,s=e.tipo;s==="disposicion"?t[o].disposiciones+=i:s==="amortizacion"?t[o].amortizaciones+=i:s==="pago_intereses"?t[o].pago_intereses+=i:s==="comision"&&(t[o].comisiones+=i)}return t}async function p(n,t){const{data:e,error:o}=await a.from("instrumento_deuda").select("*").eq("ente_id",n).eq("ejercicio_id",t).order("clave");if(o)throw o;if(!e.length)return[];const i=e.map(c=>c.id),{data:s,error:r}=await a.from("movimiento_deuda").select("*").in("instrumento_id",i);if(r)throw r;const u=_(s);return e.map(c=>({...c,movimientos_totales:u[c.id]||f()}))}async function g(n){const{data:t,error:e}=await a.from("movimiento_deuda").select("*, instrumento:instrumento_deuda(clave, descripcion)").eq("instrumento_id",n).order("fecha",{ascending:!1});if(e)throw e;return t}async function v(n,t){const{data:e,error:o}=await a.from("instrumento_deuda").select("id, saldo_vigente").eq("ente_id",n).eq("ejercicio_id",t);if(o)throw o;if(!e.length)return l();const i=e.map(u=>u.id),{data:s,error:r}=await a.from("movimiento_deuda").select("tipo, monto").in("instrumento_id",i);if(r)throw r;return y(e,s)}function y(n,t){const e=l();e.total_instrumentos=n.length;for(const o of n)e.saldo_total+=Number(o.saldo_vigente)||0;for(const o of t){const i=Number(o.monto)||0;o.tipo==="pago_intereses"?e.intereses_pagados+=i:o.tipo==="amortizacion"&&(e.amortizaciones+=i)}return e}function q(){const{entePublico:n,ejercicioFiscal:t}=d(),e=n?.id,o=t?.id;return m({queryKey:["instrumentos_deuda",e,o],queryFn:()=>p(e,o),enabled:!!e&&!!o})}function b(n){return m({queryKey:["movimientos_deuda",n],queryFn:()=>g(n),enabled:!!n})}function w(){const{entePublico:n,ejercicioFiscal:t}=d(),e=n?.id,o=t?.id;return m({queryKey:["resumen_deuda",e,o],queryFn:()=>v(e,o),enabled:!!e&&!!o})}export{q as a,b,w as u};
