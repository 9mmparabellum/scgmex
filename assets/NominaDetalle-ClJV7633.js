import{j as t}from"./index-xuYioy8Y.js";import{g as j,c as _,b as p}from"./vendor-DEA9Ikep.js";import{e as y}from"./useNomina-BEiEF0ij.js";import{u as k}from"./useCrud-BZqSYSww.js";import{v as w,u as C}from"./constants-B0qHiDNt.js";import{D}from"./DataTable-CoGr0iSJ.js";import{B as M}from"./Button-CQM7GO5t.js";import{B as m}from"./Badge-DX5pclE5.js";import{e as E}from"./exportHelpers-CvXmrB4L.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const s=r=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(r||0);function R(){const{id:r}=j(),u=_(),{data:l=[],isLoading:x}=y(r),{data:b=[]}=k("nomina_periodo",{filter:{id:r}}),n=b[0]||{},c=p.useMemo(()=>{const o=l.filter(a=>a.concepto?.tipo==="percepcion").reduce((a,i)=>a+Number(i.monto||0),0),e=l.filter(a=>a.concepto?.tipo==="deduccion").reduce((a,i)=>a+Number(i.monto||0),0);return{percepciones:o,deducciones:e,neto:o-e}},[l]),h=[{label:"Total Percepciones",value:s(c.percepciones)},{label:"Total Deducciones",value:s(c.deducciones)},{label:"Neto",value:s(c.neto)}],f=o=>{const e=w[o];return e?t.jsx(m,{variant:e.variant,children:e.label}):t.jsx(m,{variant:"default",children:o})},v=o=>({percepcion:"success",deduccion:"danger"})[o]||"default",d=o=>C[o]||o,g=()=>{E(l,[{key:"numero_empleado",label:"No. Empleado",getValue:e=>e.empleado?.numero_empleado||""},{key:"nombre_empleado",label:"Nombre",getValue:e=>e.empleado?.nombre||""},{key:"clave_concepto",label:"Clave Concepto",getValue:e=>e.concepto?.clave||""},{key:"nombre_concepto",label:"Concepto",getValue:e=>e.concepto?.nombre||""},{key:"tipo_concepto",label:"Tipo",getValue:e=>d(e.concepto?.tipo)},{key:"monto",label:"Monto",getValue:e=>Number(e.monto||0)}],`nomina_detalle_q${n.numero_quincena||r}`)},N=p.useMemo(()=>[{key:"empleado",label:"No. Empleado",width:"120px",render:(o,e)=>e.empleado?.numero_empleado||"—"},{key:"empleado_nombre",label:"Nombre",render:(o,e)=>e.empleado?.nombre||"—"},{key:"concepto_clave",label:"Clave",width:"100px",render:(o,e)=>e.concepto?.clave||"—"},{key:"concepto_nombre",label:"Concepto",render:(o,e)=>e.concepto?.nombre||"—"},{key:"concepto_tipo",label:"Tipo",width:"130px",render:(o,e)=>{const a=e.concepto?.tipo;return a?t.jsx(m,{variant:v(a),children:d(a)}):"—"}},{key:"monto",label:"Monto",width:"150px",render:o=>t.jsx("span",{className:"text-right block tabular-nums",children:s(o)})}],[]);return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>u("/nomina/periodos"),className:"inline-flex items-center justify-center w-9 h-9 rounded-md text-text-secondary hover:bg-bg-hover hover:text-text-heading transition-colors cursor-pointer","aria-label":"Regresar",children:t.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("polyline",{points:"15 18 9 12 15 6"})})}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-xl font-bold text-text-primary",children:["Detalle de Nomina — Quincena ",n.numero_quincena||""]}),t.jsxs("p",{className:"text-sm text-text-muted mt-1",children:[n.fecha_inicio?new Date(n.fecha_inicio).toLocaleDateString("es-MX"):"",n.fecha_inicio&&n.fecha_fin?" al ":"",n.fecha_fin?new Date(n.fecha_fin).toLocaleDateString("es-MX"):"",n.estado&&t.jsx("span",{className:"ml-3 inline-block",children:f(n.estado)})]})]})]}),t.jsx(M,{onClick:g,variant:"outline-primary",size:"sm",children:"Exportar Excel"})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:h.map(o=>t.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[t.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:o.label}),t.jsx("p",{className:"text-lg font-bold text-text-primary",children:o.value})]},o.label))}),t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Detalle",t.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",l.length," registros)"]})]})}),x?t.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando detalle de nomina..."}):t.jsx(D,{columns:N,data:l})]})}export{R as default};
