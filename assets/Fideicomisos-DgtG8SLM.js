import{u as R,j as i}from"./index-hqQh5qHZ.js";import{b as c}from"./vendor-DEA9Ikep.js";import{a as V,b as z,c as U,B as m}from"./Button-51i5jP3H.js";import{c as X}from"./usePatrimonio-DMUIpWf-.js";import{D as q}from"./DataTable-frAvtief.js";import{M as L}from"./Modal-DU0rPhL4.js";import{I as n}from"./Input-Dc-GVsDw.js";import{S as _}from"./Select-CX-mNr7j.js";import{B as k}from"./Badge-Cvt4QuMN.js";import{C as $}from"./ConfirmDialog-CCmfmvN7.js";import{e as G}from"./exportHelpers-CvXmrB4L.js";import{e as H,f as J}from"./constants-B9IYjURH.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const K=u=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(u||0),N={clave:"",nombre:"",tipo:"administracion",mandante:"",fiduciario:"",fideicomisario:"",monto_patrimonio:"",fecha_constitucion:"",fecha_extincion:"",vigencia_anios:"",objeto:"",estado:"vigente"},Q={administracion:"info",inversion:"success",garantia:"warning",traslativo:"info",otro:"default"},W={vigente:"success",en_extincion:"warning",extinto:"danger",suspendido:"default"};function ue(){const{entePublico:u,ejercicioFiscal:F}=R(),[E,l]=c.useState(!1),[d,h]=c.useState(null),[o,p]=c.useState({...N}),[M,x]=c.useState(!1),[r,f]=c.useState(null),{data:g=[],isLoading:S}=X(),b=V("fideicomiso"),v=z("fideicomiso"),j=U("fideicomiso"),O=c.useMemo(()=>Object.entries(H).map(([e,a])=>({value:e,label:a})),[]),D=c.useMemo(()=>Object.entries(J).map(([e,a])=>({value:e,label:a.label})),[]),t=(e,a)=>p(s=>({...s,[e]:a})),I=()=>{h(null),p({...N}),l(!0)},y=e=>{h(e),p({clave:e.clave??"",nombre:e.nombre??"",tipo:e.tipo??"administracion",mandante:e.mandante??"",fiduciario:e.fiduciario??"",fideicomisario:e.fideicomisario??"",monto_patrimonio:e.monto_patrimonio??"",fecha_constitucion:e.fecha_constitucion??"",fecha_extincion:e.fecha_extincion??"",vigencia_anios:e.vigencia_anios??"",objeto:e.objeto??"",estado:e.estado??"vigente"}),l(!0)},P=async()=>{const e={...o,ente_id:u?.id,ejercicio_id:F?.id,monto_patrimonio:Number(o.monto_patrimonio)||0,vigencia_anios:o.vigencia_anios?Number(o.vigencia_anios):null,fecha_extincion:o.fecha_extincion||null};d?await v.mutateAsync({id:d.id,...e}):await b.mutateAsync(e),l(!1)},T=e=>{f(e),x(!0)},w=async()=>{r&&await j.mutateAsync(r.id),x(!1),f(null)},A=()=>{G(g,[{key:"clave",label:"Clave"},{key:"nombre",label:"Nombre"},{key:"tipo",label:"Tipo"},{key:"mandante",label:"Mandante"},{key:"fiduciario",label:"Fiduciario"},{key:"fideicomisario",label:"Fideicomisario"},{key:"monto_patrimonio",label:"Monto Patrimonio"},{key:"fecha_constitucion",label:"Fecha Constitucion"},{key:"fecha_extincion",label:"Fecha Extincion"},{key:"vigencia_anios",label:"Vigencia (anios)"},{key:"estado",label:"Estado"},{key:"objeto",label:"Objeto"}],"fideicomisos_publicos")},B=[{key:"clave",label:"Clave",width:"100px"},{key:"nombre",label:"Nombre"},{key:"tipo",label:"Tipo",width:"130px",render:e=>{const a=Q[e]||"default";return i.jsx(k,{variant:a,children:e?e.charAt(0).toUpperCase()+e.slice(1):"—"})}},{key:"mandante",label:"Mandante",width:"150px"},{key:"fiduciario",label:"Fiduciario",width:"150px"},{key:"monto_patrimonio",label:"Monto",width:"130px",render:e=>i.jsx("span",{className:"block text-right tabular-nums",children:K(e)})},{key:"fecha_constitucion",label:"Fecha Const.",width:"110px",render:e=>e?new Date(e+"T00:00:00").toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"}):"—"},{key:"estado",label:"Estado",width:"120px",render:e=>{const a=W[e]||"default";return i.jsx(k,{variant:a,children:e?e.replace(/_/g," ").replace(/^\w/,s=>s.toUpperCase()):"—"})}},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,a)=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:s=>{s.stopPropagation(),y(a)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),i.jsx("button",{onClick:s=>{s.stopPropagation(),T(a)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],C=b.isPending||v.isPending;return i.jsxs("div",{children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Fideicomisos Publicos"}),i.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Registro y control de fideicomisos del ente publico"})]}),i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Fideicomisos",i.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",g.length," registros)"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(m,{onClick:A,variant:"secondary",size:"sm",children:"Exportar Excel"}),i.jsx(m,{onClick:I,size:"sm",children:"+ Nuevo Fideicomiso"})]})]}),S?i.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando fideicomisos..."}):i.jsx(q,{columns:B,data:g,onRowClick:y}),i.jsx(L,{open:E,onClose:()=>l(!1),title:d?"Editar Fideicomiso":"Nuevo Fideicomiso",size:"lg",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(n,{label:"Clave",value:o.clave,onChange:e=>t("clave",e.target.value),placeholder:"Ej. FID-001",required:!0}),i.jsx(_,{label:"Tipo de Fideicomiso",value:o.tipo,onChange:e=>t("tipo",e.target.value),options:O,placeholder:"— Seleccione tipo —"})]}),i.jsx(n,{label:"Nombre",value:o.nombre,onChange:e=>t("nombre",e.target.value),placeholder:"Nombre del fideicomiso",required:!0}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(n,{label:"Mandante",value:o.mandante,onChange:e=>t("mandante",e.target.value),placeholder:"Mandante / Fideicomitente"}),i.jsx(n,{label:"Fiduciario",value:o.fiduciario,onChange:e=>t("fiduciario",e.target.value),placeholder:"Institucion fiduciaria"}),i.jsx(n,{label:"Fideicomisario",value:o.fideicomisario,onChange:e=>t("fideicomisario",e.target.value),placeholder:"Fideicomisario"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(n,{label:"Monto Patrimonio",type:"number",value:o.monto_patrimonio,onChange:e=>t("monto_patrimonio",e.target.value),placeholder:"0.00"}),i.jsx(n,{label:"Fecha Constitucion",type:"date",value:o.fecha_constitucion,onChange:e=>t("fecha_constitucion",e.target.value)}),i.jsx(n,{label:"Fecha Extincion",type:"date",value:o.fecha_extincion,onChange:e=>t("fecha_extincion",e.target.value)})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(n,{label:"Vigencia (anios)",type:"number",value:o.vigencia_anios,onChange:e=>t("vigencia_anios",e.target.value),placeholder:"Ej. 30"}),i.jsx(_,{label:"Estado",value:o.estado,onChange:e=>t("estado",e.target.value),options:D,placeholder:"— Seleccione estado —"})]}),i.jsxs("div",{className:"w-full",children:[i.jsx("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:"Objeto del Fideicomiso"}),i.jsx("textarea",{value:o.objeto,onChange:e=>t("objeto",e.target.value),placeholder:"Descripcion del objeto y finalidad del fideicomiso",rows:3,className:"w-full h-[40px] min-h-[80px] rounded-md border border-border px-3 py-2 text-[0.9375rem] focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda"})]}),i.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[i.jsx(m,{variant:"ghost",onClick:()=>l(!1),disabled:C,children:"Cancelar"}),i.jsx(m,{onClick:P,loading:C,disabled:!o.clave.trim()||!o.nombre.trim(),children:d?"Guardar cambios":"Crear fideicomiso"})]})]})}),i.jsx($,{open:M,onClose:()=>{x(!1),f(null)},onConfirm:w,title:"Eliminar fideicomiso",message:r?`¿Esta seguro de eliminar el fideicomiso "${r.clave} — ${r.nombre}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:j.isPending})]})}export{ue as default};
