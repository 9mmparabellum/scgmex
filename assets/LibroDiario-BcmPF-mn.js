import{u as N,k as g,j as e}from"./index-CSPrBd4B.js";import{b as m}from"./vendor-DEA9Ikep.js";import{u as _,B as h}from"./Button-D3Vrtg19.js";import{S as k}from"./Select-Ch7OX2yO.js";import{B as v}from"./Badge-BoxAYuIW.js";import{e as w}from"./exportHelpers-CvXmrB4L.js";import{e as C}from"./exportPdfHelpers-A3uAR0yr.js";import{T as l}from"./constants-B9IYjURH.js";import{f as c}from"./polizaHelpers-DSRoDnth.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const n=d=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(d||0);function I(){const{entePublico:d,ejercicioFiscal:p}=N(),[i,b]=m.useState(""),{data:x=[]}=_("periodo_contable",{filter:{ejercicio_id:p?.id},order:{column:"numero",ascending:!0}}),u=m.useMemo(()=>x.map(t=>({value:t.id,label:t.nombre||`Periodo ${t.numero}`})),[x]),{data:s=[],isLoading:f}=g(i),j=()=>{const t=[];s.forEach(a=>{(a.movimiento_contable||a.movimientos||[]).forEach(r=>{t.push({poliza:c(a.tipo,a.numero_poliza),fecha:a.fecha,tipo:l[a.tipo]||a.tipo,cuenta:r.plan_de_cuentas?.codigo||"",nombre_cuenta:r.plan_de_cuentas?.nombre||"",concepto:r.concepto||"",debe:r.debe||0,haber:r.haber||0})})}),w(t,[{key:"poliza",label:"Poliza"},{key:"fecha",label:"Fecha"},{key:"tipo",label:"Tipo"},{key:"cuenta",label:"Cuenta"},{key:"nombre_cuenta",label:"Nombre Cuenta"},{key:"concepto",label:"Concepto"},{key:"debe",label:"Debe"},{key:"haber",label:"Haber"}],"libro_diario")},y=()=>{const t=[];s.forEach(o=>{(o.movimiento_contable||o.movimientos||[]).forEach(a=>{t.push({poliza:c(o.tipo,o.numero_poliza),fecha:o.fecha,tipo:l[o.tipo]||o.tipo,cuenta:a.plan_de_cuentas?.codigo||"",nombre_cuenta:a.plan_de_cuentas?.nombre||"",concepto:a.concepto||"",debe:a.debe||0,haber:a.haber||0})})}),C(t,[{key:"poliza",label:"Poliza"},{key:"fecha",label:"Fecha"},{key:"tipo",label:"Tipo"},{key:"cuenta",label:"Cuenta"},{key:"nombre_cuenta",label:"Nombre Cuenta"},{key:"concepto",label:"Concepto"},{key:"debe",label:"Debe"},{key:"haber",label:"Haber"}],"libro_diario",{title:"Libro Diario"})};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Libro Diario"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 36 — Registro cronologico de polizas aprobadas"})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsx(k,{label:"Periodo",placeholder:"Seleccionar periodo...",options:u,value:i,onChange:t=>b(t.target.value)}),e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end",children:[e.jsxs(h,{variant:"ghost",onClick:j,disabled:!s?.length,children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar XLSX"]}),e.jsxs(h,{variant:"ghost",onClick:y,disabled:!s?.length,children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Exportar PDF"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary mb-4",children:["Libro Diario"," ",e.jsxs("span",{className:"text-text-muted font-normal",children:["(",s.length," polizas)"]})]}),f?e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"Cargando libro diario..."}):i?s.length===0?e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"No hay polizas aprobadas en este periodo"}):e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-[#f9fafb] px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-sm font-semibold text-primary",children:c(t.tipo,t.numero_poliza)}),e.jsx("span",{className:"text-sm text-text-secondary",children:t.descripcion||"—"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-text-muted",children:new Date(t.fecha).toLocaleDateString("es-MX")}),e.jsx(v,{variant:"info",children:l[t.tipo]||t.tipo})]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-xs text-text-muted uppercase",children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Cuenta"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Concepto"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Debe"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Haber"})]})}),e.jsx("tbody",{children:(t.movimiento_contable||t.movimientos||[]).map((o,a)=>e.jsxs("tr",{className:"border-t border-[#f0f0f0]",children:[e.jsxs("td",{className:"px-4 py-2 text-sm",children:[e.jsx("span",{className:"font-mono text-xs text-text-muted",children:o.plan_de_cuentas?.codigo||o.cuenta_codigo||""})," ",o.plan_de_cuentas?.nombre||o.cuenta_nombre||""]}),e.jsx("td",{className:"px-4 py-2 text-sm text-text-secondary",children:o.concepto||"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:o.debe>0?n(o.debe):""}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:o.haber>0?n(o.haber):""})]},a))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t border-border bg-[#f9fafb] font-semibold",children:[e.jsx("td",{colSpan:2,className:"px-4 py-2 text-sm text-right",children:"Totales:"}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:n(t.total_debe)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:n(t.total_haber)})]})})]})]},t.id))}):e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"Seleccione un periodo para ver el libro diario"})]})]})}export{I as default};
