import{s as i,u as d,o as s,p as l,q as f}from"./index-FiQ-o0as.js";async function b(e){const{data:a,error:r}=await i.from("cuenta_bancaria").select("*, cuenta_contable:plan_de_cuentas!cuenta_contable_id(codigo, nombre)").eq("ente_id",e).order("numero_cuenta");if(r)throw r;return a}async function m(e,a){let r=i.from("movimiento_bancario").select("*, poliza:poliza!poliza_id(numero, tipo)").eq("cuenta_bancaria_id",e).order("fecha",{ascending:!1});a&&(r=r.eq("periodo_id",a));const{data:o,error:t}=await r;if(t)throw t;return o}async function p(e,a){const{data:r,error:o}=await i.from("cuenta_por_cobrar").select("*, cuenta_contable:plan_de_cuentas!cuenta_contable_id(codigo, nombre)").eq("ente_id",e).eq("ejercicio_id",a).order("fecha_emision",{ascending:!1});if(o)throw o;return r}async function q(e,a){const{data:r,error:o}=await i.from("cuenta_por_cobrar").select("*").eq("id",e).single();if(o)throw o;const t=Number(r.monto_cobrado)+Number(a),n=Number(r.monto_original)-t,c=n<=0?"cobrada":"parcial",{data:_,error:u}=await i.from("cuenta_por_cobrar").update({monto_cobrado:t,saldo_pendiente:Math.max(0,n),estado:c}).eq("id",e).select().single();if(u)throw u;return _}async function y(e,a){const{data:r,error:o}=await i.from("cuenta_por_pagar").select("*, cuenta_contable:plan_de_cuentas!cuenta_contable_id(codigo, nombre), partida:partida_egreso!partida_egreso_id(clave, descripcion)").eq("ente_id",e).eq("ejercicio_id",a).order("fecha_recepcion",{ascending:!1});if(o)throw o;return r}async function g(e,a){const{data:r,error:o}=await i.from("cuenta_por_pagar").select("*").eq("id",e).single();if(o)throw o;const t=Number(r.monto_pagado)+Number(a),n=Number(r.monto_original)-t,c=n<=0?"pagada":"parcial",{data:_,error:u}=await i.from("cuenta_por_pagar").update({monto_pagado:t,saldo_pendiente:Math.max(0,n),estado:c}).eq("id",e).select().single();if(u)throw u;return _}async function h(e,a,r){let o=i.from("flujo_efectivo").select("*").eq("ente_id",e).eq("ejercicio_id",a).order("categoria").order("concepto");r&&(o=o.eq("periodo_id",r));const{data:t,error:n}=await o;if(n)throw n;return t}async function v(e,a){const[r,o,t]=await Promise.all([i.from("cuenta_bancaria").select("saldo_actual").eq("ente_id",e).eq("activo",!0),i.from("cuenta_por_cobrar").select("saldo_pendiente").eq("ente_id",e).eq("ejercicio_id",a).neq("estado","cancelada"),i.from("cuenta_por_pagar").select("saldo_pendiente").eq("ente_id",e).eq("ejercicio_id",a).neq("estado","cancelada")]);return{saldoBancos:(r.data||[]).reduce((n,c)=>n+Number(c.saldo_actual||0),0),totalCxC:(o.data||[]).reduce((n,c)=>n+Number(c.saldo_pendiente||0),0),totalCxP:(t.data||[]).reduce((n,c)=>n+Number(c.saldo_pendiente||0),0)}}function w(){const{entePublico:e}=d();return s({queryKey:["cuentas_bancarias",e?.id],queryFn:()=>b(e.id),enabled:!!e?.id})}function P(e,a){return s({queryKey:["movimientos_bancarios",e,a],queryFn:()=>m(e,a),enabled:!!e})}function F(){const{entePublico:e,ejercicioFiscal:a}=d();return s({queryKey:["cuentas_por_cobrar",e?.id,a?.id],queryFn:()=>p(e.id,a.id),enabled:!!e?.id&&!!a?.id})}function j(){const{entePublico:e,ejercicioFiscal:a}=d();return s({queryKey:["cuentas_por_pagar",e?.id,a?.id],queryFn:()=>y(e.id,a.id),enabled:!!e?.id&&!!a?.id})}function K(e){const{entePublico:a,ejercicioFiscal:r}=d();return s({queryKey:["flujo_efectivo",a?.id,r?.id,e],queryFn:()=>h(a.id,r.id,e),enabled:!!a?.id&&!!r?.id})}function x(){const{entePublico:e,ejercicioFiscal:a}=d();return s({queryKey:["resumen_tesoreria",e?.id,a?.id],queryFn:()=>v(e.id,a.id),enabled:!!e?.id&&!!a?.id})}function N(){const e=l();return f({mutationFn:({cxcId:a,montoCobro:r})=>q(a,r),onSuccess:()=>{e.invalidateQueries({queryKey:["cuentas_por_cobrar"]}),e.invalidateQueries({queryKey:["resumen_tesoreria"]})}})}function M(){const e=l();return f({mutationFn:({cxpId:a,montoPago:r})=>g(a,r),onSuccess:()=>{e.invalidateQueries({queryKey:["cuentas_por_pagar"]}),e.invalidateQueries({queryKey:["resumen_tesoreria"]})}})}export{w as a,P as b,F as c,N as d,j as e,M as f,K as g,x as u};
