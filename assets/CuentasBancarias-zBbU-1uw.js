import{u as X,j as a}from"./index-xuYioy8Y.js";import{b as l}from"./vendor-DEA9Ikep.js";import{a as z,b as F,c as V}from"./useCrud-BZqSYSww.js";import{a as U}from"./useTesoreria-l9N5IDxQ.js";import{_}from"./constants-B0qHiDNt.js";import{D as $}from"./DataTable-CoGr0iSJ.js";import{M as G}from"./Modal-BawsBw69.js";import{B as u}from"./Button-CQM7GO5t.js";import{I as o}from"./Input-C6_ozmNh.js";import{S as k}from"./Select-CHQpqBAE.js";import{B as E}from"./Badge-DX5pclE5.js";import{C as H}from"./ConfirmDialog-BrOOKlKS.js";import{e as J}from"./exportHelpers-CvXmrB4L.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const K=m=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(m||0),A={numero_cuenta:"",clabe:"",banco:"",tipo:"cheques",moneda:"MXN",saldo_actual:"",responsable:"",activo:!0};function ue(){const{entePublico:m}=X(),[B,r]=l.useState(!1),[d,h]=l.useState(null),[t,p]=l.useState({...A}),[S,b]=l.useState(!1),[i,x]=l.useState(null),{data:g=[],isLoading:M}=U(),v=z("cuenta_bancaria"),f=F("cuenta_bancaria"),C=V("cuenta_bancaria"),I=l.useMemo(()=>Object.entries(_).map(([e,s])=>({value:e,label:s})),[]),T=[{value:"true",label:"Activa"},{value:"false",label:"Inactiva"}],n=(e,s)=>p(c=>({...c,[e]:s})),q=e=>({cheques:"primary",inversion:"info",fideicomiso:"warning",otro:"default"})[e]||"default",j=e=>_[e]||e,O=()=>{h(null),p({...A}),r(!0)},y=e=>{h(e),p({numero_cuenta:e.numero_cuenta??"",clabe:e.clabe??"",banco:e.banco??"",tipo:e.tipo??"cheques",moneda:e.moneda??"MXN",saldo_actual:e.saldo_actual??"",responsable:e.responsable??"",activo:e.activo??!0}),r(!0)},D=async()=>{const e={...t,ente_id:m?.id,saldo_actual:Number(t.saldo_actual)||0,activo:t.activo===!0||t.activo==="true"};d?await f.mutateAsync({id:d.id,...e}):await v.mutateAsync(e),r(!1)},P=e=>{x(e),b(!0)},R=async()=>{i&&await C.mutateAsync(i.id),b(!1),x(null)},w=()=>{J(g,[{key:"numero_cuenta",label:"No. Cuenta"},{key:"clabe",label:"CLABE"},{key:"banco",label:"Banco"},{key:"tipo",label:"Tipo",getValue:s=>j(s.tipo)},{key:"moneda",label:"Moneda"},{key:"saldo_actual",label:"Saldo Actual",getValue:s=>Number(s.saldo_actual||0)},{key:"responsable",label:"Responsable"},{key:"activo",label:"Estado",getValue:s=>s.activo?"Activa":"Inactiva"}],"cuentas_bancarias")},L=[{key:"numero_cuenta",label:"No. Cuenta",width:"150px"},{key:"clabe",label:"CLABE",width:"180px"},{key:"banco",label:"Banco"},{key:"tipo",label:"Tipo",width:"120px",render:e=>a.jsx(E,{variant:q(e),children:j(e)})},{key:"moneda",label:"Moneda",width:"80px"},{key:"saldo_actual",label:"Saldo Actual",width:"150px",render:e=>a.jsx("span",{className:"text-right block tabular-nums",children:K(e)})},{key:"responsable",label:"Responsable",width:"150px"},{key:"activo",label:"Estado",width:"100px",render:e=>a.jsx(E,{variant:e?"success":"default",children:e?"Activa":"Inactiva"})},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,s)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:c=>{c.stopPropagation(),y(s)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),a.jsx("button",{onClick:c=>{c.stopPropagation(),P(s)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],N=v.isPending||f.isPending;return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Cuentas Bancarias"}),a.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Administracion de cuentas bancarias del ente publico"})]}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Cuentas",a.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",g.length," registros)"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(u,{onClick:w,variant:"outline-primary",size:"sm",children:"Exportar Excel"}),a.jsx(u,{onClick:O,size:"sm",children:"+ Nueva Cuenta"})]})]}),M?a.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando cuentas bancarias..."}):a.jsx($,{columns:L,data:g,onRowClick:y}),a.jsx(G,{open:B,onClose:()=>r(!1),title:d?"Editar Cuenta Bancaria":"Nueva Cuenta Bancaria",size:"lg",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(o,{label:"Numero de Cuenta",value:t.numero_cuenta,onChange:e=>n("numero_cuenta",e.target.value),placeholder:"Ej. 0123456789",required:!0}),a.jsx(o,{label:"CLABE Interbancaria",value:t.clabe,onChange:e=>n("clabe",e.target.value),placeholder:"18 digitos"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(o,{label:"Banco",value:t.banco,onChange:e=>n("banco",e.target.value),placeholder:"Nombre del banco",required:!0}),a.jsx(k,{label:"Tipo de Cuenta",value:t.tipo,onChange:e=>n("tipo",e.target.value),options:I,placeholder:"-- Seleccione tipo --",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(o,{label:"Moneda",value:t.moneda,onChange:e=>n("moneda",e.target.value),placeholder:"MXN"}),a.jsx(o,{label:"Saldo Actual",type:"number",value:t.saldo_actual,onChange:e=>n("saldo_actual",e.target.value),placeholder:"0.00",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(o,{label:"Responsable",value:t.responsable,onChange:e=>n("responsable",e.target.value),placeholder:"Nombre del responsable de la cuenta"}),a.jsx(k,{label:"Estado",value:String(t.activo),onChange:e=>n("activo",e.target.value),options:T,placeholder:"-- Seleccione estado --",required:!0})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[a.jsx(u,{variant:"ghost",onClick:()=>r(!1),disabled:N,children:"Cancelar"}),a.jsx(u,{onClick:D,loading:N,disabled:!t.numero_cuenta.trim()||!t.banco.trim(),children:d?"Guardar cambios":"Crear cuenta"})]})]})}),a.jsx(H,{open:S,onClose:()=>{b(!1),x(null)},onConfirm:R,title:"Eliminar cuenta bancaria",message:i?`¿Esta seguro de eliminar la cuenta "${i.numero_cuenta} — ${i.banco}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:C.isPending})]})}export{ue as default};
