import{u as Q,j as o}from"./index-BS2M8vvb.js";import{b as i}from"./vendor-DEA9Ikep.js";import{u as W,a as Y,b as Z,c as ee,B as p}from"./Button-BxEPlTzl.js";import{a as oe,u as ae}from"./useFondosFederales-CxjHsGXv.js";import{D as te}from"./DataTable-8C0SkkHB.js";import{M as se}from"./Modal-bpmMeOtT.js";import{I as r}from"./Input-gSpTkrJG.js";import{S as j}from"./Select-DkUTgNBS.js";import{B as M}from"./Badge-1mTsSGYt.js";import{C as ne}from"./ConfirmDialog-DdRRwxda.js";import{e as ie}from"./exportHelpers-CvXmrB4L.js";import{j as S,k as A}from"./constants-B9IYjURH.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const l=x=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(x||0),O={clave:"",nombre:"",tipo:"participacion",fuente:"",monto_asignado:"",monto_recibido:"",monto_ejercido:"",monto_reintegrado:"0",fecha_asignacion:"",descripcion:"",estado:"activo",clasificador_id:""};function _e(){const{entePublico:x,ejercicioFiscal:T}=Q(),[D,d]=i.useState(!1),[m,v]=i.useState(null),[t,g]=i.useState({...O}),[R,b]=i.useState(!1),[c,f]=i.useState(null),{data:h=[],isLoading:P}=oe(),{data:u={}}=ae(),{data:_=[]}=W("clasificador_presupuestal",{filter:{tipo:"fuente_financiamiento"}}),N=Y("fondo_federal"),y=Z("fondo_federal"),k=ee("fondo_federal"),q=i.useMemo(()=>S.map(e=>({value:e.key??e,label:e.label??e})),[]),B=i.useMemo(()=>A.map(e=>({value:e.key??e,label:e.label??e})),[]),L=i.useMemo(()=>_.map(e=>({value:e.id,label:`${e.codigo} — ${e.nombre}`})),[_]),n=(e,a)=>g(s=>({...s,[e]:a})),V=e=>({participacion:"primary",aportacion:"success",subsidio:"warning",convenio:"info"})[e]||"default",I=e=>({activo:"success",suspendido:"warning",cancelado:"danger",cerrado:"info"})[e]||"default",C=e=>{const a=S.find(s=>(s.key??s)===e);return a?a.label??a:e},F=e=>{const a=A.find(s=>(s.key??s)===e);return a?a.label??a:e},$=()=>{v(null),g({...O}),d(!0)},E=e=>{v(e),g({clave:e.clave??"",nombre:e.nombre??"",tipo:e.tipo??"participacion",fuente:e.fuente??"",monto_asignado:e.monto_asignado??"",monto_recibido:e.monto_recibido??"",monto_ejercido:e.monto_ejercido??"",monto_reintegrado:e.monto_reintegrado??"0",fecha_asignacion:e.fecha_asignacion??"",descripcion:e.descripcion??"",estado:e.estado??"activo",clasificador_id:e.clasificador_id??""}),d(!0)},z=async()=>{const e={...t,ente_id:x?.id,ejercicio_id:T?.id,monto_asignado:Number(t.monto_asignado)||0,monto_recibido:Number(t.monto_recibido)||0,monto_ejercido:Number(t.monto_ejercido)||0,monto_reintegrado:Number(t.monto_reintegrado)||0,clasificador_id:t.clasificador_id||null};m?await y.mutateAsync({id:m.id,...e}):await N.mutateAsync(e),d(!1)},X=e=>{f(e),b(!0)},G=async()=>{c&&await k.mutateAsync(c.id),b(!1),f(null)},U=()=>{ie(h,[{key:"clave",label:"Clave"},{key:"nombre",label:"Nombre"},{key:"tipo",label:"Tipo",getValue:a=>C(a.tipo)},{key:"fuente",label:"Fuente"},{key:"monto_asignado",label:"Asignado",getValue:a=>Number(a.monto_asignado||0)},{key:"monto_recibido",label:"Recibido",getValue:a=>Number(a.monto_recibido||0)},{key:"monto_ejercido",label:"Ejercido",getValue:a=>Number(a.monto_ejercido||0)},{key:"pct_ejercido",label:"% Ejercido",getValue:a=>{const s=Number(a.monto_asignado||0);return s>0?(Number(a.monto_ejercido||0)/s*100).toFixed(1):"0.0"}},{key:"estado",label:"Estado",getValue:a=>F(a.estado)}],"fondos_federales")},H=[{key:"clave",label:"Clave",width:"100px"},{key:"nombre",label:"Nombre"},{key:"tipo",label:"Tipo",width:"130px",render:e=>o.jsx(M,{variant:V(e),children:C(e)})},{key:"fuente",label:"Fuente",width:"150px"},{key:"monto_asignado",label:"Asignado",width:"120px",render:e=>o.jsx("span",{className:"text-right block tabular-nums",children:l(e)})},{key:"monto_recibido",label:"Recibido",width:"120px",render:e=>o.jsx("span",{className:"text-right block tabular-nums",children:l(e)})},{key:"monto_ejercido",label:"Ejercido",width:"120px",render:e=>o.jsx("span",{className:"text-right block tabular-nums",children:l(e)})},{key:"monto_asignado",label:"% Ejercido",width:"80px",render:(e,a)=>{const s=Number(a.monto_asignado||0),J=Number(a.monto_ejercido||0),K=s>0?(J/s*100).toFixed(1):"0.0";return o.jsxs("span",{className:"text-right block tabular-nums",children:[K,"%"]})}},{key:"estado",label:"Estado",width:"100px",render:e=>o.jsx(M,{variant:I(e),children:F(e)})},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,a)=>o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:s=>{s.stopPropagation(),E(a)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),o.jsx("button",{onClick:s=>{s.stopPropagation(),X(a)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],w=N.isPending||y.isPending;return o.jsxs("div",{children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Fondos Federales"}),o.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Control de participaciones, aportaciones, subsidios y convenios federales"})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[o.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[o.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Total Asignado"}),o.jsx("p",{className:"text-lg font-bold text-text-primary",children:l(u.total_asignado)})]}),o.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[o.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Total Recibido"}),o.jsx("p",{className:"text-lg font-bold text-text-primary",children:l(u.total_recibido)})]}),o.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[o.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Total Ejercido"}),o.jsx("p",{className:"text-lg font-bold text-text-primary",children:l(u.total_ejercido)})]}),o.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[o.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Avance"}),o.jsxs("p",{className:"text-lg font-bold text-text-primary",children:[Number(u.pct_avance||0).toFixed(1),"%"]})]})]}),o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Fondos",o.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",h.length," registros)"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(p,{onClick:U,variant:"outline-primary",size:"sm",children:"Exportar Excel"}),o.jsx(p,{onClick:$,size:"sm",children:"+ Nuevo Fondo"})]})]}),P?o.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando fondos federales..."}):o.jsx(te,{columns:H,data:h,onRowClick:E}),o.jsx(se,{open:D,onClose:()=>d(!1),title:m?"Editar Fondo":"Nuevo Fondo",size:"lg",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx(r,{label:"Clave",value:t.clave,onChange:e=>n("clave",e.target.value),placeholder:"Ej. FF-001",required:!0}),o.jsx(j,{label:"Tipo",value:t.tipo,onChange:e=>n("tipo",e.target.value),options:q,placeholder:"— Seleccione tipo —",required:!0})]}),o.jsx(r,{label:"Nombre",value:t.nombre,onChange:e=>n("nombre",e.target.value),placeholder:"Nombre del fondo federal",required:!0}),o.jsx(r,{label:"Fuente",value:t.fuente,onChange:e=>n("fuente",e.target.value),placeholder:"Fuente de los recursos"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsx(r,{label:"Monto Asignado",type:"number",value:t.monto_asignado,onChange:e=>n("monto_asignado",e.target.value),placeholder:"0.00",required:!0}),o.jsx(r,{label:"Monto Recibido",type:"number",value:t.monto_recibido,onChange:e=>n("monto_recibido",e.target.value),placeholder:"0.00"}),o.jsx(r,{label:"Monto Ejercido",type:"number",value:t.monto_ejercido,onChange:e=>n("monto_ejercido",e.target.value),placeholder:"0.00"}),o.jsx(r,{label:"Monto Reintegrado",type:"number",value:t.monto_reintegrado,onChange:e=>n("monto_reintegrado",e.target.value),placeholder:"0.00"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx(r,{label:"Fecha Asignacion",type:"date",value:t.fecha_asignacion,onChange:e=>n("fecha_asignacion",e.target.value),required:!0}),o.jsx(j,{label:"Estado",value:t.estado,onChange:e=>n("estado",e.target.value),options:B,placeholder:"— Seleccione estado —",required:!0})]}),o.jsx(j,{label:"Clasificador (Fuente de Financiamiento)",value:t.clasificador_id,onChange:e=>n("clasificador_id",e.target.value),options:L,placeholder:"— Seleccione clasificador —"}),o.jsxs("div",{className:"w-full",children:[o.jsx("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:"Descripcion"}),o.jsx("textarea",{value:t.descripcion,onChange:e=>n("descripcion",e.target.value),placeholder:"Descripcion del fondo federal",rows:3,className:"w-full h-[40px] min-h-[80px] rounded-md border border-border px-3 py-2 text-[0.9375rem] focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda"})]}),o.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[o.jsx(p,{variant:"ghost",onClick:()=>d(!1),disabled:w,children:"Cancelar"}),o.jsx(p,{onClick:z,loading:w,disabled:!t.clave.trim()||!t.nombre.trim(),children:m?"Guardar cambios":"Crear fondo"})]})]})}),o.jsx(ne,{open:R,onClose:()=>{b(!1),f(null)},onConfirm:G,title:"Eliminar fondo",message:c?`¿Esta seguro de eliminar el fondo "${c.clave} — ${c.nombre}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:k.isPending})]})}export{_e as default};
