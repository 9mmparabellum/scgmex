import{j as e}from"./index-CPaKNtDw.js";import{b as x}from"./vendor-DEA9Ikep.js";import{c as A}from"./useMIR-Bur-8NZR.js";import{m}from"./constants-CX_We7cr.js";import{e as E}from"./exportHelpers-CvXmrB4L.js";import{B as I}from"./Button-BnoK6vsi.js";import{B as d}from"./Badge-CGz_j3CN.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const P={programa:"primary",proyecto:"info",actividad:"warning"},C={fin:"primary",proposito:"success",componente:"info",actividad:"warning"},f={fin:"Fin",proposito:"Proposito",componente:"Componente",actividad:"Actividad"};function D(){const{data:p=[],isLoading:v}=A(),[j,b]=x.useState(null),c=x.useMemo(()=>p.map(t=>{const o=t.indicadores||[],a=o.length,s=o.map(n=>{const l=Number(n.meta_programada||0),u=(n.avances||[]).reduce((w,k)=>w+Number(k.valor_alcanzado||0),0),_=l>0?Math.min(u/l*100,999.99):0;return{...n,meta_alcanzada:u,avance_pct:_}}),r=a>0?s.reduce((n,l)=>n+l.avance_pct,0)/a:0;return{...t,indicadores:s,num_indicadores:a,promedio_avance:r}}),[p]),g=t=>t>=90?{label:"Optimo",variant:"success"}:t>=60?{label:"Aceptable",variant:"warning"}:t>0?{label:"Rezagado",variant:"danger"}:{label:"Sin avance",variant:"default"},h=t=>t>=100?"success":t>=50?"warning":"danger",y=t=>{b(o=>o===t?null:t)},N=()=>{const t=[];c.forEach(a=>{a.indicadores.length===0?t.push({programa_clave:a.clave,programa_nombre:a.nombre,programa_tipo:m[a.tipo]||a.tipo,nivel:"",indicador:"",meta_programada:"",meta_alcanzada:"",avance_pct:"",promedio_programa:a.promedio_avance.toFixed(1)}):a.indicadores.forEach(s=>{t.push({programa_clave:a.clave,programa_nombre:a.nombre,programa_tipo:m[a.tipo]||a.tipo,nivel:f[s.nivel]||s.nivel,indicador:s.nombre_indicador,meta_programada:Number(s.meta_programada||0),meta_alcanzada:s.meta_alcanzada,avance_pct:s.avance_pct.toFixed(1),promedio_programa:a.promedio_avance.toFixed(1)})})}),E(t,[{key:"programa_clave",label:"Clave Programa"},{key:"programa_nombre",label:"Nombre Programa"},{key:"programa_tipo",label:"Tipo"},{key:"nivel",label:"Nivel MIR"},{key:"indicador",label:"Indicador"},{key:"meta_programada",label:"Meta Programada"},{key:"meta_alcanzada",label:"Meta Alcanzada"},{key:"avance_pct",label:"% Avance"},{key:"promedio_programa",label:"% Promedio Programa"}],"reporte_programatico")},i=x.useMemo(()=>{const t=c.length,o=c.filter(r=>r.num_indicadores>0).length,a=c.reduce((r,n)=>r+n.num_indicadores,0),s=t>0?c.reduce((r,n)=>r+n.promedio_avance,0)/t:0;return{total:t,conIndicadores:o,totalIndicadores:a,promedioGeneral:s}},[c]);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Reporte Programatico"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Resumen de programas e indicadores"})]}),v?e.jsxs("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Cargando reporte programatico..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Programas"}),e.jsx("p",{className:"text-lg font-bold text-text-primary",children:i.total})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Con Indicadores"}),e.jsx("p",{className:"text-lg font-bold text-text-primary",children:i.conIndicadores})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Total Indicadores"}),e.jsx("p",{className:"text-lg font-bold text-text-primary",children:i.totalIndicadores})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Avance Promedio"}),e.jsxs("p",{className:"text-lg font-bold text-text-primary",children:[i.promedioGeneral.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Detalle por programa",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",c.length," registros)"]})]}),e.jsx(I,{onClick:N,variant:"outline-primary",size:"sm",disabled:c.length===0,children:"Exportar Excel"})]}),c.length===0?e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-text-muted",children:[e.jsxs("svg",{className:"w-10 h-10 text-text-muted/50 mb-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]}),e.jsx("p",{className:"text-[0.9375rem]",children:"No hay programas registrados"}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Registre programas presupuestarios e indicadores para generar el reporte."})]})}):e.jsxs("div",{className:"bg-white rounded-lg card-shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#f9fafb]",children:[e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"40px"}}),e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"100px"},children:"Clave"}),e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Nombre"}),e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"120px"},children:"Tipo"}),e.jsx("th",{className:"text-center text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"120px"},children:"# Indicadores"}),e.jsx("th",{className:"text-center text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"140px"},children:"Promedio Avance"}),e.jsx("th",{className:"text-center text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"130px"},children:"Estado"})]})}),e.jsx("tbody",{children:c.map(t=>{const o=g(t.promedio_avance),a=j===t.id,s=t.num_indicadores>0;return e.jsxs(x.Fragment,{children:[e.jsxs("tr",{className:"border-b border-[#f0f0f0] hover:bg-[#f9fafb] transition-colors cursor-pointer",onClick:()=>s&&y(t.id),children:[e.jsx("td",{className:"px-5 py-3.5 text-center",children:s&&e.jsx("svg",{className:`w-4 h-4 text-text-muted transition-transform ${a?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary font-medium",children:t.clave}),e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary",children:t.nombre}),e.jsx("td",{className:"px-5 py-3.5",children:e.jsx(d,{variant:P[t.tipo]||"default",children:m[t.tipo]||t.tipo||"—"})}),e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary text-center tabular-nums",children:t.num_indicadores}),e.jsx("td",{className:"px-5 py-3.5 text-center",children:e.jsxs(d,{variant:h(t.promedio_avance),children:[t.promedio_avance.toFixed(1),"%"]})}),e.jsx("td",{className:"px-5 py-3.5 text-center",children:e.jsx(d,{variant:o.variant,children:o.label})})]}),a&&t.indicadores.map((r,n)=>e.jsxs("tr",{className:"border-b border-[#f0f0f0] bg-[#fafbfc]",children:[e.jsx("td",{className:"px-5 py-2.5"}),e.jsx("td",{className:"px-5 py-2.5"}),e.jsx("td",{className:"px-5 py-2.5 text-[0.8125rem] text-text-secondary",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:C[r.nivel]||"default",children:f[r.nivel]||r.nivel}),e.jsx("span",{children:r.nombre_indicador})]})}),e.jsx("td",{className:"px-5 py-2.5 text-[0.8125rem] text-text-muted text-center",children:r.unidad_medida||"—"}),e.jsxs("td",{className:"px-5 py-2.5 text-[0.8125rem] text-text-secondary text-center tabular-nums",children:[Number(r.meta_programada||0).toLocaleString("es-MX")," / ",r.meta_alcanzada.toLocaleString("es-MX")]}),e.jsx("td",{className:"px-5 py-2.5 text-center",children:e.jsxs(d,{variant:h(r.avance_pct),children:[r.avance_pct.toFixed(1),"%"]})}),e.jsx("td",{className:"px-5 py-2.5",children:e.jsx("div",{className:"w-full bg-[#f0f0f0] rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full ${r.avance_pct>=100?"bg-success":r.avance_pct>=50?"bg-warning":"bg-danger"}`,style:{width:`${Math.min(r.avance_pct,100)}%`}})})})]},r.id??`${t.id}-ind-${n}`))]},t.id)})})]})}),e.jsxs("div",{className:"px-5 py-4 border-t border-border bg-[#f9fafb] flex items-center gap-6 text-sm text-text-secondary",children:[e.jsxs("span",{children:["Total programas: ",e.jsx("span",{className:"font-semibold text-text-primary",children:i.total})]}),e.jsxs("span",{children:["Total indicadores: ",e.jsx("span",{className:"font-semibold text-text-primary",children:i.totalIndicadores})]}),e.jsxs("span",{children:["Avance promedio general: ",e.jsxs("span",{className:"font-semibold text-text-primary",children:[i.promedioGeneral.toFixed(1),"%"]})]})]})]})]})]})}export{D as default};
