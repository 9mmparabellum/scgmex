import{s}from"./index-xuYioy8Y.js";const f=["aprobado","modificado","comprometido","devengado","ejercido","pagado"],_=["estimado","modificado","devengado","recaudado"];function m(){return{aprobado:0,modificado:0,comprometido:0,devengado:0,ejercido:0,pagado:0}}function p(){return{estimado:0,modificado:0,devengado:0,recaudado:0}}function u(t,e,o,i){const r={};for(const n of t){const a=n[e];r[a]||(r[a]=i());const c=n.momento;o.includes(c)&&(r[a][c]+=Number(n.monto)||0)}return r}function l(t,e,o){const i=o();for(const r of t){const n=r.momento;e.includes(n)&&(i[n]+=Number(r.monto)||0)}return i}async function v(t,e){const{data:o,error:i}=await s.from("partida_egreso").select("*, clasificador:clasificador_presupuestal!clasificador_id(codigo, nombre), fuente:clasificador_presupuestal!fuente_id(codigo, nombre)").eq("ente_id",t).eq("ejercicio_id",e).order("clave");if(i)throw i;if(!o.length)return[];const r=o.map(d=>d.id),{data:n,error:a}=await s.from("movimiento_presupuestal_egreso").select("*").in("partida_id",r);if(a)throw a;const c=u(n,"partida_id",f,m);return o.map(d=>({...d,totales:c[d.id]||m()}))}async function h(t,e={}){let o=s.from("movimiento_presupuestal_egreso").select("*, partida:partida_egreso!inner(clave, descripcion, ente_id, clasificador:clasificador_presupuestal!clasificador_id(codigo, nombre))").eq("partida_egreso.ente_id",t).order("fecha",{ascending:!1}).order("created_at",{ascending:!1});e.partida_id&&(o=o.eq("partida_id",e.partida_id)),e.periodo_id&&(o=o.eq("periodo_id",e.periodo_id)),e.momento&&(o=o.eq("momento",e.momento));const{data:i,error:r}=await o;if(r)throw r;return i}async function w(t,e){const{data:o,error:i}=await s.from("partida_egreso").select("id").eq("ente_id",t).eq("ejercicio_id",e);if(i)throw i;if(!o.length)return m();const r=o.map(c=>c.id),{data:n,error:a}=await s.from("movimiento_presupuestal_egreso").select("momento, monto").in("partida_id",r);if(a)throw a;return l(n,f,m)}async function q(t,e){const{data:o,error:i}=await s.from("concepto_ingreso").select("*, clasificador:clasificador_presupuestal!clasificador_id(codigo, nombre)").eq("ente_id",t).eq("ejercicio_id",e).order("clave");if(i)throw i;if(!o.length)return[];const r=o.map(d=>d.id),{data:n,error:a}=await s.from("movimiento_presupuestal_ingreso").select("*").in("concepto_id",r);if(a)throw a;const c=u(n,"concepto_id",_,p);return o.map(d=>({...d,totales:c[d.id]||p()}))}async function E(t,e={}){let o=s.from("movimiento_presupuestal_ingreso").select("*, concepto:concepto_ingreso!inner(clave, descripcion, ente_id, clasificador:clasificador_presupuestal!clasificador_id(codigo, nombre))").eq("concepto_ingreso.ente_id",t).order("fecha",{ascending:!1}).order("created_at",{ascending:!1});e.concepto_id&&(o=o.eq("concepto_id",e.concepto_id)),e.periodo_id&&(o=o.eq("periodo_id",e.periodo_id)),e.momento&&(o=o.eq("momento",e.momento));const{data:i,error:r}=await o;if(r)throw r;return i}async function b(t,e){const{data:o,error:i}=await s.from("concepto_ingreso").select("id").eq("ente_id",t).eq("ejercicio_id",e);if(i)throw i;if(!o.length)return p();const r=o.map(c=>c.id),{data:n,error:a}=await s.from("movimiento_presupuestal_ingreso").select("momento, monto").in("concepto_id",r);if(a)throw a;return l(n,_,p)}export{E as a,v as b,w as c,q as d,b as e,h as f};
