import{u as $,j as a}from"./index-C8w7C__S.js";import{b as o}from"./vendor-DEA9Ikep.js";import{a as H,b as J,c as K,B as b}from"./Button-DuXcW5xX.js";import{u as Q,a as W}from"./usePatrimonio-CkHDK6EY.js";import{D as Y}from"./DataTable-jgOn3qee.js";import{M as Z}from"./Modal-DP5Epx02.js";import{I as t}from"./Input-BuLY86I-.js";import{S as x}from"./Select-D5ASwMqy.js";import{B as D}from"./Badge-R2GXFUbi.js";import{C as ee}from"./ConfirmDialog-u86aQ__Z.js";import{e as ae}from"./exportHelpers-CvXmrB4L.js";import{c as ie,d as se}from"./constants-B9IYjURH.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const g=h=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(h||0),A={clave:"",descripcion:"",tipo:"mueble",fecha_adquisicion:"",valor_adquisicion:"",depreciacion_acumulada:"0",vida_util_anios:"",tasa_depreciacion:"",ubicacion:"",responsable:"",numero_serie:"",marca:"",modelo:"",estado:"activo"},le={mueble:"info",inmueble:"success",intangible:"warning"};function _e(){const{entePublico:h,ejercicioFiscal:B}=$(),[P,r]=o.useState(!1),[d,y]=o.useState(null),[i,v]=o.useState({...A}),[O,_]=o.useState(!1),[c,f]=o.useState(null),[u,F]=o.useState(""),[m,V]=o.useState(""),{data:N=[],isLoading:w}=Q(),{data:p={}}=W(),C=H("bien_patrimonial"),k=J("bien_patrimonial"),E=K("bien_patrimonial"),j=o.useMemo(()=>{let e=N;return u&&(e=e.filter(s=>s.tipo===u)),m&&(e=e.filter(s=>s.estado===m)),e},[N,u,m]),q=o.useMemo(()=>Object.entries(ie).map(([e,s])=>({value:e,label:s})),[]),M=o.useMemo(()=>Object.entries(se).map(([e,s])=>({value:e,label:s.label})),[]),l=(e,s)=>v(n=>({...n,[e]:s})),I=()=>{y(null),v({...A}),r(!0)},S=e=>{y(e),v({clave:e.clave??"",descripcion:e.descripcion??"",tipo:e.tipo??"mueble",fecha_adquisicion:e.fecha_adquisicion??"",valor_adquisicion:e.valor_adquisicion??"",depreciacion_acumulada:e.depreciacion_acumulada??"0",vida_util_anios:e.vida_util_anios??"",tasa_depreciacion:e.tasa_depreciacion??"",ubicacion:e.ubicacion??"",responsable:e.responsable??"",numero_serie:e.numero_serie??"",marca:e.marca??"",modelo:e.modelo??"",estado:e.estado??"activo"}),r(!0)},U=async()=>{const e={...i,ente_id:h?.id,ejercicio_id:B?.id,valor_adquisicion:Number(i.valor_adquisicion)||0,depreciacion_acumulada:Number(i.depreciacion_acumulada)||0,vida_util_anios:i.vida_util_anios?Number(i.vida_util_anios):null,tasa_depreciacion:i.tasa_depreciacion?Number(i.tasa_depreciacion):null};d?await k.mutateAsync({id:d.id,...e}):await C.mutateAsync(e),r(!1)},R=e=>{f(e),_(!0)},L=async()=>{c&&await E.mutateAsync(c.id),_(!1),f(null)},X=()=>{ae(j,[{key:"clave",label:"Clave"},{key:"descripcion",label:"Descripcion"},{key:"tipo",label:"Tipo"},{key:"fecha_adquisicion",label:"Fecha Adquisicion"},{key:"valor_adquisicion",label:"Valor Adquisicion"},{key:"depreciacion_acumulada",label:"Depreciacion Acumulada"},{key:"valor_neto",label:"Valor Neto",getValue:s=>(Number(s.valor_adquisicion)||0)-(Number(s.depreciacion_acumulada)||0)},{key:"estado",label:"Estado"},{key:"ubicacion",label:"Ubicacion"},{key:"responsable",label:"Responsable"}],"bienes_patrimoniales")},z=[{key:"clave",label:"Clave",width:"100px"},{key:"descripcion",label:"Descripcion"},{key:"tipo",label:"Tipo",width:"100px",render:e=>a.jsx(D,{variant:le[e]||"default",children:e?e.charAt(0).toUpperCase()+e.slice(1):"—"})},{key:"fecha_adquisicion",label:"Fecha Adq.",width:"110px",render:e=>e?new Date(e+"T00:00:00").toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"}):"—"},{key:"valor_adquisicion",label:"Valor Adq.",width:"130px",render:e=>a.jsx("span",{className:"block text-right tabular-nums",children:g(e)})},{key:"depreciacion_acumulada",label:"Deprec. Acum.",width:"130px",render:e=>a.jsx("span",{className:"block text-right tabular-nums",children:g(e)})},{key:"valor_neto",label:"Valor Neto",width:"130px",render:(e,s)=>{const n=(Number(s.valor_adquisicion)||0)-(Number(s.depreciacion_acumulada)||0);return a.jsx("span",{className:"block text-right tabular-nums",children:g(n)})}},{key:"estado",label:"Estado",width:"100px",render:e=>{const s={activo:"success",baja:"danger",transferido:"warning",en_comodato:"info"};return a.jsx(D,{variant:s[e]||"default",children:e?e.replace(/_/g," ").replace(/^\w/,n=>n.toUpperCase()):"—"})}},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,s)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:n=>{n.stopPropagation(),S(s)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),a.jsx("button",{onClick:n=>{n.stopPropagation(),R(s)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],T=C.isPending||k.isPending,G=[{label:"Total Muebles",value:p.total_muebles??0},{label:"Total Inmuebles",value:p.total_inmuebles??0},{label:"Total Intangibles",value:p.total_intangibles??0},{label:"Valor Neto Total",value:g(p.valor_neto_total),isCurrency:!0}];return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Bienes Patrimoniales"}),a.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 23 LGCG — Control de bienes muebles, inmuebles e intangibles"})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:G.map(e=>a.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[a.jsx("p",{className:"text-sm text-text-muted mb-1",children:e.label}),a.jsx("p",{className:"text-xl font-bold text-text-primary",children:e.isCurrency?e.value:Number(e.value).toLocaleString("es-MX")})]},e.label))}),a.jsx("div",{className:"bg-white rounded-lg card-shadow p-5 mb-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(x,{label:"Tipo de Bien",value:u,onChange:e=>F(e.target.value),options:q,placeholder:"— Todos los tipos —"}),a.jsx(x,{label:"Estado",value:m,onChange:e=>V(e.target.value),options:M,placeholder:"— Todos los estados —"})]})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Bienes",a.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",j.length," registros)"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(b,{onClick:X,variant:"secondary",size:"sm",children:"Exportar Excel"}),a.jsx(b,{onClick:I,size:"sm",children:"+ Nuevo Bien"})]})]}),w?a.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando bienes patrimoniales..."}):a.jsx(Y,{columns:z,data:j,onRowClick:S}),a.jsx(Z,{open:P,onClose:()=>r(!1),title:d?"Editar Bien Patrimonial":"Nuevo Bien Patrimonial",size:"lg",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(t,{label:"Clave",value:i.clave,onChange:e=>l("clave",e.target.value),placeholder:"Ej. BM-001",required:!0}),a.jsx(x,{label:"Tipo de Bien",value:i.tipo,onChange:e=>l("tipo",e.target.value),options:q,placeholder:"— Seleccione tipo —"})]}),a.jsxs("div",{className:"w-full",children:[a.jsxs("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:["Descripcion ",a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx("textarea",{value:i.descripcion,onChange:e=>l("descripcion",e.target.value),placeholder:"Descripcion del bien patrimonial",rows:3,className:"w-full h-[40px] min-h-[80px] rounded-md border border-border px-3 py-2 text-[0.9375rem] focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(t,{label:"Fecha Adquisicion",type:"date",value:i.fecha_adquisicion,onChange:e=>l("fecha_adquisicion",e.target.value)}),a.jsx(t,{label:"Valor Adquisicion",type:"number",value:i.valor_adquisicion,onChange:e=>l("valor_adquisicion",e.target.value),placeholder:"0.00"}),a.jsx(t,{label:"Depreciacion Acumulada",type:"number",value:i.depreciacion_acumulada,onChange:e=>l("depreciacion_acumulada",e.target.value),placeholder:"0.00"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(t,{label:"Vida Util (anios)",type:"number",value:i.vida_util_anios,onChange:e=>l("vida_util_anios",e.target.value),placeholder:"Ej. 10"}),a.jsx(t,{label:"Tasa Depreciacion (%)",type:"number",value:i.tasa_depreciacion,onChange:e=>l("tasa_depreciacion",e.target.value),placeholder:"Ej. 10"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(t,{label:"Ubicacion",value:i.ubicacion,onChange:e=>l("ubicacion",e.target.value),placeholder:"Ubicacion fisica del bien"}),a.jsx(t,{label:"Responsable",value:i.responsable,onChange:e=>l("responsable",e.target.value),placeholder:"Nombre del responsable"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(t,{label:"Numero de Serie",value:i.numero_serie,onChange:e=>l("numero_serie",e.target.value),placeholder:"N/S"}),a.jsx(t,{label:"Marca",value:i.marca,onChange:e=>l("marca",e.target.value),placeholder:"Marca"}),a.jsx(t,{label:"Modelo",value:i.modelo,onChange:e=>l("modelo",e.target.value),placeholder:"Modelo"})]}),a.jsx(x,{label:"Estado",value:i.estado,onChange:e=>l("estado",e.target.value),options:M,placeholder:"— Seleccione estado —"}),a.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[a.jsx(b,{variant:"ghost",onClick:()=>r(!1),disabled:T,children:"Cancelar"}),a.jsx(b,{onClick:U,loading:T,disabled:!i.clave.trim()||!i.descripcion.trim(),children:d?"Guardar cambios":"Crear bien"})]})]})}),a.jsx(ee,{open:O,onClose:()=>{_(!1),f(null)},onConfirm:L,title:"Eliminar bien patrimonial",message:c?`¿Esta seguro de eliminar el bien "${c.clave} — ${c.descripcion}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:E.isPending})]})}export{_e as default};
