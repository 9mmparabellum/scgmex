import{u as z,j as t}from"./index-w8y8owqO.js";import{b as n}from"./vendor-DEA9Ikep.js";import{useCreate as F,useUpdate as L,useRemove as $}from"./useCrud-BtFPgtI3.js";import{c as U}from"./useNomina-CDDh2CXE.js";import{u as N}from"./constants-CX_We7cr.js";import{D as H}from"./DataTable-BSU7FwdU.js";import{M as J}from"./Modal-BIIwL78L.js";import{B as u}from"./Button-BNgFL-Nv.js";import{I as y}from"./Input-pbRyI1ph.js";import{S as v}from"./Select-BDMENQev.js";import{B as S}from"./Badge-CBnEW2x0.js";import{C as K}from"./ConfirmDialog-CEB8zrmM.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const E={clave:"",nombre:"",tipo:"percepcion",gravado:!1,activo:!0};function le(){const{entePublico:k}=z(),[O,s]=n.useState(!1),[c,x]=n.useState(null),[o,d]=n.useState({...E}),[A,m]=n.useState(!1),[i,p]=n.useState(null),{data:g=[],isLoading:M}=U(),f=F("concepto_nomina"),b=L("concepto_nomina"),h=$("concepto_nomina"),P=n.useMemo(()=>Object.entries(N).map(([e,a])=>({value:e,label:a})),[]),D=[{value:"true",label:"Si"},{value:"false",label:"No"}],T=[{value:"true",label:"Activo"},{value:"false",label:"Inactivo"}],r=(e,a)=>d(l=>({...l,[e]:a})),_=e=>({percepcion:"success",deduccion:"danger"})[e]||"default",I=e=>N[e]||e,B=()=>{x(null),d({...E}),s(!0)},j=e=>{x(e),d({clave:e.clave??"",nombre:e.nombre??"",tipo:e.tipo??"percepcion",gravado:e.gravado??!1,activo:e.activo??!0}),s(!0)},w=async()=>{const e={...o,ente_id:k?.id,gravado:o.gravado===!0||o.gravado==="true",activo:o.activo===!0||o.activo==="true"};c?await b.mutateAsync({id:c.id,...e}):await f.mutateAsync(e),s(!1)},q=e=>{p(e),m(!0)},G=async()=>{i&&await h.mutateAsync(i.id),m(!1),p(null)},R=n.useMemo(()=>[{key:"clave",label:"Clave",width:"120px"},{key:"nombre",label:"Nombre"},{key:"tipo",label:"Tipo",width:"130px",render:e=>t.jsx(S,{variant:_(e),children:I(e)})},{key:"gravado",label:"Gravado",width:"100px",render:e=>e?"Si":"No"},{key:"activo",label:"Estado",width:"100px",render:e=>t.jsx(S,{variant:e?"success":"default",children:e?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,a)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),j(a)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),t.jsx("button",{onClick:l=>{l.stopPropagation(),q(a)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],[]),C=f.isPending||b.isPending;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Conceptos de Nomina"}),t.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Administracion de percepciones y deducciones aplicables en la nomina"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Conceptos",t.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",g.length," registros)"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(u,{onClick:B,size:"sm",children:"+ Nuevo Concepto"})})]}),M?t.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando conceptos de nomina..."}):t.jsx(H,{columns:R,data:g,onRowClick:j}),t.jsx(J,{open:O,onClose:()=>s(!1),title:c?"Editar Concepto":"Nuevo Concepto",size:"md",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx(y,{label:"Clave",value:o.clave,onChange:e=>r("clave",e.target.value),placeholder:"Ej. P001, D001...",required:!0}),t.jsx(y,{label:"Nombre",value:o.nombre,onChange:e=>r("nombre",e.target.value),placeholder:"Nombre del concepto",required:!0}),t.jsx(v,{label:"Tipo",value:o.tipo,onChange:e=>r("tipo",e.target.value),options:P,placeholder:"-- Seleccione tipo --",required:!0}),t.jsx(v,{label:"Gravado",value:String(o.gravado),onChange:e=>r("gravado",e.target.value),options:D,placeholder:"-- Seleccione --"}),t.jsx(v,{label:"Estado",value:String(o.activo),onChange:e=>r("activo",e.target.value),options:T,placeholder:"-- Seleccione estado --"}),t.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[t.jsx(u,{variant:"ghost",onClick:()=>s(!1),disabled:C,children:"Cancelar"}),t.jsx(u,{onClick:w,loading:C,disabled:!o.clave.trim()||!o.nombre.trim(),children:c?"Guardar cambios":"Crear concepto"})]})]})}),t.jsx(K,{open:A,onClose:()=>{m(!1),p(null)},onConfirm:G,title:"Eliminar concepto de nomina",message:i?`¿Esta seguro de eliminar el concepto "${i.clave} — ${i.nombre}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:h.isPending})]})}export{le as default};
