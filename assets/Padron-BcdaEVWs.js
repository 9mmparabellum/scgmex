import{u as G,A as z,j as a}from"./index-CPaKNtDw.js";import{b as r}from"./vendor-DEA9Ikep.js";import{b as $,a as X}from"./useRecaudacion-DPF76MCY.js";import{useCreate as L,useUpdate as U,useRemove as H}from"./useCrud-BktvsPeN.js";import{D as J}from"./DataTable-HS7RLNYY.js";import{M as K}from"./Modal-BiK_8Ur7.js";import{B as m}from"./Button-BnoK6vsi.js";import{I as l}from"./Input-DL7Lvbg0.js";import{S as k}from"./Select-C_7OhVDc.js";import{B as Q}from"./Badge-CGz_j3CN.js";import{C as W}from"./ConfirmDialog-DLbWcXIK.js";import{e as Y}from"./exportHelpers-CvXmrB4L.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const E=u=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(u||0),P={contribuyente_id:"",clave_catastral:"",tipo_impuesto:"",base_gravable:"",tasa:"",monto_determinado:"",periodo:"",activo:!0};function pe(){const{entePublico:u,ejercicioFiscal:M,rol:S}=G(),p=z(S,"recaudacion"),[A,i]=r.useState(!1),[c,h]=r.useState(null),[t,b]=r.useState({...P}),[I,x]=r.useState(!1),[d,v]=r.useState(null),{data:g=[],isLoading:T}=$(),{data:y=[]}=X(),f=L("padron_fiscal"),_=U("padron_fiscal"),j=H("padron_fiscal"),D=r.useMemo(()=>y.map(e=>({value:e.id,label:`${e.nombre} (${e.rfc})`})),[y]),R=[{value:"true",label:"Activo"},{value:"false",label:"Inactivo"}],s=(e,o)=>b(n=>({...n,[e]:o})),B=()=>{h(null),b({...P}),i(!0)},C=e=>{h(e),b({contribuyente_id:e.contribuyente_id??"",clave_catastral:e.clave_catastral??"",tipo_impuesto:e.tipo_impuesto??"",base_gravable:e.base_gravable??"",tasa:e.tasa??"",monto_determinado:e.monto_determinado??"",periodo:e.periodo??"",activo:e.activo??!0}),i(!0)},F=async()=>{const e={...t,ente_id:u?.id,ejercicio_id:M?.id,base_gravable:Number(t.base_gravable)||0,tasa:Number(t.tasa)||0,monto_determinado:Number(t.monto_determinado)||0,activo:t.activo===!0||t.activo==="true"};c?await _.mutateAsync({id:c.id,...e}):await f.mutateAsync(e),i(!1)},q=e=>{v(e),x(!0)},O=async()=>{d&&await j.mutateAsync(d.id),x(!1),v(null)},V=()=>{Y(g,[{key:"clave_catastral",label:"Clave Catastral"},{key:"contribuyente",label:"Contribuyente",getValue:o=>o.contribuyente?.nombre||""},{key:"contribuyente_rfc",label:"RFC",getValue:o=>o.contribuyente?.rfc||""},{key:"tipo_impuesto",label:"Tipo Impuesto"},{key:"base_gravable",label:"Base Gravable",getValue:o=>Number(o.base_gravable||0)},{key:"tasa",label:"Tasa (%)",getValue:o=>Number(o.tasa||0)},{key:"monto_determinado",label:"Monto Determinado",getValue:o=>Number(o.monto_determinado||0)},{key:"periodo",label:"Periodo"},{key:"activo",label:"Estado",getValue:o=>o.activo?"Activo":"Inactivo"}],"padron_fiscal")},w=r.useMemo(()=>[{key:"clave_catastral",label:"Clave Catastral",width:"150px"},{key:"contribuyente",label:"Contribuyente",render:e=>e?.nombre||""},{key:"tipo_impuesto",label:"Tipo Impuesto",width:"150px"},{key:"base_gravable",label:"Base Gravable",width:"140px",render:e=>a.jsx("span",{className:"text-right block tabular-nums",children:E(e)})},{key:"tasa",label:"Tasa (%)",width:"100px",render:e=>a.jsxs("span",{className:"text-right block tabular-nums",children:[Number(e||0).toFixed(2),"%"]})},{key:"monto_determinado",label:"Monto",width:"140px",render:e=>a.jsx("span",{className:"text-right block tabular-nums font-semibold",children:E(e)})},{key:"activo",label:"Activo",width:"100px",render:e=>a.jsx(Q,{variant:e?"success":"default",children:e?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,o)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:n=>{n.stopPropagation(),C(o)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),p&&a.jsx("button",{onClick:n=>{n.stopPropagation(),q(o)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],[p]),N=f.isPending||_.isPending;return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Padron Fiscal"}),a.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Registro de obligaciones fiscales de contribuyentes del ejercicio fiscal"})]}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Padron Fiscal",a.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",g.length," registros)"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(m,{onClick:V,variant:"outline-primary",size:"sm",children:"Exportar Excel"}),p&&a.jsx(m,{onClick:B,size:"sm",children:"+ Nuevo Registro"})]})]}),T?a.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando padron fiscal..."}):a.jsx(J,{columns:w,data:g,onRowClick:C}),a.jsx(K,{open:A,onClose:()=>i(!1),title:c?"Editar Registro del Padron":"Nuevo Registro del Padron",size:"lg",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(k,{label:"Contribuyente",value:t.contribuyente_id,onChange:e=>s("contribuyente_id",e.target.value),options:D,placeholder:"-- Seleccione contribuyente --",required:!0}),a.jsx(l,{label:"Clave Catastral",value:t.clave_catastral,onChange:e=>s("clave_catastral",e.target.value),placeholder:"Ej. 001-002-003",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(l,{label:"Tipo de Impuesto",value:t.tipo_impuesto,onChange:e=>s("tipo_impuesto",e.target.value),placeholder:"Ej. Predial, ISR, Agua, etc.",required:!0}),a.jsx(l,{label:"Periodo",value:t.periodo,onChange:e=>s("periodo",e.target.value),placeholder:"Ej. Bimestre 1, Anual, etc."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(l,{label:"Base Gravable",type:"number",value:t.base_gravable,onChange:e=>s("base_gravable",e.target.value),placeholder:"0.00",required:!0}),a.jsx(l,{label:"Tasa (%)",type:"number",value:t.tasa,onChange:e=>s("tasa",e.target.value),placeholder:"0.00",required:!0}),a.jsx(l,{label:"Monto Determinado",type:"number",value:t.monto_determinado,onChange:e=>s("monto_determinado",e.target.value),placeholder:"0.00",required:!0})]}),a.jsx(k,{label:"Estado",value:String(t.activo),onChange:e=>s("activo",e.target.value),options:R,placeholder:"-- Seleccione estado --",required:!0}),a.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[a.jsx(m,{variant:"ghost",onClick:()=>i(!1),disabled:N,children:"Cancelar"}),a.jsx(m,{onClick:F,loading:N,disabled:!t.contribuyente_id||!t.clave_catastral.trim()||!t.tipo_impuesto.trim(),children:c?"Guardar cambios":"Crear registro"})]})]})}),a.jsx(W,{open:I,onClose:()=>{x(!1),v(null)},onConfirm:O,title:"Eliminar registro del padron",message:d?`Â¿Esta seguro de eliminar el registro con clave catastral "${d.clave_catastral}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:j.isPending})]})}export{pe as default};
