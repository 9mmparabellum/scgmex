import{u as $,j as a}from"./index-CyKkzz21.js";import{b as l}from"./vendor-DEA9Ikep.js";import{u as z,a as G,b as L,c as R}from"./useCrud-bUfgzWCS.js";import{D as q}from"./DataTable-DfIEqyJf.js";import{M as U}from"./Modal-CR5BegYj.js";import{B as f}from"./Button-BA780zlq.js";import{I as v}from"./Input-CofDiIdZ.js";import{S as H}from"./Select-B7MIUx36.js";import{B as J}from"./Badge-BiItYtys.js";import{C as K}from"./ConfirmDialog-DPG7zYiO.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const m=[{value:"objeto_gasto",label:"Objeto del Gasto"},{value:"funcional",label:"Funcional"},{value:"administrativo",label:"Administrativo"},{value:"economico",label:"Economico"},{value:"programatico",label:"Programatico"},{value:"geografico",label:"Geografico"},{value:"fuente_financiamiento",label:"Fuente de Financiamiento"}],_={tipo:"",codigo:"",nombre:"",nivel:1,padre_id:"",activo:!0};function le(){const{entePublico:g}=$(),[i,E]=l.useState(m[0].value),[S,r]=l.useState(!1),[s,h]=l.useState(null),[t,u]=l.useState({..._,tipo:m[0].value}),[A,p]=l.useState(!1),[n,x]=l.useState(null),{data:b=[],isLoading:w}=z("clasificador_presupuestal",{filter:{ente_id:g?.id,tipo:i}}),j=G("clasificador_presupuestal"),C=L("clasificador_presupuestal"),y=R("clasificador_presupuestal"),P=m.find(e=>e.value===i)?.label??i,T=b.filter(e=>s?e.id!==s.id:!0).map(e=>({value:e.id,label:`${e.codigo} — ${e.nombre}`})),O=e=>{E(e),u(o=>({...o,tipo:e}))},D=()=>{h(null),u({..._,tipo:i}),r(!0)},N=e=>{h(e),u({tipo:e.tipo??i,codigo:e.codigo??"",nombre:e.nombre??"",nivel:e.nivel??1,padre_id:e.padre_id??"",activo:e.activo??!0}),r(!0)},c=(e,o)=>{u(d=>({...d,[e]:o}))},F=async()=>{const e={...t,ente_id:g?.id,padre_id:t.padre_id||null,nivel:Number(t.nivel)||1};s?await C.mutateAsync({id:s.id,...e}):await j.mutateAsync(e),r(!1)},M=e=>{x(e),p(!0)},B=async()=>{n&&await y.mutateAsync(n.id),p(!1),x(null)},I=[{key:"codigo",label:"Codigo",width:"140px"},{key:"nombre",label:"Nombre"},{key:"nivel",label:"Nivel",width:"80px"},{key:"activo",label:"Estado",width:"100px",render:e=>a.jsx(J,{variant:e?"success":"default",children:e?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"160px",sortable:!1,render:(e,o)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:d=>{d.stopPropagation(),N(o)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),a.jsx("button",{onClick:d=>{d.stopPropagation(),M(o)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],k=j.isPending||C.isPending;return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Clasificadores Presupuestales"}),a.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 4 — 7 clasificadores normativos CONAC"})]}),a.jsx("div",{className:"flex flex-wrap items-center gap-2 mb-6",children:m.map(e=>a.jsx("button",{onClick:()=>O(e.value),className:["px-4 py-2 text-sm font-medium rounded-lg transition-colors cursor-pointer",i===e.value?"bg-primary text-white":"bg-white card-shadow text-text-secondary hover:bg-bg-hover"].join(" "),children:e.label},e.value))}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:[P,a.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",b.length," registros)"]})]}),a.jsx(f,{onClick:D,size:"sm",children:"+ Nuevo clasificador"})]}),w?a.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando clasificadores..."}):a.jsx(q,{columns:I,data:b,onRowClick:N}),a.jsx(U,{open:S,onClose:()=>r(!1),title:s?"Editar Clasificador":"Nuevo Clasificador",size:"md",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"w-full",children:[a.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Tipo de clasificador"}),a.jsx("div",{className:"block w-full h-[40px] rounded-md border border-border bg-bg-hover text-text-muted text-[0.9375rem] px-3.5 py-2.5",children:m.find(e=>e.value===t.tipo)?.label??t.tipo})]}),a.jsx(v,{label:"Codigo",value:t.codigo,onChange:e=>c("codigo",e.target.value),placeholder:"Ej. 1000, 1.1, F01",required:!0}),a.jsx(v,{label:"Nombre",value:t.nombre,onChange:e=>c("nombre",e.target.value),placeholder:"Nombre del clasificador",required:!0}),a.jsx(v,{label:"Nivel",type:"number",value:t.nivel,onChange:e=>c("nivel",e.target.value),min:1}),a.jsx(H,{label:"Clasificador padre (opcional)",value:t.padre_id,onChange:e=>c("padre_id",e.target.value),placeholder:"— Sin padre (nivel raiz) —",options:T}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:t.activo,onChange:e=>c("activo",e.target.checked),className:"rounded border-border text-primary focus:ring-primary/30 h-4 w-4 cursor-pointer"}),a.jsx("span",{className:"text-sm text-text-secondary",children:"Activo"})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[a.jsx(f,{variant:"ghost",onClick:()=>r(!1),disabled:k,children:"Cancelar"}),a.jsx(f,{onClick:F,loading:k,disabled:!t.codigo.trim()||!t.nombre.trim(),children:s?"Guardar cambios":"Crear clasificador"})]})]})}),a.jsx(K,{open:A,onClose:()=>{p(!1),x(null)},onConfirm:B,title:"Eliminar clasificador",message:n?`¿Esta seguro de eliminar el clasificador "${n.codigo} — ${n.nombre}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:y.isPending})]})}export{le as default};
