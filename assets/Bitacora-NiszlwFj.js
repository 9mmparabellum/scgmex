import{j as e}from"./index-XMS3ptau.js";import{b as i}from"./vendor-DEA9Ikep.js";import{u as B,B as m}from"./Button-C8ez2Pht.js";import{D as R}from"./DataTable-F2qfoK4c.js";import{M as O}from"./Modal-DusHWMZs.js";import{S as w}from"./Select-B3Vb87eG.js";import{B as k}from"./Badge-D6mKUURH.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const I="bitacora",L=[{value:"INSERT",label:"INSERT"},{value:"UPDATE",label:"UPDATE"},{value:"DELETE",label:"DELETE"}],D={INSERT:"success",UPDATE:"info",DELETE:"danger"};function E(t){return t?new Date(t).toLocaleString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--"}function y(t){if(!t)return null;try{const l=typeof t=="string"?JSON.parse(t):t;return JSON.stringify(l,null,2)}catch{return String(t)}}function M(t){if(!t)return"--";const l=String(t);return l.length<=12?l:l.slice(0,8)+"..."}const H=[{key:"created_at",label:"Fecha / Hora",width:"180px",render:t=>e.jsx("span",{className:"text-xs font-mono text-text-secondary",children:E(t)})},{key:"usuario_email",label:"Usuario",render:t=>t||"--"},{key:"accion",label:"Accion",width:"120px",render:t=>e.jsx(k,{variant:D[t]||"default",children:t||"--"})},{key:"tabla",label:"Tabla",width:"180px",render:t=>e.jsx("span",{className:"font-mono text-xs text-text-secondary",children:t||"--"})},{key:"registro_id",label:"Registro ID",width:"140px",render:t=>e.jsx("span",{className:"font-mono text-xs text-text-muted",title:String(t||""),children:M(t)})}];function K(){const{data:t=[],isLoading:l}=B(I,{order:{column:"created_at",ascending:!1}}),[n,u]=i.useState(""),[o,h]=i.useState(""),[c,p]=i.useState(""),[d,f]=i.useState(""),[r,g]=i.useState(null),[S,b]=i.useState(!1),T=i.useMemo(()=>[...new Set(t.map(a=>a.tabla).filter(Boolean))].sort().map(a=>({value:a,label:a})),[t]),j=i.useMemo(()=>{let s=t;if(n&&(s=s.filter(a=>a.tabla===n)),o&&(s=s.filter(a=>a.accion===o)),c){const a=new Date(c);a.setHours(0,0,0,0),s=s.filter(x=>new Date(x.created_at)>=a)}if(d){const a=new Date(d);a.setHours(23,59,59,999),s=s.filter(x=>new Date(x.created_at)<=a)}return s},[t,n,o,c,d]),C=s=>{g(s),b(!0)},v=()=>{b(!1),g(null)},A=()=>{u(""),h(""),p(""),f("")},N=n||o||c||d,_=()=>{alert("Funcionalidad de exportacion en desarrollo.")};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Bitacora de Auditoria"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 84-86 â€” Registro completo de operaciones del sistema"})]}),e.jsxs(m,{variant:"ghost",onClick:_,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Exportar"]})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end",children:[e.jsx(w,{label:"Tabla",placeholder:"Todas las tablas",options:T,value:n,onChange:s=>u(s.target.value)}),e.jsx(w,{label:"Accion",placeholder:"Todas las acciones",options:L,value:o,onChange:s=>h(s.target.value)}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Fecha desde"}),e.jsx("input",{type:"date",value:c,onChange:s=>p(s.target.value),className:"block w-full h-[40px] rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda transition-all duration-150"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Fecha hasta"}),e.jsx("input",{type:"date",value:d,onChange:s=>f(s.target.value),className:"block w-full h-[40px] rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda transition-all duration-150"})]}),e.jsx("div",{className:"flex items-end",children:N&&e.jsx(m,{variant:"ghost",size:"sm",onClick:A,children:"Limpiar filtros"})})]}),N&&e.jsxs("div",{className:"mt-3 text-xs text-text-muted",children:["Mostrando ",j.length," de ",t.length," registros"]})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:l?e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-3 text-sm text-text-muted",children:"Cargando bitacora..."})]}):e.jsx(R,{columns:H,data:j,onRowClick:C})}),e.jsx(O,{open:S,onClose:v,title:"Detalle de Registro",size:"lg",children:r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted uppercase tracking-wider mb-1",children:"Fecha y Hora"}),e.jsx("p",{className:"text-sm text-text-primary font-mono",children:E(r.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted uppercase tracking-wider mb-1",children:"Usuario"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.usuario_email||"--"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted uppercase tracking-wider mb-1",children:"Accion"}),e.jsx(k,{variant:D[r.accion]||"default",children:r.accion||"--"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted uppercase tracking-wider mb-1",children:"Tabla"}),e.jsx("p",{className:"text-sm text-text-primary font-mono",children:r.tabla||"--"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted uppercase tracking-wider mb-1",children:"Registro ID"}),e.jsx("p",{className:"text-sm text-text-primary font-mono",children:r.registro_id||"--"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted uppercase tracking-wider mb-2",children:"Datos Anteriores"}),r.datos_anteriores?e.jsx("pre",{className:"bg-bg-hover rounded-md p-3 text-xs text-text-secondary font-mono overflow-x-auto max-h-60 overflow-y-auto",children:e.jsx("code",{children:y(r.datos_anteriores)})}):e.jsx("p",{className:"text-sm text-text-muted italic",children:"Sin datos anteriores"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted uppercase tracking-wider mb-2",children:"Datos Nuevos"}),r.datos_nuevos?e.jsx("pre",{className:"bg-bg-hover rounded-md p-3 text-xs text-text-secondary font-mono overflow-x-auto max-h-60 overflow-y-auto",children:e.jsx("code",{children:y(r.datos_nuevos)})}):e.jsx("p",{className:"text-sm text-text-muted italic",children:"Sin datos nuevos"})]}),e.jsx("div",{className:"flex justify-end pt-2 border-t border-border",children:e.jsx(m,{variant:"ghost",onClick:v,children:"Cerrar"})})]})})]})}export{K as default};
