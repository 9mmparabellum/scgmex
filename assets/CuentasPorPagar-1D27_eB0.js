import{u as J,j as e}from"./index-KskWbqO9.js";import{b as n}from"./vendor-DEA9Ikep.js";import{useCreate as K,useUpdate as Q,useRemove as W}from"./useCrud-C19KmPO4.js";import{e as Y,f as Z}from"./useTesoreria-DkIxWvUV.js";import{D as ee}from"./DataTable-DWljaDCm.js";import{M as O}from"./Modal-DfjuYvxB.js";import{B as i}from"./Button-DGu3eAys.js";import{I as l}from"./Input-CHoXOb6x.js";import{S as ae}from"./Select-k3R1vLiz.js";import{B as te}from"./Badge-B4UqNpVe.js";import{C as oe}from"./ConfirmDialog-D5TWhe0q.js";import{e as ne}from"./exportHelpers-CvXmrB4L.js";import{a3 as N}from"./constants-CX_We7cr.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const f=b=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(b||0),R=()=>new Date().toISOString().split("T")[0],A={numero_documento:"",acreedor:"",concepto:"",monto_original:"",fecha_recepcion:R(),fecha_vencimiento:"",estado:"pendiente"};function _e(){const{entePublico:b,ejercicioFiscal:q}=J(),[F,d]=n.useState(!1),[x,P]=n.useState(null),[o,j]=n.useState({...A}),[V,_]=n.useState(!1),[m,y]=n.useState(null),[T,g]=n.useState(!1),[c,h]=n.useState(null),[u,p]=n.useState(""),{data:v=[],isLoading:I}=Y(),k=K("cuenta_por_pagar"),S=Q("cuenta_por_pagar"),E=W("cuenta_por_pagar"),C=Z(),w=n.useMemo(()=>Object.entries(N).map(([a,t])=>({value:a,label:t.label})),[]),s=(a,t)=>j(r=>({...r,[a]:t})),z=()=>{P(null),j({...A,fecha_recepcion:R()}),d(!0)},M=a=>{P(a),j({numero_documento:a.numero_documento??"",acreedor:a.acreedor??"",concepto:a.concepto??"",monto_original:a.monto_original??"",fecha_recepcion:a.fecha_recepcion??"",fecha_vencimiento:a.fecha_vencimiento??"",estado:a.estado??"pendiente"}),d(!0)},B=async()=>{const a={...o,ente_id:b?.id,ejercicio_id:q?.id,monto_original:Number(o.monto_original)||0};x?await S.mutateAsync({id:x.id,...a}):await k.mutateAsync(a),d(!1)},X=a=>{y(a),_(!0)},$=async()=>{m&&await E.mutateAsync(m.id),_(!1),y(null)},G=a=>{h(a),p(""),g(!0)},L=async()=>{c&&u&&await C.mutateAsync({cxpId:c.id,montoPago:Number(u)}),g(!1),h(null),p("")},U=()=>{ne(v,[{key:"numero_documento",label:"No. Documento"},{key:"acreedor",label:"Acreedor"},{key:"concepto",label:"Concepto"},{key:"monto_original",label:"Monto Original",getValue:t=>Number(t.monto_original||0)},{key:"monto_pagado",label:"Monto Pagado",getValue:t=>Number(t.monto_pagado||0)},{key:"saldo_pendiente",label:"Saldo Pendiente",getValue:t=>Number(t.saldo_pendiente||0)},{key:"fecha_recepcion",label:"Fecha Recepcion"},{key:"fecha_vencimiento",label:"Fecha Vencimiento"},{key:"estado",label:"Estado",getValue:t=>N[t.estado]?.label||t.estado}],"cuentas_por_pagar")},H=[{key:"numero_documento",label:"No. Documento",width:"130px"},{key:"acreedor",label:"Acreedor"},{key:"concepto",label:"Concepto"},{key:"monto_original",label:"Monto Original",width:"140px",render:a=>e.jsx("span",{className:"text-right block tabular-nums",children:f(a)})},{key:"monto_pagado",label:"Pagado",width:"130px",render:a=>e.jsx("span",{className:"text-right block tabular-nums",children:f(a)})},{key:"saldo_pendiente",label:"Saldo Pendiente",width:"140px",render:a=>e.jsx("span",{className:"text-right block tabular-nums font-bold",children:f(a)})},{key:"fecha_recepcion",label:"Recepcion",width:"110px"},{key:"fecha_vencimiento",label:"Vencimiento",width:"110px"},{key:"estado",label:"Estado",width:"120px",render:a=>{const t=N[a];return e.jsx(te,{variant:t?.variant||"default",children:t?.label||a})}},{key:"id",label:"Acciones",width:"200px",sortable:!1,render:(a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[(t.estado==="pendiente"||t.estado==="parcial")&&e.jsx("button",{onClick:r=>{r.stopPropagation(),G(t)},className:"text-xs text-success hover:text-success/80 transition-colors cursor-pointer",children:"Pagar"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),M(t)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),X(t)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],D=k.isPending||S.isPending;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Cuentas por Pagar"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Control de cuentas por pagar del ente publico"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Cuentas por Pagar",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",v.length," registros)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{onClick:U,variant:"outline-primary",size:"sm",children:"Exportar Excel"}),e.jsx(i,{onClick:z,size:"sm",children:"+ Nueva CxP"})]})]}),I?e.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando cuentas por pagar..."}):e.jsx(ee,{columns:H,data:v,onRowClick:M}),e.jsx(O,{open:F,onClose:()=>d(!1),title:x?"Editar Cuenta por Pagar":"Nueva Cuenta por Pagar",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{label:"No. Documento",value:o.numero_documento,onChange:a=>s("numero_documento",a.target.value),placeholder:"Ej. CXP-001",required:!0}),e.jsx(ae,{label:"Estado",value:o.estado,onChange:a=>s("estado",a.target.value),options:w,placeholder:"— Seleccione estado —",required:!0})]}),e.jsx(l,{label:"Acreedor",value:o.acreedor,onChange:a=>s("acreedor",a.target.value),placeholder:"Nombre del acreedor o proveedor",required:!0}),e.jsx(l,{label:"Concepto",value:o.concepto,onChange:a=>s("concepto",a.target.value),placeholder:"Concepto de la cuenta por pagar",required:!0}),e.jsx(l,{label:"Monto Original",type:"number",value:o.monto_original,onChange:a=>s("monto_original",a.target.value),placeholder:"0.00",required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{label:"Fecha Recepcion",type:"date",value:o.fecha_recepcion,onChange:a=>s("fecha_recepcion",a.target.value),required:!0}),e.jsx(l,{label:"Fecha Vencimiento",type:"date",value:o.fecha_vencimiento,onChange:a=>s("fecha_vencimiento",a.target.value),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[e.jsx(i,{variant:"ghost",onClick:()=>d(!1),disabled:D,children:"Cancelar"}),e.jsx(i,{onClick:B,loading:D,disabled:!o.numero_documento.trim()||!o.acreedor.trim()||!o.monto_original,children:x?"Guardar cambios":"Crear cuenta"})]})]})}),e.jsx(O,{open:T,onClose:()=>{g(!1),h(null),p("")},title:"Registrar Pago",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[c&&e.jsxs("div",{className:"bg-[#f9fafb] rounded-lg p-3 space-y-1",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:[e.jsx("span",{className:"font-medium",children:"Documento:"})," ",c.numero_documento]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[e.jsx("span",{className:"font-medium",children:"Acreedor:"})," ",c.acreedor]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[e.jsx("span",{className:"font-medium",children:"Saldo pendiente:"})," ",e.jsx("span",{className:"font-bold",children:f(c.saldo_pendiente)})]})]}),e.jsx(l,{label:"Monto a Pagar",type:"number",value:u,onChange:a=>p(a.target.value),placeholder:"0.00",required:!0}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[e.jsx(i,{variant:"ghost",onClick:()=>{g(!1),h(null),p("")},disabled:C.isPending,children:"Cancelar"}),e.jsx(i,{onClick:L,loading:C.isPending,disabled:!u||Number(u)<=0,children:"Registrar Pago"})]})]})}),e.jsx(oe,{open:V,onClose:()=>{_(!1),y(null)},onConfirm:$,title:"Eliminar cuenta por pagar",message:m?`¿Esta seguro de eliminar la cuenta "${m.numero_documento} — ${m.acreedor}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:E.isPending})]})}export{_e as default};
