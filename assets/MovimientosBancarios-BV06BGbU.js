import{u as R,j as t}from"./index-KskWbqO9.js";import{b as i}from"./vendor-DEA9Ikep.js";import{useCreate as V}from"./useCrud-C19KmPO4.js";import{a as q,b as A}from"./useTesoreria-DkIxWvUV.js";import{a1 as j}from"./constants-CX_We7cr.js";import{D as L}from"./DataTable-DWljaDCm.js";import{M as P}from"./Modal-DfjuYvxB.js";import{B as d}from"./Button-DGu3eAys.js";import{I as m}from"./Input-CHoXOb6x.js";import{S as y}from"./Select-k3R1vLiz.js";import{B as N}from"./Badge-B4UqNpVe.js";import{e as $}from"./exportHelpers-CvXmrB4L.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const C=u=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(u||0),x={fecha:new Date().toISOString().split("T")[0],referencia:"",concepto:"",tipo:"deposito",monto:""};function se(){const{periodoContable:u}=R(),[s,M]=i.useState(""),h=u?.id||null,[k,r]=i.useState(!1),[o,p]=i.useState({...x}),{data:b=[],isLoading:S}=q(),{data:l=[],isLoading:w}=A(s||null,h),f=V("movimiento_bancario"),_=i.useMemo(()=>b.map(e=>({value:e.id,label:`${e.numero_cuenta} — ${e.banco}`})),[b]),B=i.useMemo(()=>j.map(e=>({value:e.key,label:e.label})),[]),n=(e,a)=>p(c=>({...c,[e]:a})),v=e=>{const a=j.find(c=>c.key===e);return a?a.label:e},I=e=>({deposito:"success",retiro:"danger",transferencia:"info",comision:"warning",interes:"primary",otro:"default"})[e]||"default",O=e=>e==="deposito"||e==="interes"?"text-green-600":e==="retiro"||e==="comision"?"text-red-600":"",z=()=>{p({...x,fecha:new Date().toISOString().split("T")[0]}),r(!0)},T=async()=>{await f.mutateAsync({cuenta_bancaria_id:s,periodo_id:h,...o,monto:Number(o.monto)||0}),r(!1),p({...x,fecha:new Date().toISOString().split("T")[0]})},D=()=>{$(l,[{key:"fecha",label:"Fecha"},{key:"referencia",label:"Referencia"},{key:"concepto",label:"Concepto"},{key:"tipo",label:"Tipo",getValue:a=>v(a.tipo)},{key:"monto",label:"Monto",getValue:a=>Number(a.monto||0)},{key:"saldo_despues",label:"Saldo Despues",getValue:a=>Number(a.saldo_despues||0)},{key:"conciliado",label:"Conciliado",getValue:a=>a.conciliado?"Si":"No"},{key:"poliza_numero",label:"Poliza"}],"movimientos_bancarios")},E=[{key:"fecha",label:"Fecha",width:"110px"},{key:"referencia",label:"Referencia",width:"130px"},{key:"concepto",label:"Concepto"},{key:"tipo",label:"Tipo",width:"130px",render:e=>t.jsx(N,{variant:I(e),children:v(e)})},{key:"monto",label:"Monto",width:"140px",render:(e,a)=>t.jsx("span",{className:`text-right block tabular-nums font-semibold ${O(a.tipo)}`,children:C(e)})},{key:"saldo_despues",label:"Saldo Despues",width:"150px",render:e=>t.jsx("span",{className:"text-right block tabular-nums",children:C(e)})},{key:"conciliado",label:"Conciliado",width:"110px",render:e=>t.jsx(N,{variant:e?"success":"default",children:e?"Si":"No"})},{key:"poliza_numero",label:"Poliza",width:"100px",render:(e,a)=>e||a.poliza_id?t.jsx("span",{className:"text-xs text-info font-medium",children:e||"Ver"}):t.jsx("span",{className:"text-xs text-text-muted",children:"—"})}],g=f.isPending,F=S||s&&w;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Movimientos Bancarios"}),t.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Registro y consulta de movimientos por cuenta bancaria"})]}),t.jsx("div",{className:"bg-white rounded-lg card-shadow p-5 mb-6",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[t.jsx("div",{className:"md:col-span-2",children:t.jsx(y,{label:"Cuenta Bancaria",value:s,onChange:e=>M(e.target.value),options:_,placeholder:"-- Seleccione una cuenta bancaria --"})}),t.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[t.jsx(d,{onClick:D,variant:"outline-primary",size:"sm",disabled:!s||l.length===0,children:"Exportar Excel"}),t.jsx(d,{onClick:z,size:"sm",disabled:!s,children:"+ Nuevo Movimiento"})]})]})}),s&&t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Movimientos",t.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",l.length," registros)"]})]})}),s?F?t.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando movimientos bancarios..."}):t.jsx(L,{columns:E,data:l}):t.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Seleccione una cuenta bancaria para ver sus movimientos"}),t.jsx(P,{open:k,onClose:()=>r(!1),title:"Nuevo Movimiento Bancario",size:"md",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(m,{label:"Fecha",type:"date",value:o.fecha,onChange:e=>n("fecha",e.target.value),required:!0}),t.jsx(y,{label:"Tipo de Movimiento",value:o.tipo,onChange:e=>n("tipo",e.target.value),options:B,placeholder:"-- Seleccione tipo --",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(m,{label:"Referencia",value:o.referencia,onChange:e=>n("referencia",e.target.value),placeholder:"No. de cheque, transferencia, etc."}),t.jsx(m,{label:"Monto",type:"number",value:o.monto,onChange:e=>n("monto",e.target.value),placeholder:"0.00",required:!0})]}),t.jsx(m,{label:"Concepto",value:o.concepto,onChange:e=>n("concepto",e.target.value),placeholder:"Descripcion del movimiento",required:!0}),t.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[t.jsx(d,{variant:"ghost",onClick:()=>r(!1),disabled:g,children:"Cancelar"}),t.jsx(d,{onClick:T,loading:g,disabled:!o.tipo||!o.monto||!o.fecha,children:"Guardar movimiento"})]})]})})]})}export{se as default};
