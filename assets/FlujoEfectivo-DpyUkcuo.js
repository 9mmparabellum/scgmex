import{u as y,j as e}from"./index-FiQ-o0as.js";import{b as d}from"./vendor-DEA9Ikep.js";import{useList as _}from"./useCrud--Epse75Z.js";import{g as w}from"./useTesoreria-B6co7fo0.js";import{D as k}from"./DataTable-BIXgbPbQ.js";import{B as E}from"./Button-CjklDnap.js";import{S}from"./Select-DaQh9AUa.js";import{B as T}from"./Badge-7Bgbyuqr.js";import{e as C}from"./exportHelpers-CvXmrB4L.js";import{a4 as x}from"./constants-CX_We7cr.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const o=i=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(i||0);function X(){const{ejercicioFiscal:i}=y(),[c,h]=d.useState(""),{data:u=[]}=_("periodo_contable",{filter:{ejercicio_id:i?.id},order:{column:"numero",ascending:!0}}),g=d.useMemo(()=>u.map(t=>({value:t.id,label:t.nombre||`Periodo ${t.numero}`})),[u]),{data:r=[],isLoading:b}=w(c),m=d.useMemo(()=>{const t={};return Object.keys(x).forEach(s=>{t[s]=[]}),r.forEach(s=>{const a=s.categoria;t[a]?t[a].push(s):(t._otros||(t._otros=[]),t._otros.push(s))}),t},[r]),j=d.useMemo(()=>{const t={};return Object.entries(m).forEach(([s,a])=>{t[s]=a.reduce((l,p)=>({entradas:l.entradas+(p.monto_entrada||0),salidas:l.salidas+(p.monto_salida||0)}),{entradas:0,salidas:0}),t[s].neto=t[s].entradas-t[s].salidas}),t},[m]),n=d.useMemo(()=>{const t=r.reduce((s,a)=>({entradas:s.entradas+(a.monto_entrada||0),salidas:s.salidas+(a.monto_salida||0)}),{entradas:0,salidas:0});return t.neto=t.entradas-t.salidas,t},[r]),f=[{key:"concepto",label:"Concepto"},{key:"monto_entrada",label:"Entradas",width:"160px",render:t=>e.jsx("span",{className:"text-right block tabular-nums text-green-600",children:o(t)})},{key:"monto_salida",label:"Salidas",width:"160px",render:t=>e.jsx("span",{className:"text-right block tabular-nums text-red-600",children:o(t)})},{key:"neto",label:"Neto",width:"160px",render:(t,s)=>{const a=(s.monto_entrada||0)-(s.monto_salida||0);return e.jsx("span",{className:`text-right block tabular-nums font-bold ${a>=0?"text-green-600":"text-red-600"}`,children:o(a)})}}],N=()=>{C(r,[{key:"categoria",label:"Categoria",getValue:s=>x[s.categoria]?.label||s.categoria},{key:"concepto",label:"Concepto"},{key:"monto_entrada",label:"Entradas",getValue:s=>Number(s.monto_entrada||0)},{key:"monto_salida",label:"Salidas",getValue:s=>Number(s.monto_salida||0)},{key:"neto",label:"Neto",getValue:s=>Number(s.monto_entrada||0)-Number(s.monto_salida||0)}],"flujo_efectivo")},v=Object.entries(x);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Flujo de Efectivo"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Estado de flujos de efectivo por periodo contable"})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsx(S,{label:"Periodo",placeholder:"Seleccionar periodo...",options:g,value:c,onChange:t=>h(t.target.value)}),e.jsx("div",{}),e.jsx("div",{className:"flex justify-end",children:e.jsx(E,{onClick:N,variant:"outline-primary",size:"sm",disabled:!r.length,children:"Exportar Excel"})})]})}),b?e.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando flujo de efectivo..."}):c?r.length===0?e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"No hay movimientos de flujo de efectivo para este periodo"})}):e.jsxs("div",{className:"space-y-6",children:[v.map(([t,s])=>{const a=m[t]||[],l=j[t]||{entradas:0,salidas:0,neto:0};return a.length===0?null:e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(T,{variant:s.variant,children:s.label}),e.jsxs("span",{className:"text-sm text-text-muted",children:["(",a.length," ",a.length===1?"concepto":"conceptos",")"]})]}),e.jsx(k,{columns:f,data:a}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-border",children:[e.jsxs("span",{className:"text-sm font-semibold text-text-secondary",children:["Subtotal ",s.label]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("span",{className:"text-sm tabular-nums text-green-600",children:o(l.entradas)}),e.jsx("span",{className:"text-sm tabular-nums text-red-600",children:o(l.salidas)}),e.jsx("span",{className:`text-sm tabular-nums font-bold ${l.neto>=0?"text-green-600":"text-red-600"}`,children:o(l.neto)})]})]})]},t)}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Total Entradas"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:o(n.entradas)})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Total Salidas"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:o(n.salidas)})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:"Flujo Neto"}),e.jsx("p",{className:`text-lg font-bold ${n.neto>=0?"text-green-600":"text-red-600"}`,children:o(n.neto)})]})]})]}):e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"Seleccione un periodo para ver el flujo de efectivo"})})]})}export{X as default};
