import{u as q,A as z,j as t}from"./index-KskWbqO9.js";import{b as l}from"./vendor-DEA9Ikep.js";import{a as X}from"./useRecaudacion-BV28gNDk.js";import{useCreate as V,useUpdate as w,useRemove as G}from"./useCrud-C19KmPO4.js";import{A as v}from"./constants-CX_We7cr.js";import{D as L}from"./DataTable-DWljaDCm.js";import{M as Y}from"./Modal-DfjuYvxB.js";import{B as m}from"./Button-DGu3eAys.js";import{I as n}from"./Input-CHoXOb6x.js";import{S as N}from"./Select-k3R1vLiz.js";import{B as $}from"./Badge-B4UqNpVe.js";import{C as H}from"./ConfirmDialog-D5TWhe0q.js";import{e as J}from"./exportHelpers-CvXmrB4L.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const k={nombre:"",rfc:"",curp:"",tipo:"persona_fisica",domicilio:"",telefono:"",email:"",activo:!0};function me(){const{entePublico:S,rol:T}=q(),u=z(T,"recaudacion"),[A,s]=l.useState(!1),[c,g]=l.useState(null),[o,p]=l.useState({...k}),[P,x]=l.useState(!1),[d,b]=l.useState(null),{data:f=[],isLoading:D}=X(),h=V("contribuyente"),y=w("contribuyente"),C=G("contribuyente"),R=l.useMemo(()=>Object.entries(v).map(([e,i])=>({value:e,label:i})),[]),O=[{value:"true",label:"Activo"},{value:"false",label:"Inactivo"}],a=(e,i)=>p(r=>({...r,[e]:i})),M=()=>{g(null),p({...k}),s(!0)},j=e=>{g(e),p({nombre:e.nombre??"",rfc:e.rfc??"",curp:e.curp??"",tipo:e.tipo??"persona_fisica",domicilio:e.domicilio??"",telefono:e.telefono??"",email:e.email??"",activo:e.activo??!0}),s(!0)},I=async()=>{const e={...o,ente_id:S?.id,activo:o.activo===!0||o.activo==="true"};c?await y.mutateAsync({id:c.id,...e}):await h.mutateAsync(e),s(!1)},B=e=>{b(e),x(!0)},F=async()=>{d&&await C.mutateAsync(d.id),x(!1),b(null)},U=()=>{J(f,[{key:"rfc",label:"RFC"},{key:"nombre",label:"Nombre"},{key:"curp",label:"CURP"},{key:"tipo",label:"Tipo",getValue:i=>v[i.tipo]||i.tipo},{key:"domicilio",label:"Domicilio"},{key:"telefono",label:"Telefono"},{key:"email",label:"Email"},{key:"activo",label:"Estado",getValue:i=>i.activo?"Activo":"Inactivo"}],"contribuyentes")},_=l.useMemo(()=>[{key:"rfc",label:"RFC",width:"140px"},{key:"nombre",label:"Nombre"},{key:"tipo",label:"Tipo",width:"150px",render:e=>v[e]||e},{key:"telefono",label:"Telefono",width:"130px"},{key:"email",label:"Email",width:"180px"},{key:"activo",label:"Activo",width:"100px",render:e=>t.jsx($,{variant:e?"success":"default",children:e?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,i)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:r=>{r.stopPropagation(),j(i)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),u&&t.jsx("button",{onClick:r=>{r.stopPropagation(),B(i)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],[u]),E=h.isPending||y.isPending;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Contribuyentes"}),t.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Padron de contribuyentes del ente publico"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Contribuyentes",t.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",f.length," registros)"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(m,{onClick:U,variant:"outline-primary",size:"sm",children:"Exportar Excel"}),u&&t.jsx(m,{onClick:M,size:"sm",children:"+ Nuevo Contribuyente"})]})]}),D?t.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando contribuyentes..."}):t.jsx(L,{columns:_,data:f,onRowClick:j}),t.jsx(Y,{open:A,onClose:()=>s(!1),title:c?"Editar Contribuyente":"Nuevo Contribuyente",size:"lg",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(n,{label:"Nombre",value:o.nombre,onChange:e=>a("nombre",e.target.value),placeholder:"Nombre completo o razon social",required:!0}),t.jsx(n,{label:"RFC",value:o.rfc,onChange:e=>a("rfc",e.target.value),placeholder:"Ej. XAXX010101000",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(n,{label:"CURP",value:o.curp,onChange:e=>a("curp",e.target.value),placeholder:"CURP (opcional)"}),t.jsx(N,{label:"Tipo de Contribuyente",value:o.tipo,onChange:e=>a("tipo",e.target.value),options:R,placeholder:"-- Seleccione tipo --",required:!0})]}),t.jsx(n,{label:"Domicilio",value:o.domicilio,onChange:e=>a("domicilio",e.target.value),placeholder:"Direccion completa"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(n,{label:"Telefono",value:o.telefono,onChange:e=>a("telefono",e.target.value),placeholder:"Ej. 55 1234 5678"}),t.jsx(n,{label:"Email",type:"email",value:o.email,onChange:e=>a("email",e.target.value),placeholder:"correo@ejemplo.com"})]}),t.jsx(N,{label:"Estado",value:String(o.activo),onChange:e=>a("activo",e.target.value),options:O,placeholder:"-- Seleccione estado --",required:!0}),t.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[t.jsx(m,{variant:"ghost",onClick:()=>s(!1),disabled:E,children:"Cancelar"}),t.jsx(m,{onClick:I,loading:E,disabled:!o.nombre.trim()||!o.rfc.trim(),children:c?"Guardar cambios":"Crear contribuyente"})]})]})}),t.jsx(H,{open:P,onClose:()=>{x(!1),b(null)},onConfirm:F,title:"Eliminar contribuyente",message:d?`Â¿Esta seguro de eliminar al contribuyente "${d.nombre}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:C.isPending})]})}export{me as default};
