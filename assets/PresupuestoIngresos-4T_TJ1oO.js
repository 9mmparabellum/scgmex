import{u as g,j as e}from"./index-XMS3ptau.js";import{b as i}from"./vendor-DEA9Ikep.js";import{u as N,B as k}from"./Button-C8ez2Pht.js";import{a as v,c as w}from"./usePresupuesto-D0jypDL9.js";import{b as a}from"./constants-B9IYjURH.js";import{e as C}from"./exportHelpers-CvXmrB4L.js";import{S as E}from"./Select-B3Vb87eG.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const d=c=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(c||0);function V(){const{ejercicioFiscal:c}=g(),[m,p]=i.useState(""),{data:x=[]}=N("periodo_contable",{filter:{ejercicio_id:c?.id}}),{data:l={},isLoading:h}=v(),{data:o=[],isLoading:u}=w(),y=i.useMemo(()=>x.map(t=>({value:t.id,label:t.nombre||t.clave})),[x]),n=i.useMemo(()=>{const t={};return a.forEach(s=>{t[s.key]=0}),o.forEach(s=>{a.forEach(r=>{t[r.key]+=Number(s.totales?.[r.key]||0)})}),t},[o]),f=i.useMemo(()=>{const t=l&&Object.keys(l).length>0?l:n;return a.map(s=>({key:s.key,label:s.label,amount:Number(t[s.key]||0)}))},[l,n]),b=()=>{const t=[{key:"clave",label:"Clave"},{key:"descripcion",label:"Descripcion"},{key:"clasificador",label:"Clasificador",getValue:s=>s.clasificador?`${s.clasificador.codigo} ${s.clasificador.nombre}`:""},...a.map(s=>({key:s.key,label:s.label,getValue:r=>Number(r.totales?.[s.key]||0)}))];C(o,t,"presupuesto_ingresos")},j=h||u;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Presupuesto de Ingresos"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Resumen del presupuesto de ingresos por momento contable"})]}),e.jsx("div",{className:"mb-6 max-w-xs",children:e.jsx(E,{label:"Periodo contable",value:m,onChange:t=>p(t.target.value),options:y,placeholder:"— Todos los periodos —"})}),j?e.jsxs("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Cargando presupuesto de ingresos..."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:f.map(t=>e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:t.label}),e.jsx("p",{className:"text-lg font-bold text-text-primary",children:d(t.amount)})]},t.key))}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Conceptos de Ingreso",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",o.length," registros)"]})]}),e.jsx(k,{onClick:b,variant:"outline-primary",size:"sm",children:"Exportar Excel"})]}),o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-text-muted",children:[e.jsxs("svg",{className:"w-10 h-10 text-text-muted/50 mb-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]}),e.jsx("p",{className:"text-[0.9375rem]",children:"No hay conceptos registrados"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#f9fafb]",children:[e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"100px"},children:"Clave"}),e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Descripcion"}),e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"200px"},children:"Clasificador"}),a.map(t=>e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",style:{width:"130px"},children:t.label},t.key))]})}),e.jsx("tbody",{children:o.map((t,s)=>e.jsxs("tr",{className:"border-b border-[#f0f0f0] last:border-0 hover:bg-[#f9fafb] transition-colors",children:[e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary",children:t.clave}),e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary",children:t.descripcion}),e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary",children:t.clasificador?`${t.clasificador.codigo} ${t.clasificador.nombre}`:"—"}),a.map(r=>e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary text-right tabular-nums",children:d(t.totales?.[r.key])},r.key))]},t.id??s))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-[#f9fafb] border-t-2 border-border font-semibold",children:[e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary",colSpan:3,children:"Total"}),a.map(t=>e.jsx("td",{className:"px-5 py-3.5 text-[0.9375rem] text-text-primary text-right tabular-nums",children:d(n[t.key])},t.key))]})})]})})]})]})]})}export{V as default};
