import{u as z,l as k,j as e}from"./index-BS2M8vvb.js";import{b as x}from"./vendor-DEA9Ikep.js";import{u as _,B as b}from"./Button-BxEPlTzl.js";import{S as w}from"./Select-DkUTgNBS.js";import{B as M}from"./Badge-1mTsSGYt.js";import{e as L}from"./exportHelpers-CvXmrB4L.js";import{e as C}from"./exportPdfHelpers-A3uAR0yr.js";import{f as p}from"./polizaHelpers-DSRoDnth.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const l=m=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(m||0);function T(){const{entePublico:m,ejercicioFiscal:u}=z(),[c,f]=x.useState(""),{data:h=[]}=_("periodo_contable",{filter:{ejercicio_id:u?.id},order:{column:"numero",ascending:!0}}),j=x.useMemo(()=>h.map(t=>({value:t.id,label:t.nombre||`Periodo ${t.numero}`})),[h]),{data:d=[],isLoading:y}=k(c),i=x.useMemo(()=>{const t={};return d.forEach(a=>{const r=a.cuenta_id;t[r]||(t[r]={codigo:a.plan_de_cuentas?.codigo||"",nombre:a.plan_de_cuentas?.nombre||"",naturaleza:a.plan_de_cuentas?.naturaleza||"deudora",movimientos:[]}),t[r].movimientos.push(a)}),Object.values(t).sort((a,r)=>a.codigo.localeCompare(r.codigo))},[d]),g=()=>{const t=[];i.forEach(a=>{let r=0;a.movimientos.forEach(o=>{r+=a.naturaleza==="deudora"?(o.debe||0)-(o.haber||0):(o.haber||0)-(o.debe||0),t.push({cuenta:a.codigo,nombre_cuenta:a.nombre,fecha:o.poliza?.fecha||"",poliza:o.poliza?p(o.poliza.tipo,o.poliza.numero_poliza):"",concepto:o.concepto||"",debe:o.debe||0,haber:o.haber||0,saldo:r})})}),L(t,[{key:"cuenta",label:"Cuenta"},{key:"nombre_cuenta",label:"Nombre"},{key:"fecha",label:"Fecha"},{key:"poliza",label:"Poliza"},{key:"concepto",label:"Concepto"},{key:"debe",label:"Debe"},{key:"haber",label:"Haber"},{key:"saldo",label:"Saldo"}],"libro_mayor")},N=()=>{const t=[];i.forEach(a=>{let r=0;a.movimientos.forEach(o=>{r+=a.naturaleza==="deudora"?(o.debe||0)-(o.haber||0):(o.haber||0)-(o.debe||0),t.push({cuenta:a.codigo,nombre_cuenta:a.nombre,fecha:o.poliza?.fecha||"",poliza:o.poliza?p(o.poliza.tipo,o.poliza.numero_poliza):"",concepto:o.concepto||"",debe:o.debe||0,haber:o.haber||0,saldo:r})})}),C(t,[{key:"cuenta",label:"Cuenta"},{key:"nombre_cuenta",label:"Nombre"},{key:"fecha",label:"Fecha"},{key:"poliza",label:"Poliza"},{key:"concepto",label:"Concepto"},{key:"debe",label:"Debe"},{key:"haber",label:"Haber"},{key:"saldo",label:"Saldo"}],"libro_mayor",{title:"Libro Mayor"})};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Libro Mayor"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 37 — Movimientos agrupados por cuenta contable"})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsx(w,{label:"Periodo",placeholder:"Seleccionar periodo...",options:j,value:c,onChange:t=>f(t.target.value)}),e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end",children:[e.jsxs(b,{variant:"ghost",onClick:g,disabled:!d?.length,children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar XLSX"]}),e.jsxs(b,{variant:"ghost",onClick:N,disabled:!d?.length,children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Exportar PDF"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary mb-4",children:["Libro Mayor"," ",e.jsxs("span",{className:"text-text-muted font-normal",children:["(",i.length," cuentas)"]})]}),y?e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"Cargando libro mayor..."}):c?i.length===0?e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"No hay movimientos en este periodo"}):e.jsx("div",{className:"space-y-4",children:i.map((t,a)=>{let r=0;const o=t.movimientos.reduce((s,n)=>s+(n.debe||0),0),v=t.movimientos.reduce((s,n)=>s+(n.haber||0),0);return e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-[#f9fafb] px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-semibold",children:t.codigo}),e.jsx("span",{className:"text-sm text-text-secondary",children:t.nombre})]}),e.jsx(M,{variant:t.naturaleza==="deudora"?"info":"warning",children:t.naturaleza})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-xs text-text-muted uppercase",children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Fecha"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Poliza"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Concepto"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Debe"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Haber"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Saldo"})]})}),e.jsx("tbody",{children:t.movimientos.map((s,n)=>(t.naturaleza==="deudora"?r+=(s.debe||0)-(s.haber||0):r+=(s.haber||0)-(s.debe||0),e.jsxs("tr",{className:"border-t border-[#f0f0f0]",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-text-muted",children:s.poliza?.fecha?new Date(s.poliza.fecha).toLocaleDateString("es-MX"):"—"}),e.jsx("td",{className:"px-4 py-2 text-sm font-mono text-primary",children:s.poliza?p(s.poliza.tipo,s.poliza.numero_poliza):"—"}),e.jsx("td",{className:"px-4 py-2 text-sm",children:s.concepto||s.poliza?.descripcion||"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:s.debe>0?l(s.debe):""}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:s.haber>0?l(s.haber):""}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono font-semibold",children:l(r)})]},n)))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t border-border bg-[#f9fafb] font-semibold",children:[e.jsx("td",{colSpan:3,className:"px-4 py-2 text-sm text-right",children:"Totales:"}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:l(o)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:l(v)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right font-mono",children:l(r)})]})})]})]},a)})}):e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"Seleccione un periodo para ver el libro mayor"})]})]})}export{T as default};
