import{u as w,j as e}from"./index-KskWbqO9.js";import{g as k,c as _,b as o}from"./vendor-DEA9Ikep.js";import{b as C,c as E}from"./useConciliacion-Bs8QTPu3.js";import{l as L}from"./constants-CX_We7cr.js";import{B as j}from"./Button-DGu3eAys.js";import{B as x}from"./Badge-B4UqNpVe.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const a=c=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(c||0);function S(){const{id:c}=k(),m=_(),{user:b}=w(),{data:s,isLoading:g,isError:N}=C(c),p=E(),r=s?.detalle||[],i=o.useMemo(()=>r.reduce((t,n)=>({monto_contable:t.monto_contable+(n.monto_contable||0),monto_presupuestal:t.monto_presupuestal+(n.monto_presupuestal||0),diferencia:t.diferencia+(n.diferencia||0)}),{monto_contable:0,monto_presupuestal:0,diferencia:0}),[r]),h=o.useMemo(()=>r.filter(t=>t.tipo==="egreso"),[r]),f=o.useMemo(()=>r.filter(t=>t.tipo==="ingreso"),[r]),l=o.useMemo(()=>h.reduce((t,n)=>({contable:t.contable+(n.monto_contable||0),presupuestal:t.presupuestal+(n.monto_presupuestal||0),diferencia:t.diferencia+(n.diferencia||0)}),{contable:0,presupuestal:0,diferencia:0}),[h]),d=o.useMemo(()=>f.reduce((t,n)=>({contable:t.contable+(n.monto_contable||0),presupuestal:t.presupuestal+(n.monto_presupuestal||0),diferencia:t.diferencia+(n.diferencia||0)}),{contable:0,presupuestal:0,diferencia:0}),[f]),y=async()=>{try{await p.mutateAsync({conciliacionId:c,aprobadoPor:b?.id})}catch{}};if(g)return e.jsx("div",{className:"flex items-center justify-center py-32",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-guinda",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})});if(N||!s)return e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#f5f5f9] flex items-center justify-center text-text-muted",children:e.jsxs("svg",{className:"w-7 h-7",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})})}),e.jsx("h3",{className:"text-[0.9375rem] font-semibold text-text-heading mb-1",children:"Conciliacion no encontrada"}),e.jsx("p",{className:"text-sm text-text-muted max-w-sm mx-auto",children:"No se pudo cargar el detalle de la conciliacion solicitada."}),e.jsx("div",{className:"mt-4",children:e.jsx(j,{variant:"outline-primary",size:"sm",onClick:()=>m(-1),children:"Regresar"})})]})});const u=L[s.estado];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>m(-1),className:"inline-flex items-center justify-center w-9 h-9 rounded-md text-text-secondary hover:bg-bg-hover hover:text-text-heading transition-colors cursor-pointer","aria-label":"Regresar",children:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Detalle de Conciliacion"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:s.periodo?.nombre||"Sin periodo"})]})]}),s.estado!=="aprobado"&&e.jsxs(j,{variant:"success",onClick:y,loading:p.isPending,children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Aprobar"]})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider",children:"Periodo"}),e.jsx("p",{className:"text-sm text-text-primary mt-1",children:s.periodo?.nombre||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider",children:"Fecha Elaboracion"}),e.jsx("p",{className:"text-sm text-text-primary mt-1",children:s.fecha_elaboracion?new Date(s.fecha_elaboracion).toLocaleDateString("es-MX"):"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider",children:"Estado"}),e.jsx("div",{className:"mt-1",children:e.jsx(x,{variant:u?.variant||"default",children:u?.label||s.estado||"—"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider",children:"Elaborado Por"}),e.jsx("p",{className:"text-sm text-text-primary mt-1",children:s.elaborador?.nombre||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider",children:"Aprobado Por"}),e.jsx("p",{className:"text-sm text-text-primary mt-1",children:s.aprobador?.nombre||"—"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider mb-3",children:"Contable"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Total Contable"}),e.jsx("span",{className:"text-sm font-mono font-semibold text-text-primary",children:a(s.total_contable)})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider mb-3",children:"Presupuestal"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Total Pres. Egreso"}),e.jsx("span",{className:"text-sm font-mono font-semibold text-text-primary",children:a(s.total_presupuestal_egreso)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Total Pres. Ingreso"}),e.jsx("span",{className:"text-sm font-mono font-semibold text-text-primary",children:a(s.total_presupuestal_ingreso)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5 mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider mb-3",children:"Resumen de Diferencias"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-4 py-3 bg-[#f9fafb] rounded-lg",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Diferencia Egreso"}),e.jsx("span",{className:`text-sm font-mono font-bold ${(s.diferencia_egreso||0)!==0?"text-[#e0360a]":"text-[#56ca00]"}`,children:a(s.diferencia_egreso)})]}),e.jsxs("div",{className:"flex justify-between items-center px-4 py-3 bg-[#f9fafb] rounded-lg",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Diferencia Ingreso"}),e.jsx("span",{className:`text-sm font-mono font-bold ${(s.diferencia_ingreso||0)!==0?"text-[#e0360a]":"text-[#56ca00]"}`,children:a(s.diferencia_ingreso)})]}),e.jsxs("div",{className:"flex justify-between items-center px-4 py-3 bg-[#f9fafb] rounded-lg",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Diferencia Total"}),e.jsx("span",{className:`text-sm font-mono font-bold ${(i.diferencia||0)!==0?"text-[#e0360a]":"text-[#56ca00]"}`,children:a(i.diferencia)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow overflow-hidden",children:[e.jsx("div",{className:"px-5 py-4 border-b border-border",children:e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Detalle de Partidas"," ",e.jsxs("span",{className:"text-text-muted font-normal",children:["(",r.length," registros)"]})]})}),r.length===0?e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"No hay partidas de detalle para esta conciliacion"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#f9fafb]",children:[e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Tipo"}),e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Cuenta / Partida / Concepto"}),e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Monto Contable"}),e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Monto Presupuestal"}),e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Diferencia"}),e.jsx("th",{className:"text-center text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Conciliado"})]})}),e.jsx("tbody",{children:r.map((t,n)=>{const v=t.tipo==="egreso"?`${t.cuenta?.codigo||""} ${t.cuenta?.nombre||""} / ${t.partida?.clave||""} ${t.partida?.descripcion||""}`:`${t.cuenta?.codigo||""} ${t.cuenta?.nombre||""} / ${t.concepto?.clave||""} ${t.concepto?.descripcion||""}`;return e.jsxs("tr",{className:"border-b border-[#f0f0f0] last:border-0 hover:bg-[#f9fafb] transition-colors",children:[e.jsx("td",{className:"px-5 py-3.5",children:e.jsx(x,{variant:t.tipo==="egreso"?"danger":"success",children:t.tipo==="egreso"?"Egreso":"Ingreso"})}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-text-primary",children:v.trim()||"—"}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:a(t.monto_contable)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:a(t.monto_presupuestal)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:e.jsx("span",{className:`font-semibold ${(t.diferencia||0)!==0?"text-[#e0360a]":"text-text-primary"}`,children:a(t.diferencia)})}),e.jsx("td",{className:"px-5 py-3.5 text-center",children:t.conciliado?e.jsx("svg",{className:"w-5 h-5 text-[#56ca00] mx-auto",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}):e.jsxs("svg",{className:"w-5 h-5 text-text-muted/40 mx-auto",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},t.id??n)})}),e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"bg-[#f9fafb] border-t-2 border-guinda/20",children:[e.jsx("td",{className:"px-5 py-3.5",children:e.jsx(x,{variant:"danger",children:"Egreso"})}),e.jsx("td",{className:"px-5 py-3.5 text-sm font-bold text-right",children:"SUBTOTAL EGRESOS"}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono font-bold",children:a(l.contable)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono font-bold",children:a(l.presupuestal)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono font-bold",children:e.jsx("span",{className:l.diferencia!==0?"text-[#e0360a]":"text-text-primary",children:a(l.diferencia)})}),e.jsx("td",{})]}),e.jsxs("tr",{className:"bg-[#f9fafb]",children:[e.jsx("td",{className:"px-5 py-3.5",children:e.jsx(x,{variant:"success",children:"Ingreso"})}),e.jsx("td",{className:"px-5 py-3.5 text-sm font-bold text-right",children:"SUBTOTAL INGRESOS"}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono font-bold",children:a(d.contable)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono font-bold",children:a(d.presupuestal)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono font-bold",children:e.jsx("span",{className:d.diferencia!==0?"text-[#e0360a]":"text-text-primary",children:a(d.diferencia)})}),e.jsx("td",{})]}),e.jsxs("tr",{className:"bg-[#f5f5f9] border-t-2 border-guinda/30 font-bold",children:[e.jsx("td",{}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right",children:"TOTAL GENERAL"}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:a(i.monto_contable)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:a(i.monto_presupuestal)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:e.jsx("span",{className:i.diferencia!==0?"text-[#e0360a]":"text-[#56ca00]",children:a(i.diferencia)})}),e.jsx("td",{})]})]})]})})]})]})}export{S as default};
