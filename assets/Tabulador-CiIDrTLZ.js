import{u as A,j as e}from"./index-CyKkzz21.js";import{b as a}from"./vendor-DEA9Ikep.js";import{a as O,b as F,c as q}from"./useCrud-bUfgzWCS.js";import{b as I}from"./useNomina-CxomOV2b.js";import{D as R}from"./DataTable-DfIEqyJf.js";import{M as z}from"./Modal-CR5BegYj.js";import{B as x}from"./Button-BA780zlq.js";import{I as v}from"./Input-CofDiIdZ.js";import{C as B}from"./ConfirmDialog-DPG7zYiO.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const X=d=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(d||0),C={nivel:"",puesto_tipo:"",sueldo_mensual:""};function Z(){const{entePublico:d,ejercicioFiscal:_}=A(),[E,l]=a.useState(!1),[n,f]=a.useState(null),[s,u]=a.useState({...C}),[k,c]=a.useState(!1),[o,m]=a.useState(null),{data:b=[],isLoading:M}=I(),h=O("tabulador"),j=F("tabulador"),g=q("tabulador"),p=(t,r)=>u(i=>({...i,[t]:r})),S=()=>{f(null),u({...C}),l(!0)},y=t=>{f(t),u({nivel:t.nivel??"",puesto_tipo:t.puesto_tipo??"",sueldo_mensual:t.sueldo_mensual??""}),l(!0)},T=async()=>{const t={...s,ente_id:d?.id,ejercicio_id:_?.id,sueldo_mensual:Number(s.sueldo_mensual)||0};n?await j.mutateAsync({id:n.id,...t}):await h.mutateAsync(t),l(!1)},D=t=>{m(t),c(!0)},P=async()=>{o&&await g.mutateAsync(o.id),c(!1),m(null)},w=a.useMemo(()=>[{key:"nivel",label:"Nivel",width:"120px"},{key:"puesto_tipo",label:"Tipo de Puesto"},{key:"sueldo_mensual",label:"Sueldo Mensual",width:"180px",render:t=>e.jsx("span",{className:"text-right block tabular-nums",children:X(t)})},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(t,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),y(r)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),e.jsx("button",{onClick:i=>{i.stopPropagation(),D(r)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],[]),N=h.isPending||j.isPending;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Tabulador de Sueldos"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Escala salarial por niveles y tipos de puesto del ejercicio fiscal"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Tabulador",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",b.length," registros)"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(x,{onClick:S,size:"sm",children:"+ Nuevo Nivel"})})]}),M?e.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando tabulador..."}):e.jsx(R,{columns:w,data:b,onRowClick:y}),e.jsx(z,{open:E,onClose:()=>l(!1),title:n?"Editar Nivel":"Nuevo Nivel",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{label:"Nivel",value:s.nivel,onChange:t=>p("nivel",t.target.value),placeholder:"Ej. 1, 2, 3...",required:!0}),e.jsx(v,{label:"Tipo de Puesto",value:s.puesto_tipo,onChange:t=>p("puesto_tipo",t.target.value),placeholder:"Ej. Directivo, Operativo...",required:!0}),e.jsx(v,{label:"Sueldo Mensual",type:"number",value:s.sueldo_mensual,onChange:t=>p("sueldo_mensual",t.target.value),placeholder:"0.00",required:!0}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[e.jsx(x,{variant:"ghost",onClick:()=>l(!1),disabled:N,children:"Cancelar"}),e.jsx(x,{onClick:T,loading:N,disabled:!s.nivel||!s.puesto_tipo.trim(),children:n?"Guardar cambios":"Crear nivel"})]})]})}),e.jsx(B,{open:k,onClose:()=>{c(!1),m(null)},onConfirm:P,title:"Eliminar nivel de tabulador",message:o?`¿Esta seguro de eliminar el nivel "${o.nivel} — ${o.puesto_tipo}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:g.isPending})]})}export{Z as default};
