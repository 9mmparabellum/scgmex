import{u as J,j as e}from"./index-w8y8owqO.js";import{b as n}from"./vendor-DEA9Ikep.js";import{useCreate as K,useUpdate as Q,useRemove as W}from"./useCrud-BtFPgtI3.js";import{c as Y,d as Z}from"./useTesoreria-BmhA1_Sn.js";import{D as ee}from"./DataTable-BSU7FwdU.js";import{M as P}from"./Modal-BIIwL78L.js";import{B as c}from"./Button-BNgFL-Nv.js";import{I as l}from"./Input-pbRyI1ph.js";import{S as oe}from"./Select-BDMENQev.js";import{B as te}from"./Badge-CBnEW2x0.js";import{C as ae}from"./ConfirmDialog-CEB8zrmM.js";import{e as ne}from"./exportHelpers-CvXmrB4L.js";import{a2 as N}from"./constants-CX_We7cr.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const g=f=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(f||0),F=()=>new Date().toISOString().split("T")[0],q={numero_documento:"",deudor:"",concepto:"",monto_original:"",fecha_emision:F(),fecha_vencimiento:"",estado:"pendiente"};function je(){const{entePublico:f,ejercicioFiscal:A}=J(),[V,d]=n.useState(!1),[x,k]=n.useState(null),[a,C]=n.useState({...q}),[R,j]=n.useState(!1),[m,_]=n.useState(null),[T,b]=n.useState(!1),[i,h]=n.useState(null),[u,p]=n.useState(""),{data:y=[],isLoading:I}=Y(),E=K("cuenta_por_cobrar"),S=Q("cuenta_por_cobrar"),M=W("cuenta_por_cobrar"),v=Z(),w=n.useMemo(()=>Object.entries(N).map(([o,t])=>({value:o,label:t.label})),[]),s=(o,t)=>C(r=>({...r,[o]:t})),z=()=>{k(null),C({...q,fecha_emision:F()}),d(!0)},D=o=>{k(o),C({numero_documento:o.numero_documento??"",deudor:o.deudor??"",concepto:o.concepto??"",monto_original:o.monto_original??"",fecha_emision:o.fecha_emision??"",fecha_vencimiento:o.fecha_vencimiento??"",estado:o.estado??"pendiente"}),d(!0)},B=async()=>{const o={...a,ente_id:f?.id,ejercicio_id:A?.id,monto_original:Number(a.monto_original)||0};x?await S.mutateAsync({id:x.id,...o}):await E.mutateAsync(o),d(!1)},X=o=>{_(o),j(!0)},$=async()=>{m&&await M.mutateAsync(m.id),j(!1),_(null)},G=o=>{h(o),p(""),b(!0)},L=async()=>{i&&u&&await v.mutateAsync({cxcId:i.id,montoCobro:Number(u)}),b(!1),h(null),p("")},U=()=>{ne(y,[{key:"numero_documento",label:"No. Documento"},{key:"deudor",label:"Deudor"},{key:"concepto",label:"Concepto"},{key:"monto_original",label:"Monto Original",getValue:t=>Number(t.monto_original||0)},{key:"monto_cobrado",label:"Monto Cobrado",getValue:t=>Number(t.monto_cobrado||0)},{key:"saldo_pendiente",label:"Saldo Pendiente",getValue:t=>Number(t.saldo_pendiente||0)},{key:"fecha_emision",label:"Fecha Emision"},{key:"fecha_vencimiento",label:"Fecha Vencimiento"},{key:"estado",label:"Estado",getValue:t=>N[t.estado]?.label||t.estado}],"cuentas_por_cobrar")},H=[{key:"numero_documento",label:"No. Documento",width:"130px"},{key:"deudor",label:"Deudor"},{key:"concepto",label:"Concepto"},{key:"monto_original",label:"Monto Original",width:"140px",render:o=>e.jsx("span",{className:"text-right block tabular-nums",children:g(o)})},{key:"monto_cobrado",label:"Cobrado",width:"130px",render:o=>e.jsx("span",{className:"text-right block tabular-nums",children:g(o)})},{key:"saldo_pendiente",label:"Saldo Pendiente",width:"140px",render:o=>e.jsx("span",{className:"text-right block tabular-nums font-bold",children:g(o)})},{key:"fecha_emision",label:"Emision",width:"110px"},{key:"fecha_vencimiento",label:"Vencimiento",width:"110px"},{key:"estado",label:"Estado",width:"120px",render:o=>{const t=N[o];return e.jsx(te,{variant:t?.variant||"default",children:t?.label||o})}},{key:"id",label:"Acciones",width:"200px",sortable:!1,render:(o,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[(t.estado==="pendiente"||t.estado==="parcial")&&e.jsx("button",{onClick:r=>{r.stopPropagation(),G(t)},className:"text-xs text-success hover:text-success/80 transition-colors cursor-pointer",children:"Cobrar"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),D(t)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),X(t)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],O=E.isPending||S.isPending;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Cuentas por Cobrar"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Control de cuentas por cobrar del ente publico"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Cuentas por Cobrar",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",y.length," registros)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{onClick:U,variant:"outline-primary",size:"sm",children:"Exportar Excel"}),e.jsx(c,{onClick:z,size:"sm",children:"+ Nueva CxC"})]})]}),I?e.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando cuentas por cobrar..."}):e.jsx(ee,{columns:H,data:y,onRowClick:D}),e.jsx(P,{open:V,onClose:()=>d(!1),title:x?"Editar Cuenta por Cobrar":"Nueva Cuenta por Cobrar",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{label:"No. Documento",value:a.numero_documento,onChange:o=>s("numero_documento",o.target.value),placeholder:"Ej. CXC-001",required:!0}),e.jsx(oe,{label:"Estado",value:a.estado,onChange:o=>s("estado",o.target.value),options:w,placeholder:"— Seleccione estado —",required:!0})]}),e.jsx(l,{label:"Deudor",value:a.deudor,onChange:o=>s("deudor",o.target.value),placeholder:"Nombre del deudor",required:!0}),e.jsx(l,{label:"Concepto",value:a.concepto,onChange:o=>s("concepto",o.target.value),placeholder:"Concepto de la cuenta por cobrar",required:!0}),e.jsx(l,{label:"Monto Original",type:"number",value:a.monto_original,onChange:o=>s("monto_original",o.target.value),placeholder:"0.00",required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{label:"Fecha Emision",type:"date",value:a.fecha_emision,onChange:o=>s("fecha_emision",o.target.value),required:!0}),e.jsx(l,{label:"Fecha Vencimiento",type:"date",value:a.fecha_vencimiento,onChange:o=>s("fecha_vencimiento",o.target.value),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[e.jsx(c,{variant:"ghost",onClick:()=>d(!1),disabled:O,children:"Cancelar"}),e.jsx(c,{onClick:B,loading:O,disabled:!a.numero_documento.trim()||!a.deudor.trim()||!a.monto_original,children:x?"Guardar cambios":"Crear cuenta"})]})]})}),e.jsx(P,{open:T,onClose:()=>{b(!1),h(null),p("")},title:"Registrar Cobro",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[i&&e.jsxs("div",{className:"bg-[#f9fafb] rounded-lg p-3 space-y-1",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:[e.jsx("span",{className:"font-medium",children:"Documento:"})," ",i.numero_documento]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[e.jsx("span",{className:"font-medium",children:"Deudor:"})," ",i.deudor]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[e.jsx("span",{className:"font-medium",children:"Saldo pendiente:"})," ",e.jsx("span",{className:"font-bold",children:g(i.saldo_pendiente)})]})]}),e.jsx(l,{label:"Monto a Cobrar",type:"number",value:u,onChange:o=>p(o.target.value),placeholder:"0.00",required:!0}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[e.jsx(c,{variant:"ghost",onClick:()=>{b(!1),h(null),p("")},disabled:v.isPending,children:"Cancelar"}),e.jsx(c,{onClick:L,loading:v.isPending,disabled:!u||Number(u)<=0,children:"Registrar Cobro"})]})]})}),e.jsx(ae,{open:R,onClose:()=>{j(!1),_(null)},onConfirm:$,title:"Eliminar cuenta por cobrar",message:m?`¿Esta seguro de eliminar la cuenta "${m.numero_documento} — ${m.deudor}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:M.isPending})]})}export{je as default};
