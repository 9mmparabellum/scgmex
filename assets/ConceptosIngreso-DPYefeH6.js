import{u as B,j as t}from"./index-BS2M8vvb.js";import{b as o}from"./vendor-DEA9Ikep.js";import{u as _,a as T,b as z,c as F,B as f}from"./Button-BxEPlTzl.js";import{D as L}from"./DataTable-8C0SkkHB.js";import{M as R}from"./Modal-bpmMeOtT.js";import{I as q}from"./Input-gSpTkrJG.js";import{S as G}from"./Select-DkUTgNBS.js";import{B as U}from"./Badge-1mTsSGYt.js";import{C as H}from"./ConfirmDialog-DdRRwxda.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const k={clave:"",descripcion:"",clasificador_id:"",activo:!0};function ie(){const{entePublico:m,ejercicioFiscal:g}=B(),[E,a]=o.useState(!1),[r,h]=o.useState(null),[i,p]=o.useState({...k}),[S,u]=o.useState(!1),[c,x]=o.useState(null),{data:v=[],isLoading:w}=_("concepto_ingreso",{filter:{ente_id:m?.id,ejercicio_id:g?.id}}),{data:l=[]}=_("clasificador_presupuestal",{filter:{ente_id:m?.id,tipo:"clasificador_ingreso"}}),b=T("concepto_ingreso"),j=z("concepto_ingreso"),C=F("concepto_ingreso"),D=o.useMemo(()=>{const e={};return l.forEach(s=>{e[s.id]=s}),e},[l]),M=o.useMemo(()=>l.map(e=>({value:e.id,label:`${e.codigo} — ${e.nombre}`})),[l]),A=()=>{h(null),p({...k}),a(!0)},y=e=>{h(e),p({clave:e.clave??"",descripcion:e.descripcion??"",clasificador_id:e.clasificador_id??"",activo:e.activo??!0}),a(!0)},d=(e,s)=>{p(n=>({...n,[e]:s}))},I=async()=>{const e={...i,ente_id:m?.id,ejercicio_id:g?.id,clasificador_id:i.clasificador_id||null};r?await j.mutateAsync({id:r.id,...e}):await b.mutateAsync(e),a(!1)},P=e=>{x(e),u(!0)},$=async()=>{c&&await C.mutateAsync(c.id),u(!1),x(null)},O=[{key:"clave",label:"Clave",width:"120px"},{key:"descripcion",label:"Descripcion"},{key:"clasificador_id",label:"Clasificador",width:"200px",render:e=>{const s=D[e];return s?`${s.codigo} — ${s.nombre}`:"—"}},{key:"activo",label:"Estado",width:"100px",render:e=>t.jsx(U,{variant:e?"success":"default",children:e?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"160px",sortable:!1,render:(e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:n=>{n.stopPropagation(),y(s)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),t.jsx("button",{onClick:n=>{n.stopPropagation(),P(s)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],N=b.isPending||j.isPending;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Conceptos de Ingreso"}),t.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Catalogo de conceptos de ingreso del ejercicio fiscal"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Conceptos",t.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",v.length," registros)"]})]}),t.jsx(f,{onClick:A,size:"sm",children:"+ Nuevo Concepto"})]}),w?t.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando conceptos de ingreso..."}):t.jsx(L,{columns:O,data:v,onRowClick:y}),t.jsx(R,{open:E,onClose:()=>a(!1),title:r?"Editar Concepto":"Nuevo Concepto",size:"md",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx(q,{label:"Clave",value:i.clave,onChange:e=>d("clave",e.target.value),placeholder:"Ej. I001, 4100",required:!0}),t.jsxs("div",{className:"w-full",children:[t.jsxs("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:["Descripcion ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("textarea",{value:i.descripcion,onChange:e=>d("descripcion",e.target.value),placeholder:"Descripcion del concepto de ingreso",rows:3,className:"block w-full rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 py-2.5 transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda resize-none"})]}),t.jsx(G,{label:"Clasificador de Ingreso",value:i.clasificador_id,onChange:e=>d("clasificador_id",e.target.value),placeholder:"— Seleccione un clasificador —",options:M}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:i.activo,onChange:e=>d("activo",e.target.checked),className:"rounded border-border text-primary focus:ring-primary/30 h-4 w-4 cursor-pointer"}),t.jsx("span",{className:"text-sm text-text-secondary",children:"Activo"})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[t.jsx(f,{variant:"ghost",onClick:()=>a(!1),disabled:N,children:"Cancelar"}),t.jsx(f,{onClick:I,loading:N,disabled:!i.clave.trim()||!i.descripcion.trim(),children:r?"Guardar cambios":"Crear concepto"})]})]})}),t.jsx(H,{open:S,onClose:()=>{u(!1),x(null)},onConfirm:$,title:"Eliminar concepto",message:c?`¿Esta seguro de eliminar el concepto "${c.clave} — ${c.descripcion}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:C.isPending})]})}export{ie as default};
