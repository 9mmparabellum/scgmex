import{u as z,j as t}from"./index-Cd8XIyZm.js";import{b as s}from"./vendor-DEA9Ikep.js";import{u as g,a as I,b as R,c as q,B as h}from"./Button-BNeHdZ8F.js";import{D as U}from"./DataTable-BqJ8iuZr.js";import{M as H}from"./Modal-BCn8lzlD.js";import{I as J}from"./Input-CLsDV4a8.js";import{S as E}from"./Select-DacXmymb.js";import{B as K}from"./Badge-CAgi_6r3.js";import{C as Q}from"./ConfirmDialog-f9v0CfLD.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const P={clave:"",descripcion:"",clasificador_id:"",fuente_id:"",activo:!0};function oe(){const{entePublico:l,ejercicioFiscal:b}=z(),[M,r]=s.useState(!1),[d,v]=s.useState(null),[i,m]=s.useState({...P}),[S,x]=s.useState(!1),[o,f]=s.useState(null),{data:j=[],isLoading:$}=g("partida_egreso",{filter:{ente_id:l?.id,ejercicio_id:b?.id}}),{data:u=[]}=g("clasificador_presupuestal",{filter:{ente_id:l?.id,tipo:"objeto_gasto"}}),{data:p=[]}=g("clasificador_presupuestal",{filter:{ente_id:l?.id,tipo:"fuente_financiamiento"}}),_=I("partida_egreso"),C=R("partida_egreso"),y=q("partida_egreso"),w=s.useMemo(()=>{const e={};return u.forEach(a=>{e[a.id]=a}),e},[u]),D=s.useMemo(()=>{const e={};return p.forEach(a=>{e[a.id]=a}),e},[p]),O=s.useMemo(()=>u.map(e=>({value:e.id,label:`${e.codigo} — ${e.nombre}`})),[u]),A=s.useMemo(()=>p.map(e=>({value:e.id,label:`${e.codigo} — ${e.nombre}`})),[p]),F=()=>{v(null),m({...P}),r(!0)},N=e=>{v(e),m({clave:e.clave??"",descripcion:e.descripcion??"",clasificador_id:e.clasificador_id??"",fuente_id:e.fuente_id??"",activo:e.activo??!0}),r(!0)},n=(e,a)=>{m(c=>({...c,[e]:a}))},B=async()=>{const e={...i,ente_id:l?.id,ejercicio_id:b?.id,clasificador_id:i.clasificador_id||null,fuente_id:i.fuente_id||null};d?await C.mutateAsync({id:d.id,...e}):await _.mutateAsync(e),r(!1)},G=e=>{f(e),x(!0)},L=async()=>{o&&await y.mutateAsync(o.id),x(!1),f(null)},T=[{key:"clave",label:"Clave",width:"120px"},{key:"descripcion",label:"Descripcion"},{key:"clasificador_id",label:"COG",width:"200px",render:e=>{const a=w[e];return a?`${a.codigo} — ${a.nombre}`:"—"}},{key:"fuente_id",label:"Fuente",width:"180px",render:e=>{const a=D[e];return a?`${a.codigo} — ${a.nombre}`:"—"}},{key:"activo",label:"Estado",width:"100px",render:e=>t.jsx(K,{variant:e?"success":"default",children:e?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"160px",sortable:!1,render:(e,a)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:c=>{c.stopPropagation(),N(a)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),t.jsx("button",{onClick:c=>{c.stopPropagation(),G(a)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],k=_.isPending||C.isPending;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Partidas Presupuestales"}),t.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Catalogo de partidas de egreso del ejercicio fiscal"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Partidas",t.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",j.length," registros)"]})]}),t.jsx(h,{onClick:F,size:"sm",children:"+ Nueva Partida"})]}),$?t.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando partidas presupuestales..."}):t.jsx(U,{columns:T,data:j,onRowClick:N}),t.jsx(H,{open:M,onClose:()=>r(!1),title:d?"Editar Partida":"Nueva Partida",size:"md",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx(J,{label:"Clave",value:i.clave,onChange:e=>n("clave",e.target.value),placeholder:"Ej. 1000, E001",required:!0}),t.jsxs("div",{className:"w-full",children:[t.jsxs("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:["Descripcion ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("textarea",{value:i.descripcion,onChange:e=>n("descripcion",e.target.value),placeholder:"Descripcion de la partida presupuestal",rows:3,className:"block w-full rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 py-2.5 transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda resize-none"})]}),t.jsx(E,{label:"Objeto del Gasto (COG)",value:i.clasificador_id,onChange:e=>n("clasificador_id",e.target.value),placeholder:"— Seleccione un clasificador —",options:O}),t.jsx(E,{label:"Fuente de Financiamiento (opcional)",value:i.fuente_id,onChange:e=>n("fuente_id",e.target.value),placeholder:"— Sin fuente —",options:A}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:i.activo,onChange:e=>n("activo",e.target.checked),className:"rounded border-border text-primary focus:ring-primary/30 h-4 w-4 cursor-pointer"}),t.jsx("span",{className:"text-sm text-text-secondary",children:"Activo"})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[t.jsx(h,{variant:"ghost",onClick:()=>r(!1),disabled:k,children:"Cancelar"}),t.jsx(h,{onClick:B,loading:k,disabled:!i.clave.trim()||!i.descripcion.trim(),children:d?"Guardar cambios":"Crear partida"})]})]})}),t.jsx(Q,{open:S,onClose:()=>{x(!1),f(null)},onConfirm:L,title:"Eliminar partida",message:o?`¿Esta seguro de eliminar la partida "${o.clave} — ${o.descripcion}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:y.isPending})]})}export{oe as default};
