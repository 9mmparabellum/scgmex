import{u as y,j as e}from"./index-CyKkzz21.js";import{c as N,b as r}from"./vendor-DEA9Ikep.js";import{u as k,a as M}from"./useConciliacion-BukBYYpT.js";import{u as S}from"./useCrud-bUfgzWCS.js";import{l as P}from"./constants-B48pdecp.js";import{D as _}from"./DataTable-DfIEqyJf.js";import{M as E}from"./Modal-CR5BegYj.js";import{B as l}from"./Button-BA780zlq.js";import{S as I}from"./Select-B7MIUx36.js";import{B as G}from"./Badge-BiItYtys.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const c=i=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(i||0);function V(){const i=N(),{entePublico:x,ejercicioFiscal:d,user:u}=y(),[h,s]=r.useState(!1),[t,n]=r.useState(""),{data:f=[],isLoading:b}=k(),{data:m=[]}=S("periodo_contable",{filter:{ejercicio_id:d?.id},order:{column:"numero",ascending:!0}}),j=r.useMemo(()=>m.map(o=>({value:o.id,label:o.nombre||`Periodo ${o.numero}`})),[m]),p=M(),g=r.useMemo(()=>[{key:"periodo",label:"Periodo",width:"160px",render:(o,a)=>a.periodo?.nombre||"—"},{key:"fecha_elaboracion",label:"Fecha Elaboracion",width:"150px",render:o=>o?new Date(o).toLocaleDateString("es-MX"):"—"},{key:"total_contable",label:"Total Contable",width:"160px",render:o=>e.jsx("span",{className:"font-mono text-sm",children:c(o)})},{key:"total_presupuestal_egreso",label:"Total Pres. Egreso",width:"170px",render:o=>e.jsx("span",{className:"font-mono text-sm",children:c(o)})},{key:"diferencia_egreso",label:"Diferencia Egreso",width:"160px",render:o=>{const a=o||0;return e.jsx("span",{className:`font-mono text-sm font-semibold ${a!==0?"text-[#e0360a]":"text-text-primary"}`,children:c(a)})}},{key:"estado",label:"Estado",width:"130px",render:o=>{const a=P[o];return e.jsx(G,{variant:a?.variant||"default",children:a?.label||o||"—"})}},{key:"elaborador",label:"Elaborado Por",width:"160px",render:(o,a)=>a.elaborador?.nombre||"—"}],[]),w=o=>{i(`/contabilidad/conciliacion/${o.id}`)},v=async()=>{if(t)try{await p.mutateAsync({enteId:x.id,ejercicioId:d.id,periodoId:t,elaboradoPor:u?.id}),s(!1),n("")}catch{}},C=()=>{n(""),s(!0)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Conciliacion Contable-Presupuestal"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Conciliacion entre registros contables y presupuestales (Art. 48 LGCG)"})]}),e.jsxs(l,{onClick:C,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 inline-block",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Generar Conciliacion"]})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:b?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-guinda",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):e.jsx(_,{columns:g,data:f,onRowClick:w})}),e.jsx(E,{open:h,onClose:()=>s(!1),title:"Generar Conciliacion",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{label:"Periodo Contable",placeholder:"Seleccionar periodo...",options:j,value:t,onChange:o=>n(o.target.value)}),e.jsx("p",{className:"text-xs text-text-muted",children:"Se generara la conciliacion comparando los registros contables con los presupuestales del periodo seleccionado."}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(l,{variant:"ghost",onClick:()=>s(!1),children:"Cancelar"}),e.jsx(l,{onClick:v,loading:p.isPending,disabled:!t,children:"Generar"})]})]})})]})}export{V as default};
