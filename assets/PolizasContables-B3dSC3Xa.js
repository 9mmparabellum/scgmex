import{u as _,a as C,j as o,R as c}from"./index-Cd8XIyZm.js";import{c as z,b as a}from"./vendor-DEA9Ikep.js";import{u as M,B as p}from"./Button-BNeHdZ8F.js";import{T as m,E as x}from"./constants-B9IYjURH.js";import{f as P}from"./polizaHelpers-DSRoDnth.js";import{D as T}from"./DataTable-BqJ8iuZr.js";import{S as r}from"./Select-DacXmymb.js";import{B as A}from"./Badge-CAgi_6r3.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";function X(){const l=z(),{ejercicioFiscal:h}=_(),[s,d]=a.useState({periodo_id:"",tipo:"",estado:""}),i=(e,t)=>d(O=>({...O,[e]:t})),u=()=>d({periodo_id:"",tipo:"",estado:""}),f=Object.values(s).some(Boolean),{data:n=[]}=M("periodo_contable",{filter:{ejercicio_id:h?.id}}),b=a.useMemo(()=>n.map(e=>({value:e.id,label:`${e.numero} — ${e.nombre||e.mes}`})),[n]),j=a.useMemo(()=>Object.entries(m).map(([e,t])=>({value:e,label:t})),[]),g=a.useMemo(()=>Object.entries(x).map(([e,{label:t}])=>({value:e,label:t})),[]),v=a.useMemo(()=>{const e={};return s.periodo_id&&(e.periodo_id=s.periodo_id),s.tipo&&(e.tipo=s.tipo),s.estado&&(e.estado=s.estado),Object.keys(e).length>0?e:void 0},[s]),{data:w=[],isLoading:N}=C(v),y=a.useMemo(()=>[{key:"numero_poliza",label:"Numero",width:"120px",render:(e,t)=>o.jsx("span",{className:"font-mono text-sm font-semibold text-primary",children:P(t.tipo,e)})},{key:"fecha",label:"Fecha",width:"120px",render:e=>e?new Date(e).toLocaleDateString("es-MX"):"—"},{key:"tipo",label:"Tipo",width:"120px",render:e=>m[e]||e||"—"},{key:"descripcion",label:"Descripcion"},{key:"total_debe",label:"Total",width:"140px",render:e=>o.jsx("span",{className:"font-mono text-sm",children:new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(e||0)})},{key:"estado",label:"Estado",width:"130px",render:e=>{const t={borrador:"default",pendiente:"warning",aprobada:"success",cancelada:"danger"};return o.jsx(A,{variant:t[e]||"default",children:x[e]?.label||e||"—"})}}],[]),k=e=>{l(c.POLIZAS+"/"+e.id)};return o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Polizas Contables"}),o.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 36 — Registro de operaciones mediante polizas de diario"})]}),o.jsxs(p,{onClick:()=>l(c.POLIZA_NUEVA),children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 inline-block",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Nueva Poliza"]})]}),o.jsx("div",{className:"bg-white rounded-lg card-shadow p-4 mb-4",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[o.jsx(r,{label:"Periodo",options:b,value:s.periodo_id,onChange:e=>i("periodo_id",e.target.value),placeholder:"Todos los periodos"}),o.jsx(r,{label:"Tipo",options:j,value:s.tipo,onChange:e=>i("tipo",e.target.value),placeholder:"Todos los tipos"}),o.jsx(r,{label:"Estado",options:g,value:s.estado,onChange:e=>i("estado",e.target.value),placeholder:"Todos los estados"}),o.jsx("div",{className:"flex items-end",children:f&&o.jsx(p,{variant:"ghost",size:"sm",onClick:u,children:"Limpiar filtros"})})]})}),o.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:N?o.jsx("div",{className:"flex items-center justify-center py-16",children:o.jsxs("svg",{className:"animate-spin h-8 w-8 text-guinda",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):o.jsx(T,{columns:y,data:w,onRowClick:k})})]})}export{X as default};
