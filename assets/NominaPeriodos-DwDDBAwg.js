import{u as L,j as a}from"./index-KskWbqO9.js";import{c as R,b as i}from"./vendor-DEA9Ikep.js";import{useCreate as z,useUpdate as Q,useRemove as $}from"./useCrud-C19KmPO4.js";import{d as G}from"./useNomina-BqIh5j4D.js";import{v as C}from"./constants-CX_We7cr.js";import{D as U}from"./DataTable-DWljaDCm.js";import{M as V}from"./Modal-DfjuYvxB.js";import{B as x}from"./Button-DGu3eAys.js";import{I as d}from"./Input-CHoXOb6x.js";import{S as H}from"./Select-k3R1vLiz.js";import{B as k}from"./Badge-B4UqNpVe.js";import{C as J}from"./ConfirmDialog-D5TWhe0q.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const f=m=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(m||0),q={numero_quincena:"",fecha_inicio:"",fecha_fin:"",fecha_pago:"",estado:"borrador"};function de(){const m=R(),{entePublico:D,ejercicioFiscal:P}=L(),[E,s]=i.useState(!1),[c,g]=i.useState(null),[o,u]=i.useState({...q}),[S,p]=i.useState(!1),[l,h]=i.useState(null),{data:b=[],isLoading:M}=G(),j=z("nomina_periodo"),_=Q("nomina_periodo"),y=$("nomina_periodo"),w=i.useMemo(()=>Object.entries(C).map(([e,{label:t}])=>({value:e,label:t})),[]),r=(e,t)=>u(n=>({...n,[e]:t})),F=e=>{const t=C[e];return t?a.jsx(k,{variant:t.variant,children:t.label}):a.jsx(k,{variant:"default",children:e})},A=()=>{g(null),u({...q}),s(!0)},O=e=>{g(e),u({numero_quincena:e.numero_quincena??"",fecha_inicio:e.fecha_inicio??"",fecha_fin:e.fecha_fin??"",fecha_pago:e.fecha_pago??"",estado:e.estado??"borrador"}),s(!0)},I=async()=>{const e={...o,ente_id:D?.id,ejercicio_id:P?.id,numero_quincena:Number(o.numero_quincena)||0};c?await _.mutateAsync({id:c.id,...e}):await j.mutateAsync(e),s(!1)},B=e=>{h(e),p(!0)},T=async()=>{l&&await y.mutateAsync(l.id),p(!1),h(null)},v=e=>{m(`/nomina/periodos/${e.id}`)},X=i.useMemo(()=>[{key:"numero_quincena",label:"Quincena",width:"100px"},{key:"fecha_inicio",label:"Fecha Inicio",width:"120px",render:e=>e?new Date(e).toLocaleDateString("es-MX"):"—"},{key:"fecha_fin",label:"Fecha Fin",width:"120px",render:e=>e?new Date(e).toLocaleDateString("es-MX"):"—"},{key:"fecha_pago",label:"Fecha Pago",width:"120px",render:e=>e?new Date(e).toLocaleDateString("es-MX"):"—"},{key:"total_percepciones",label:"Percepciones",width:"150px",render:e=>a.jsx("span",{className:"text-right block tabular-nums",children:f(e)})},{key:"total_deducciones",label:"Deducciones",width:"150px",render:e=>a.jsx("span",{className:"text-right block tabular-nums",children:f(e)})},{key:"total_neto",label:"Neto",width:"150px",render:e=>a.jsx("span",{className:"text-right block tabular-nums font-bold",children:f(e)})},{key:"total_empleados",label:"Empleados",width:"100px"},{key:"estado",label:"Estado",width:"120px",render:e=>F(e)},{key:"id",label:"Acciones",width:"200px",sortable:!1,render:(e,t)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:n=>{n.stopPropagation(),v(t)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Ver Detalle"}),a.jsx("button",{onClick:n=>{n.stopPropagation(),O(t)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),a.jsx("button",{onClick:n=>{n.stopPropagation(),B(t)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],[]),N=j.isPending||_.isPending;return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Periodos de Nomina"}),a.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Administracion de quincenas y periodos de pago del ejercicio fiscal"})]}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Periodos",a.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",b.length," registros)"]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(x,{onClick:A,size:"sm",children:"+ Nuevo Periodo"})})]}),M?a.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando periodos de nomina..."}):a.jsx(U,{columns:X,data:b,onRowClick:v}),a.jsx(V,{open:E,onClose:()=>s(!1),title:c?"Editar Periodo":"Nuevo Periodo",size:"md",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(d,{label:"Numero de Quincena",type:"number",value:o.numero_quincena,onChange:e=>r("numero_quincena",e.target.value),placeholder:"Ej. 1, 2, 3...",required:!0}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(d,{label:"Fecha Inicio",type:"date",value:o.fecha_inicio,onChange:e=>r("fecha_inicio",e.target.value),required:!0}),a.jsx(d,{label:"Fecha Fin",type:"date",value:o.fecha_fin,onChange:e=>r("fecha_fin",e.target.value),required:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(d,{label:"Fecha de Pago",type:"date",value:o.fecha_pago,onChange:e=>r("fecha_pago",e.target.value),required:!0}),a.jsx(H,{label:"Estado",value:o.estado,onChange:e=>r("estado",e.target.value),options:w,placeholder:"-- Seleccione estado --",required:!0})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[a.jsx(x,{variant:"ghost",onClick:()=>s(!1),disabled:N,children:"Cancelar"}),a.jsx(x,{onClick:I,loading:N,disabled:!o.numero_quincena||!o.fecha_inicio||!o.fecha_fin,children:c?"Guardar cambios":"Crear periodo"})]})]})}),a.jsx(J,{open:S,onClose:()=>{p(!1),h(null)},onConfirm:T,title:"Eliminar periodo de nomina",message:l?`¿Esta seguro de eliminar la quincena ${l.numero_quincena}? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:y.isPending})]})}export{de as default};
