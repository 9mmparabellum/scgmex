import{u as I,j as e}from"./index-Cd8XIyZm.js";import{b as t}from"./vendor-DEA9Ikep.js";import{u as F,a as $,b as q,c as H,B as u}from"./Button-BNeHdZ8F.js";import{D as V}from"./DataTable-BqJ8iuZr.js";import{M as W}from"./Modal-BCn8lzlD.js";import{I as A}from"./Input-CLsDV4a8.js";import{S as Y}from"./Select-DacXmymb.js";import{B as S}from"./Badge-CAgi_6r3.js";import{C as J}from"./ConfirmDialog-f9v0CfLD.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const p="usuarios",R=[{value:"super_admin",label:"Super Administrador"},{value:"admin_ente",label:"Administrador de Ente"},{value:"contador_general",label:"Contador General"},{value:"contador",label:"Contador"},{value:"presupuesto",label:"Presupuesto"},{value:"tesorero",label:"Tesorero"},{value:"patrimonio",label:"Patrimonio"},{value:"auditor",label:"Auditor"},{value:"transparencia",label:"Transparencia"},{value:"consulta",label:"Solo Consulta"}],k=Object.fromEntries(R.map(r=>[r.value,r.label])),K={super_admin:"danger",admin_ente:"warning",contador_general:"primary",contador:"info",presupuesto:"info",tesorero:"warning",patrimonio:"primary",auditor:"danger",transparencia:"success",consulta:"default"},C={nombre:"",email:"",rol:"",activo:!0},Q=[{key:"nombre",label:"Nombre"},{key:"email",label:"Email",render:r=>e.jsx("span",{className:"font-mono text-xs text-text-secondary",children:r||"--"})},{key:"rol",label:"Rol",width:"200px",render:r=>e.jsx(S,{variant:K[r]||"default",children:k[r]||r||"--"})},{key:"activo",label:"Estado",width:"120px",render:r=>e.jsx(S,{variant:r?"success":"danger",children:r?"Activo":"Inactivo"})}];function ce(){const{rol:r}=I(),{data:_=[],isLoading:P}=F(p,{order:{column:"nombre",ascending:!0}}),x=$(p),b=q(p),N=H(p),[M,g]=t.useState(!1),[s,h]=t.useState(null),[o,c]=t.useState(C),[d,n]=t.useState({}),[O,v]=t.useState(!1),[l,f]=t.useState(null),B=()=>{h(null),c({...C}),n({}),g(!0)},T=a=>{h(a),c({nombre:a.nombre??"",email:a.email??"",rol:a.rol??"",activo:a.activo??!0}),n({}),g(!0)},j=()=>{g(!1),h(null),c(C),n({})},m=(a,i)=>{c(y=>({...y,[a]:i})),d[a]&&n(y=>{const w={...y};return delete w[a],w})},U=()=>{const a={};return o.nombre.trim()||(a.nombre="El nombre es requerido"),o.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email.trim())||(a.email="Ingrese un email valido"):a.email="El email es requerido",o.rol||(a.rol="Seleccione un rol"),n(a),Object.keys(a).length===0},D=async a=>{if(a.preventDefault(),!U())return;const i={nombre:o.nombre.trim(),email:o.email.trim().toLowerCase(),rol:o.rol,activo:o.activo};try{s?await b.mutateAsync({id:s.id,...i}):await x.mutateAsync(i),j()}catch{}},L=a=>{f(a),v(!0)},z=async()=>{if(l)try{await N.mutateAsync(l.id),v(!1),f(null)}catch{}},G=()=>{v(!1),f(null)},E=x.isPending||b.isPending;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Gestion de Usuarios"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 84 â€” Control de acceso basado en roles (RBAC)"})]}),e.jsxs(u,{onClick:B,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Nuevo Usuario"]})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:P?e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-3 text-sm text-text-muted",children:"Cargando usuarios..."})]}):e.jsx(V,{columns:Q,data:_,onRowClick:T})}),e.jsx(W,{open:M,onClose:j,title:s?"Editar Usuario":"Nuevo Usuario",size:"md",children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsx(A,{label:"Nombre *",placeholder:"Nombre completo del usuario",value:o.nombre,onChange:a=>m("nombre",a.target.value),error:d.nombre}),e.jsx(A,{label:"Email *",type:"email",placeholder:"correo@ejemplo.gob.mx",value:o.email,onChange:a=>m("email",a.target.value),error:d.email}),e.jsx(Y,{label:"Rol *",placeholder:"Seleccionar rol...",options:R,value:o.rol,onChange:a=>m("rol",a.target.value),error:d.rol}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"usuario-activo",type:"checkbox",checked:o.activo,onChange:a=>m("activo",a.target.checked),className:"h-4 w-4 rounded border-border text-primary focus:ring-primary/30 cursor-pointer"}),e.jsx("label",{htmlFor:"usuario-activo",className:"text-sm font-medium text-text-secondary cursor-pointer select-none",children:"Usuario activo"})]}),o.rol&&e.jsxs("div",{className:"bg-bg-hover rounded-md p-3",children:[e.jsxs("p",{className:"text-xs text-text-muted",children:[e.jsx("span",{className:"font-semibold text-text-secondary",children:"Rol seleccionado: "}),k[o.rol]]}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[o.rol==="super_admin"&&"Acceso total al sistema. Puede gestionar todos los entes, usuarios y configuraciones.",o.rol==="admin_ente"&&"Administrador de un ente publico especifico. Puede gestionar usuarios y configuraciones del ente.",o.rol==="contador_general"&&"Acceso a todos los modulos contables. Puede registrar y aprobar polizas.",o.rol==="contador"&&"Acceso a modulos contables asignados. Puede registrar polizas.",o.rol==="presupuesto"&&"Gestion del presupuesto de ingresos y egresos.",o.rol==="tesorero"&&"Gestion de fondos, bancos y conciliaciones bancarias.",o.rol==="patrimonio"&&"Gestion de bienes muebles e inmuebles del ente.",o.rol==="auditor"&&"Acceso de solo lectura a todos los modulos para auditoria.",o.rol==="transparencia"&&"Acceso a reportes y generacion de informes de transparencia.",o.rol==="consulta"&&"Acceso de solo lectura a modulos autorizados."]})]}),(x.isError||b.isError)&&e.jsx("div",{className:"p-3 rounded-lg border border-danger/30 bg-danger/5 text-sm text-danger",children:"Ocurrio un error al guardar. Por favor intente de nuevo."}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsx("div",{children:s&&e.jsx(u,{variant:"danger",type:"button",size:"sm",onClick:()=>L(s),children:"Eliminar"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{variant:"ghost",type:"button",onClick:j,disabled:E,children:"Cancelar"}),e.jsx(u,{type:"submit",loading:E,children:s?"Guardar Cambios":"Crear Usuario"})]})]})]})}),e.jsx(J,{open:O,onClose:G,onConfirm:z,title:"Eliminar Usuario",message:l?`Esta seguro de eliminar al usuario "${l.nombre}" (${l.email})? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger",loading:N.isPending})]})}export{ce as default};
