import{u as U,j as a}from"./index-BS2M8vvb.js";import{b as n}from"./vendor-DEA9Ikep.js";import{u as b,a as q,b as H,c as J,B as v}from"./Button-BxEPlTzl.js";import{D as K}from"./DataTable-8C0SkkHB.js";import{M as Q}from"./Modal-bpmMeOtT.js";import{S as p}from"./Select-DkUTgNBS.js";import{B as A}from"./Badge-1mTsSGYt.js";import{C as W}from"./ConfirmDialog-DdRRwxda.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const D=[{value:"aprobado",label:"Aprobado"},{value:"modificado",label:"Modificado"},{value:"comprometido",label:"Comprometido"},{value:"devengado",label:"Devengado"},{value:"ejercido",label:"Ejercido"},{value:"pagado",label:"Pagado"},{value:"estimado",label:"Estimado"},{value:"recaudado",label:"Recaudado"}],X={aprobado:"primary",modificado:"info",comprometido:"warning",devengado:"success",ejercido:"success",pagado:"success",estimado:"info",recaudado:"primary"},$={clasificador_id:"",momento:"",cuenta_cargo_id:"",cuenta_abono_id:"",descripcion:"",activo:!0};function ce(){const{entePublico:c}=U(),[O,i]=n.useState(!1),[l,h]=n.useState(null),[t,x]=n.useState({...$}),[w,f]=n.useState(!1),[d,g]=n.useState(null),{data:_=[],isLoading:z}=b("matriz_conversion",{filter:{ente_id:c?.id}}),{data:m=[]}=b("clasificador_presupuestal",{filter:{ente_id:c?.id}}),{data:u=[]}=b("plan_de_cuentas",{filter:{ente_id:c?.id}}),j=q("matriz_conversion"),C=H("matriz_conversion"),y=J("matriz_conversion"),P=n.useMemo(()=>{const e={};return m.forEach(o=>{e[o.id]=o}),e},[m]),R=n.useMemo(()=>{const e={};return u.forEach(o=>{e[o.id]=o}),e},[u]),T=n.useMemo(()=>m.map(e=>({value:e.id,label:`${e.codigo} — ${e.nombre}`})),[m]),N=n.useMemo(()=>u.filter(e=>e.es_detalle===!0||e.nivel!=null&&e.nivel>=3).map(e=>({value:e.id,label:`${e.codigo} — ${e.nombre}`})),[u]),M=e=>{const o=P[e];return o?`${o.codigo} — ${o.nombre}`:"—"},k=e=>{const o=R[e];return o?`${o.codigo} — ${o.nombre}`:"—"},B=()=>{h(null),x({...$}),i(!0)},E=e=>{h(e),x({clasificador_id:e.clasificador_id??"",momento:e.momento??"",cuenta_cargo_id:e.cuenta_cargo_id??"",cuenta_abono_id:e.cuenta_abono_id??"",descripcion:e.descripcion??"",activo:e.activo??!0}),i(!0)},s=(e,o)=>{x(r=>({...r,[e]:o}))},F=async()=>{const e={...t,ente_id:c?.id,clasificador_id:t.clasificador_id||null,cuenta_cargo_id:t.cuenta_cargo_id||null,cuenta_abono_id:t.cuenta_abono_id||null};l?await C.mutateAsync({id:l.id,...e}):await j.mutateAsync(e),i(!1)},L=e=>{g(e),f(!0)},V=async()=>{d&&await y.mutateAsync(d.id),f(!1),g(null)},G=[{key:"clasificador_id",label:"Clasificador",render:e=>a.jsx("span",{className:"text-sm",children:M(e)})},{key:"momento",label:"Momento",width:"140px",render:e=>a.jsx(A,{variant:X[e]||"default",children:D.find(o=>o.value===e)?.label??e??"—"})},{key:"cuenta_cargo_id",label:"Cuenta Cargo",render:e=>a.jsx("span",{className:"text-sm",children:k(e)})},{key:"cuenta_abono_id",label:"Cuenta Abono",render:e=>a.jsx("span",{className:"text-sm",children:k(e)})},{key:"activo",label:"Estado",width:"100px",render:e=>a.jsx(A,{variant:e?"success":"default",children:e?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"160px",sortable:!1,render:(e,o)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:r=>{r.stopPropagation(),E(o)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),a.jsx("button",{onClick:r=>{r.stopPropagation(),L(o)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],S=j.isPending||C.isPending,I=t.clasificador_id&&t.momento&&t.cuenta_cargo_id&&t.cuenta_abono_id;return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Matrices de Conversion"}),a.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 41 — Vinculacion presupuestal-contable para registro dual automatico"})]}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Reglas de conversion",a.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",_.length," registros)"]})]}),a.jsx(v,{onClick:B,size:"sm",children:"+ Nueva regla"})]}),z?a.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando matrices de conversion..."}):a.jsx(K,{columns:G,data:_,onRowClick:E}),a.jsx(Q,{open:O,onClose:()=>i(!1),title:l?"Editar Regla de Conversion":"Nueva Regla de Conversion",size:"lg",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(p,{label:"Clasificador presupuestal",value:t.clasificador_id,onChange:e=>s("clasificador_id",e.target.value),placeholder:"— Seleccionar clasificador —",options:T}),a.jsx(p,{label:"Momento contable",value:t.momento,onChange:e=>s("momento",e.target.value),placeholder:"— Seleccionar momento —",options:D}),a.jsx(p,{label:"Cuenta de cargo",value:t.cuenta_cargo_id,onChange:e=>s("cuenta_cargo_id",e.target.value),placeholder:"— Seleccionar cuenta de cargo —",options:N}),a.jsx(p,{label:"Cuenta de abono",value:t.cuenta_abono_id,onChange:e=>s("cuenta_abono_id",e.target.value),placeholder:"— Seleccionar cuenta de abono —",options:N}),a.jsxs("div",{className:"w-full",children:[a.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Descripcion"}),a.jsx("textarea",{value:t.descripcion,onChange:e=>s("descripcion",e.target.value),placeholder:"Descripcion de la regla de conversion (opcional)",rows:3,className:"block w-full rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 py-2.5 placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda transition-all duration-150 resize-none"})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:t.activo,onChange:e=>s("activo",e.target.checked),className:"rounded border-border text-primary focus:ring-primary/30 h-4 w-4 cursor-pointer"}),a.jsx("span",{className:"text-sm text-text-secondary",children:"Activo"})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[a.jsx(v,{variant:"ghost",onClick:()=>i(!1),disabled:S,children:"Cancelar"}),a.jsx(v,{onClick:F,loading:S,disabled:!I,children:l?"Guardar cambios":"Crear regla"})]})]})}),a.jsx(W,{open:w,onClose:()=>{f(!1),g(null)},onConfirm:V,title:"Eliminar regla de conversion",message:d?`¿Esta seguro de eliminar esta regla de conversion para "${M(d.clasificador_id)}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:y.isPending})]})}export{ce as default};
