import{j as e}from"./index-CyKkzz21.js";import{g as N,c as C,b as m}from"./vendor-DEA9Ikep.js";import{b as k,c as M,d as B}from"./useConciliacionBancaria-CkCTG8HO.js";import{b as L}from"./useTesoreria-BurAnd1W.js";import{D as x}from"./DataTable-DfIEqyJf.js";import{B as A}from"./Button-BA780zlq.js";import{B as u}from"./Badge-BiItYtys.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const i=t=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t||0);function P(){const{id:t}=N(),h=C(),n=new URLSearchParams(window.location.search).get("cuenta"),{data:s={}}=k(t),{data:l=[],isLoading:b}=M(t),{data:c=[],isLoading:p}=L(n),r=B(),o=s.total_movimientos||0,d=s.conciliados||0,g=s.no_conciliados||0,v=o>0?(d/o*100).toFixed(1):"0.0",j=[{label:"Saldo Inicial Banco",value:i(s.saldo_inicial_banco)},{label:"Saldo Final Banco",value:i(s.saldo_final_banco)},{label:"Movimientos Totales",value:o},{label:"Conciliados",value:d},{label:"No Conciliados",value:g},{label:"% Conciliacion",value:`${v}%`}],f=m.useMemo(()=>[{key:"fecha",label:"Fecha",width:"110px",render:a=>a?new Date(a).toLocaleDateString("es-MX"):"—"},{key:"referencia",label:"Referencia",width:"120px",render:a=>a||"—"},{key:"concepto",label:"Concepto",render:a=>a||"—"},{key:"monto",label:"Monto",width:"140px",render:a=>e.jsx("span",{className:"text-right block tabular-nums",children:i(a)})},{key:"conciliado",label:"Conciliado",width:"110px",render:a=>e.jsx(u,{variant:a?"success":"default",children:a?"Si":"No"})}],[]),w=m.useMemo(()=>[{key:"fecha",label:"Fecha",width:"110px",render:a=>a?new Date(a).toLocaleDateString("es-MX"):"—"},{key:"referencia",label:"Referencia",width:"120px",render:a=>a||"—"},{key:"concepto",label:"Concepto",render:a=>a||"—"},{key:"cargo",label:"Cargo",width:"130px",render:a=>e.jsx("span",{className:"text-right block tabular-nums",children:i(a)})},{key:"abono",label:"Abono",width:"130px",render:a=>e.jsx("span",{className:"text-right block tabular-nums",children:i(a)})},{key:"conciliado",label:"Conciliado",width:"110px",render:a=>e.jsx(u,{variant:a?"success":"default",children:a?"Si":"No"})}],[]),y=async()=>{try{await r.mutateAsync({estadoCuentaId:t,cuentaBancariaId:n})}catch{}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h("/tesoreria/conciliacion-bancaria"),className:"inline-flex items-center justify-center w-9 h-9 rounded-md text-text-secondary hover:bg-bg-hover hover:text-text-heading transition-colors cursor-pointer","aria-label":"Regresar",children:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Conciliacion Bancaria"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Detalle de conciliacion — Movimientos de libros vs estado de cuenta"})]})]}),e.jsxs(A,{onClick:y,loading:r.isPending,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 inline-block",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"Conciliar Automaticamente"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:j.map(a=>e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-4",children:[e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wide mb-1",children:a.label}),e.jsx("p",{className:"text-lg font-bold text-text-primary",children:a.value})]},a.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Movimientos Libros",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",c.length," registros)"]})]})}),p?e.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando movimientos de libros..."}):e.jsx(x,{columns:f,data:c})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Estado de Cuenta",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",l.length," registros)"]})]})}),b?e.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando movimientos del estado de cuenta..."}):e.jsx(x,{columns:w,data:l})]})]})]})}export{P as default};
