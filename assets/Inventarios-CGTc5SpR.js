import{u as T,j as a}from"./index-FiQ-o0as.js";import{b as c}from"./vendor-DEA9Ikep.js";import{useCreate as B,useUpdate as O,useRemove as P}from"./useCrud--Epse75Z.js";import{b as z}from"./usePatrimonio-CGoFAM08.js";import{D as A}from"./DataTable-BIXgbPbQ.js";import{M as R}from"./Modal-nDz351DY.js";import{B as x}from"./Button-CjklDnap.js";import{I as r}from"./Input-C95Jlo8c.js";import{S as U}from"./Select-DaQh9AUa.js";import{B as V}from"./Badge-7Bgbyuqr.js";import{C as X}from"./ConfirmDialog-Bpgd99YJ.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const L=m=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(m||0),N={clave:"",descripcion:"",fecha_conteo:"",responsable:"",ubicacion:"",total_bienes:"",valor_total:"",estado:"borrador",observaciones:""},$={borrador:"default",en_proceso:"warning",finalizado:"success"},q=[{value:"borrador",label:"Borrador"},{value:"en_proceso",label:"En proceso"},{value:"finalizado",label:"Finalizado"}];function ne(){const{entePublico:m,ejercicioFiscal:_}=T(),[k,l]=c.useState(!1),[d,v]=c.useState(null),[t,u]=c.useState({...N}),[E,p]=c.useState(!1),[i,b]=c.useState(null),{data:h=[],isLoading:S}=z(),g=B("inventario_conteo"),f=O("inventario_conteo"),j=P("inventario_conteo"),o=(e,s)=>u(n=>({...n,[e]:s})),w=()=>{v(null),u({...N}),l(!0)},y=e=>{v(e),u({clave:e.clave??"",descripcion:e.descripcion??"",fecha_conteo:e.fecha_conteo??"",responsable:e.responsable??"",ubicacion:e.ubicacion??"",total_bienes:e.total_bienes??"",valor_total:e.valor_total??"",estado:e.estado??"borrador",observaciones:e.observaciones??""}),l(!0)},D=async()=>{const e={...t,ente_id:m?.id,ejercicio_id:_?.id,total_bienes:t.total_bienes?Number(t.total_bienes):null,valor_total:Number(t.valor_total)||0};d?await f.mutateAsync({id:d.id,...e}):await g.mutateAsync(e),l(!1)},M=e=>{b(e),p(!0)},I=async()=>{i&&await j.mutateAsync(i.id),p(!1),b(null)},F=[{key:"clave",label:"Clave",width:"100px"},{key:"descripcion",label:"Descripcion"},{key:"fecha_conteo",label:"Fecha Conteo",width:"110px",render:e=>e?new Date(e+"T00:00:00").toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"}):"—"},{key:"responsable",label:"Responsable",width:"150px"},{key:"total_bienes",label:"Total Bienes",width:"100px",render:e=>a.jsx("span",{className:"block text-right tabular-nums",children:e!=null?Number(e).toLocaleString("es-MX"):"—"})},{key:"valor_total",label:"Valor Total",width:"130px",render:e=>a.jsx("span",{className:"block text-right tabular-nums",children:L(e)})},{key:"estado",label:"Estado",width:"120px",render:e=>{const s=$[e]||"default";return a.jsx(V,{variant:s,children:e?e.replace(/_/g," ").replace(/^\w/,n=>n.toUpperCase()):"—"})}},{key:"id",label:"Acciones",width:"140px",sortable:!1,render:(e,s)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:n=>{n.stopPropagation(),y(s)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),a.jsx("button",{onClick:n=>{n.stopPropagation(),M(s)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],C=g.isPending||f.isPending;return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Inventarios Fisicos"}),a.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Control de inventarios y conteos de bienes patrimoniales"})]}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Inventarios",a.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",h.length," registros)"]})]}),a.jsx(x,{onClick:w,size:"sm",children:"+ Nuevo Inventario"})]}),S?a.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Cargando inventarios..."}):a.jsx(A,{columns:F,data:h,onRowClick:y}),a.jsx(R,{open:k,onClose:()=>l(!1),title:d?"Editar Inventario":"Nuevo Inventario",size:"md",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(r,{label:"Clave",value:t.clave,onChange:e=>o("clave",e.target.value),placeholder:"Ej. INV-2026-001",required:!0}),a.jsxs("div",{className:"w-full",children:[a.jsxs("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:["Descripcion ",a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx("textarea",{value:t.descripcion,onChange:e=>o("descripcion",e.target.value),placeholder:"Descripcion del inventario",rows:3,className:"w-full h-[40px] min-h-[80px] rounded-md border border-border px-3 py-2 text-[0.9375rem] focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(r,{label:"Fecha Conteo",type:"date",value:t.fecha_conteo,onChange:e=>o("fecha_conteo",e.target.value)}),a.jsx(r,{label:"Responsable",value:t.responsable,onChange:e=>o("responsable",e.target.value),placeholder:"Nombre del responsable"})]}),a.jsx(r,{label:"Ubicacion",value:t.ubicacion,onChange:e=>o("ubicacion",e.target.value),placeholder:"Ubicacion del conteo"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(r,{label:"Total Bienes",type:"number",value:t.total_bienes,onChange:e=>o("total_bienes",e.target.value),placeholder:"0"}),a.jsx(r,{label:"Valor Total",type:"number",value:t.valor_total,onChange:e=>o("valor_total",e.target.value),placeholder:"0.00"})]}),a.jsx(U,{label:"Estado",value:t.estado,onChange:e=>o("estado",e.target.value),options:q,placeholder:"— Seleccione estado —"}),a.jsxs("div",{className:"w-full",children:[a.jsx("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:"Observaciones"}),a.jsx("textarea",{value:t.observaciones,onChange:e=>o("observaciones",e.target.value),placeholder:"Observaciones adicionales",rows:3,className:"w-full h-[40px] min-h-[80px] rounded-md border border-border px-3 py-2 text-[0.9375rem] focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda"})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[a.jsx(x,{variant:"ghost",onClick:()=>l(!1),disabled:C,children:"Cancelar"}),a.jsx(x,{onClick:D,loading:C,disabled:!t.clave.trim()||!t.descripcion.trim(),children:d?"Guardar cambios":"Crear inventario"})]})]})}),a.jsx(X,{open:E,onClose:()=>{p(!1),b(null)},onConfirm:I,title:"Eliminar inventario",message:i?`¿Esta seguro de eliminar el inventario "${i.clave} — ${i.descripcion}"? Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:j.isPending})]})}export{ne as default};
