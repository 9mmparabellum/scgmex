import{s as j,u as R,o as D,j as e}from"./index-CPaKNtDw.js";import{b as E}from"./vendor-DEA9Ikep.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";async function M(a,r){const[n,o,g,h,P,$]=await Promise.all([j.from("poliza").select("id, estado, tipo").eq("ente_id",a).eq("ejercicio_id",r),j.from("presupuesto_egreso").select("id, aprobado, ejercido, pagado").eq("ente_id",a).eq("ejercicio_id",r),j.from("presupuesto_ingreso").select("id, estimado, recaudado").eq("ente_id",a).eq("ejercicio_id",r),j.from("cuenta_por_cobrar").select("id, monto_original, monto_cobrado, estado").eq("ente_id",a).eq("ejercicio_id",r),j.from("cuenta_por_pagar").select("id, monto_original, monto_pagado, estado").eq("ente_id",a).eq("ejercicio_id",r),j.from("cuenta_bancaria").select("id, saldo_actual").eq("ente_id",a).eq("activo",!0)]),c=n.data||[],l=o.data||[],i=g.data||[],p=h.data||[],m=P.data||[],x=$.data||[];return{polizas:{total:c.length,aprobadas:c.filter(s=>s.estado==="aprobada").length,pendientes:c.filter(s=>s.estado==="pendiente").length},presupuestoEgresos:{aprobado:l.reduce((s,t)=>s+Number(t.aprobado||0),0),ejercido:l.reduce((s,t)=>s+Number(t.ejercido||0),0),pagado:l.reduce((s,t)=>s+Number(t.pagado||0),0)},presupuestoIngresos:{estimado:i.reduce((s,t)=>s+Number(t.estimado||0),0),recaudado:i.reduce((s,t)=>s+Number(t.recaudado||0),0)},cuentasPorCobrar:{total:p.length,pendiente:p.filter(s=>["pendiente","parcial"].includes(s.estado)).reduce((s,t)=>s+Number(t.monto_original||0)-Number(t.monto_cobrado||0),0)},cuentasPorPagar:{total:m.length,pendiente:m.filter(s=>["pendiente","parcial"].includes(s.estado)).reduce((s,t)=>s+Number(t.monto_original||0)-Number(t.monto_pagado||0),0)},tesoreria:{saldoBancos:x.reduce((s,t)=>s+Number(t.saldo_actual||0),0),cuentasActivas:x.length}}}function k(){const{entePublico:a,ejercicioFiscal:r}=R();return D({queryKey:["kpis_realtime",a?.id,r?.id],queryFn:()=>M(a.id,r.id),enabled:!!a?.id&&!!r?.id,refetchInterval:3e4})}const d=a=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(a||0),N=a=>Number(a||0).toFixed(1)+"%",y=(a,r)=>r?a/r*100:0;function b({className:a=""}){return e.jsxs("div",{className:`bg-white rounded-lg card-shadow p-5 animate-pulse ${a}`,children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-2/3 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})}function _({value:a,color:r="bg-guinda",label:n}){const o=Math.min(Math.max(a,0),100);return e.jsxs("div",{className:"mt-2",children:[n&&e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:n}),e.jsx("span",{children:N(o)})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`${r} h-3 rounded-full transition-all duration-500`,style:{width:`${o}%`}})})]})}function f({title:a,value:r,subtitle:n,color:o="text-gray-900",icon:g,children:h}){return e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[g&&e.jsx("span",{className:"text-lg",children:g}),e.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:a})]}),e.jsx("div",{className:`text-2xl font-bold ${o}`,children:r}),n&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n}),h]})}function L(){const{data:a,isLoading:r,refetch:n,dataUpdatedAt:o}=k(),[g,h]=E.useState(!1),P=E.useCallback(async()=>{h(!0),await n(),h(!1)},[n]),$=o?new Date(o).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--:--:--",c=a||{},l=c.presupuestoEgresos||{},i=c.presupuestoIngresos||{},p=c.cuentasPorCobrar||{},m=c.cuentasPorPagar||{},x=c.tesoreria||{},s=c.polizas||{},t=y(l.ejercido,l.aprobado),z=y(l.pagado,l.aprobado),v=y(i.recaudado,i.estimado),w=(x.saldoBancos||0)-(m.pendiente||0)+(p.pendiente||0),u=[];t>80&&u.push({text:`Presupuesto ejercido al ${N(t)} del aprobado`,variant:t>95?"danger":"warning"}),s.pendientes>10&&u.push({text:`${s.pendientes} polizas pendientes de aprobacion`,variant:"warning"}),(m.pendiente||0)>1e6&&u.push({text:`CxP pendientes por ${d(m.pendiente)}`,variant:"danger"}),v<50&&i.estimado>0&&u.push({text:`Recaudacion al ${N(v)} del estimado`,variant:"warning"}),w<0&&u.push({text:`Liquidez neta negativa: ${d(w)}`,variant:"danger"}),u.length===0&&u.push({text:"Sin alertas activas",variant:"success"});const A={danger:"bg-red-50 text-red-600 border-red-200",warning:"bg-amber-50 text-amber-600 border-amber-200",success:"bg-emerald-50 text-emerald-600 border-emerald-200"};return r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded w-1/4 animate-pulse"})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:Array.from({length:6}).map((q,C)=>e.jsx(b,{},C))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(b,{}),e.jsx(b,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-5",children:[e.jsx(b,{}),e.jsx(b,{}),e.jsx(b,{})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Dashboard en Tiempo Real"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Indicadores clave actualizados automaticamente"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:["Ultima actualizacion: ",$]}),e.jsx("button",{onClick:P,disabled:g,className:"h-[38px] px-4 rounded-md bg-guinda text-white text-sm font-medium hover:bg-guinda/90 disabled:opacity-50 transition-colors",children:g?"Actualizando...":"Actualizar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:[e.jsx(f,{title:"Saldo en Bancos",value:d(x.saldoBancos),subtitle:`${x.cuentasActivas||0} cuentas activas`,color:"text-emerald-600"}),e.jsx(f,{title:"Presup. Egresos",value:d(l.ejercido),subtitle:`de ${d(l.aprobado)} aprobado`,children:e.jsx(_,{value:t,color:"bg-guinda",label:"Ejercido"})}),e.jsx(f,{title:"Presup. Ingresos",value:d(i.recaudado),subtitle:`de ${d(i.estimado)} estimado`,children:e.jsx(_,{value:v,color:"bg-emerald-500",label:"Recaudado"})}),e.jsx(f,{title:"CxC Pendiente",value:d(p.pendiente),subtitle:`${p.total||0} cuentas por cobrar`,color:"text-amber-600"}),e.jsx(f,{title:"CxP Pendiente",value:d(m.pendiente),subtitle:`${m.total||0} cuentas por pagar`,color:"text-red-600"}),e.jsx(f,{title:"Polizas",value:`${s.pendientes||0} / ${s.total||0}`,subtitle:`${s.aprobadas||0} aprobadas`,color:"text-gray-900",children:e.jsx(_,{value:y(s.aprobadas,s.total),color:"bg-sky-500",label:"Aprobadas"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Ejecucion Presupuestal Egresos"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Aprobado"}),e.jsx("span",{className:"font-medium text-gray-900",children:d(l.aprobado)})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"bg-gray-400 h-4 rounded-full w-full"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"text-gray-600",children:["Ejercido (",N(t),")"]}),e.jsx("span",{className:"font-medium text-guinda",children:d(l.ejercido)})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"bg-guinda h-4 rounded-full transition-all duration-500",style:{width:`${Math.min(t,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"text-gray-600",children:["Pagado (",N(z),")"]}),e.jsx("span",{className:"font-medium text-emerald-600",children:d(l.pagado)})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"bg-emerald-500 h-4 rounded-full transition-all duration-500",style:{width:`${Math.min(z,100)}%`}})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Recaudacion de Ingresos"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Estimado"}),e.jsx("span",{className:"font-medium text-gray-900",children:d(i.estimado)})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"bg-gray-400 h-4 rounded-full w-full"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{className:"text-gray-600",children:["Recaudado (",N(v),")"]}),e.jsx("span",{className:"font-medium text-emerald-600",children:d(i.recaudado)})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"bg-emerald-500 h-4 rounded-full transition-all duration-500",style:{width:`${Math.min(v,100)}%`}})})]})]}),e.jsx("div",{className:"mt-5 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Diferencia"}),e.jsx("span",{className:`font-medium ${i.recaudado>=i.estimado?"text-emerald-600":"text-red-600"}`,children:d((i.recaudado||0)-(i.estimado||0))})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-5",children:[e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Tesoreria"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Saldo en Bancos"}),e.jsx("span",{className:"font-medium text-emerald-600",children:d(x.saldoBancos)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Cuentas Activas"}),e.jsx("span",{className:"font-medium text-gray-900",children:x.cuentasActivas||0})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-3 flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"( - ) CxP Pendiente"}),e.jsx("span",{className:"font-medium text-red-600",children:d(m.pendiente)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"( + ) CxC Pendiente"}),e.jsx("span",{className:"font-medium text-amber-600",children:d(p.pendiente)})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-3 flex justify-between text-sm font-semibold",children:[e.jsx("span",{className:"text-gray-700",children:"Liquidez Neta"}),e.jsx("span",{className:w>=0?"text-emerald-600":"text-red-600",children:d(w)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Polizas"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Total"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:s.total||0})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Aprobadas"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-600",children:s.aprobadas||0})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Pendientes"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-600",children:s.pendientes||0})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-100",children:e.jsx(_,{value:y(s.aprobadas,s.total),color:"bg-emerald-500",label:"Tasa de aprobacion"})})]}),e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Alertas"}),e.jsx("div",{className:"space-y-2",children:u.map((q,C)=>e.jsx("div",{className:`text-xs px-3 py-2.5 rounded-md border ${A[q.variant]||A.warning}`,children:q.text},C))})]})]})]})}export{L as default};
