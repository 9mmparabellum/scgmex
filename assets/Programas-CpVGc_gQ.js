import{u as I,j as e}from"./index-xuYioy8Y.js";import{c as B,b as c}from"./vendor-DEA9Ikep.js";import{u as z}from"./useMIR-CACUP0R0.js";import{a as F,b as G,c as $}from"./useCrud-BZqSYSww.js";import{m as A}from"./constants-B0qHiDNt.js";import{D as V}from"./DataTable-CoGr0iSJ.js";import{M as L}from"./Modal-BawsBw69.js";import{B as d}from"./Button-CQM7GO5t.js";import{I as b}from"./Input-C6_ozmNh.js";import{S as U}from"./Select-CHQpqBAE.js";import{B as E}from"./Badge-DX5pclE5.js";import{C as W}from"./ConfirmDialog-BrOOKlKS.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const q={programa:"primary",proyecto:"info",actividad:"warning"},S={clave:"",nombre:"",objetivo:"",tipo:"",responsable:"",activo:!0},H=Object.entries(A).map(([p,m])=>({value:p,label:m}));function le(){const p=B(),{entePublico:m,ejercicioFiscal:h}=I(),[w,s]=c.useState(!1),[o,v]=c.useState(null),[t,u]=c.useState({...S}),[M,x]=c.useState(!1),[n,g]=c.useState(null),{data:f=[],isLoading:O}=z(),j=F("programa_presupuestario"),y=G("programa_presupuestario"),C=$("programa_presupuestario"),R=()=>{v(null),u({...S}),s(!0)},N=a=>{v(a),u({clave:a.clave??"",nombre:a.nombre??"",objetivo:a.objetivo??"",tipo:a.tipo??"",responsable:a.responsable??"",activo:a.activo??!0}),s(!0)},i=(a,l)=>{u(r=>({...r,[a]:l}))},_=async()=>{const a={...t,ente_id:m?.id,ejercicio_id:h?.id};o?await y.mutateAsync({id:o.id,...a}):await j.mutateAsync(a),s(!1)},k=a=>{g(a),x(!0)},D=async()=>{n&&await C.mutateAsync(n.id),x(!1),g(null),s(!1)},T=[{key:"clave",label:"Clave",width:"100px"},{key:"nombre",label:"Nombre"},{key:"tipo",label:"Tipo",width:"130px",render:a=>e.jsx(E,{variant:q[a]||"default",children:A[a]||a||"—"})},{key:"clasificador",label:"Clasificador",width:"160px",render:a=>a?.codigo?a.codigo:"—"},{key:"responsable",label:"Responsable",width:"180px"},{key:"activo",label:"Activo",width:"100px",render:a=>e.jsx(E,{variant:a?"success":"danger",children:a?"Activo":"Inactivo"})},{key:"id",label:"Acciones",width:"180px",sortable:!1,render:(a,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),p(`/mir/${l.id}`)},className:"text-xs text-info hover:text-info/80 transition-colors cursor-pointer",children:"Ver MIR"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),N(l)},className:"text-xs text-primary hover:text-primary-light transition-colors cursor-pointer",children:"Editar"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),k(l)},className:"text-xs text-danger hover:text-danger/80 transition-colors cursor-pointer",children:"Eliminar"})]})}],P=j.isPending||y.isPending;return!m?.id||!h?.id?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-text-muted text-sm",children:"Seleccione un ente publico y ejercicio fiscal para ver los programas presupuestarios."})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Programas Presupuestarios"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Catalogo de programas para PbR-SED y MIR"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-text-secondary",children:["Programas",e.jsxs("span",{className:"ml-2 text-text-muted font-normal",children:["(",f.length," registros)"]})]}),e.jsx(d,{onClick:R,size:"sm",children:"+ Nuevo Programa"})]}),O?e.jsxs("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Cargando programas presupuestarios..."]}):e.jsx(V,{columns:T,data:f,onRowClick:N}),e.jsx(L,{open:w,onClose:()=>s(!1),title:o?"Editar Programa":"Nuevo Programa",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{label:"Clave",value:t.clave,onChange:a=>i("clave",a.target.value),placeholder:"Ej. E001, S001"}),e.jsx(b,{label:"Nombre",value:t.nombre,onChange:a=>i("nombre",a.target.value),placeholder:"Nombre del programa presupuestario"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-text-heading mb-1.5",children:"Objetivo"}),e.jsx("textarea",{value:t.objetivo,onChange:a=>i("objetivo",a.target.value),placeholder:"Objetivo del programa presupuestario",rows:3,className:"block w-full rounded-md border border-border bg-white text-text-heading text-[0.9375rem] px-3.5 py-2.5 transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda resize-none"})]}),e.jsx(U,{label:"Tipo",value:t.tipo,onChange:a=>i("tipo",a.target.value),placeholder:"-- Seleccione tipo --",options:H}),e.jsx(b,{label:"Responsable",value:t.responsable,onChange:a=>i("responsable",a.target.value),placeholder:"Nombre del responsable del programa"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.activo,onChange:a=>i("activo",a.target.checked),className:"rounded border-border text-primary focus:ring-primary/30 h-4 w-4 cursor-pointer"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Activo"})]}),o&&e.jsx("div",{className:"pt-2 border-t border-border",children:e.jsx(d,{variant:"danger",size:"sm",onClick:()=>k(o),children:"Eliminar programa"})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2 border-t border-border",children:[e.jsx(d,{variant:"ghost",onClick:()=>s(!1),disabled:P,children:"Cancelar"}),e.jsx(d,{onClick:_,loading:P,disabled:!t.clave.trim()||!t.nombre.trim(),children:o?"Guardar cambios":"Crear programa"})]})]})}),e.jsx(W,{open:M,onClose:()=>{x(!1),g(null)},onConfirm:D,title:"Eliminar programa",message:n?`¿Esta seguro de eliminar el programa "${n.clave} — ${n.nombre}"? Se eliminaran tambien sus indicadores y avances asociados. Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",loading:C.isPending})]})}export{le as default};
