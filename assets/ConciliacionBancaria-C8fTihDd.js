import{u as q,j as e}from"./index-CPaKNtDw.js";import{c as H,b as o}from"./vendor-DEA9Ikep.js";import{a as T}from"./useTesoreria-DHJH77eF.js";import{u as X,a as W}from"./useConciliacionBancaria-D7sJME0i.js";import{useList as G}from"./useCrud-BktvsPeN.js";import{a5 as _}from"./constants-CX_We7cr.js";import{D as J}from"./DataTable-HS7RLNYY.js";import{M as K}from"./Modal-BiK_8Ur7.js";import{B as n}from"./Button-BnoK6vsi.js";import{I as m}from"./Input-DL7Lvbg0.js";import{S as I}from"./Select-C_7OhVDc.js";import{B as Q}from"./Badge-CGz_j3CN.js";import{e as U}from"./exportHelpers-CvXmrB4L.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const F=l=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(l||0);function pe(){const l=H(),{ejercicioFiscal:E}=q(),[s,M]=o.useState(""),[B,i]=o.useState(!1),[c,p]=o.useState(""),[d,x]=o.useState(""),[h,b]=o.useState(""),[v,g]=o.useState(""),[f,j]=o.useState(""),[C,y]=o.useState(""),{data:w=[],isLoading:A}=T(),{data:u=[],isLoading:P}=X(s),{data:N=[]}=G("periodo_contable",{filter:{ejercicio_id:E?.id},order:{column:"numero",ascending:!0}}),S=W(),z=o.useMemo(()=>w.filter(a=>a.activo).map(a=>({value:a.id,label:`${a.numero_cuenta} — ${a.banco}`})),[w]),D=o.useMemo(()=>N.map(a=>({value:a.id,label:a.nombre||`Periodo ${a.numero}`})),[N]),R=o.useMemo(()=>[{key:"periodo",label:"Periodo",width:"150px",render:(a,t)=>t.periodo?.nombre||"—"},{key:"fecha_corte",label:"Fecha de Corte",width:"140px",render:a=>a?new Date(a).toLocaleDateString("es-MX"):"—"},{key:"saldo_inicial_banco",label:"Saldo Inicial",width:"160px",render:a=>e.jsx("span",{className:"text-right block tabular-nums",children:F(a)})},{key:"saldo_final_banco",label:"Saldo Final",width:"160px",render:a=>e.jsx("span",{className:"text-right block tabular-nums",children:F(a)})},{key:"archivo_nombre",label:"Archivo",width:"180px",render:a=>a||"—"},{key:"estado",label:"Estado",width:"140px",render:a=>{const t=_[a];return e.jsx(Q,{variant:t?.variant||"default",children:t?.label||a||"—"})}},{key:"actions",label:"",width:"60px",render:(a,t)=>e.jsx(n,{variant:"ghost",size:"sm",onClick:r=>{r.stopPropagation(),l(`/tesoreria/conciliacion-bancaria/${t.id}?cuenta=${s}`)},children:"Ver"})}],[l,s]),V=a=>{l(`/tesoreria/conciliacion-bancaria/${a.id}?cuenta=${s}`)},k=()=>{p(""),x(""),b(""),g(""),j(""),y("")},$=()=>{k(),i(!0)},L=async()=>{if(!s||!c||!d)return;const a=C.split(`
`).map(t=>t.trim()).filter(t=>t.length>0).map(t=>{const r=t.split("	");return{fecha:r[0]?.trim()||"",referencia:r[1]?.trim()||"",concepto:r[2]?.trim()||"",cargo:parseFloat(r[3]?.trim())||0,abono:parseFloat(r[4]?.trim())||0}});try{await S.mutateAsync({cuentaBancariaId:s,periodoId:c,fechaCorte:d,saldoInicial:parseFloat(h)||0,saldoFinal:parseFloat(v)||0,archivoNombre:f,movimientos:a}),i(!1),k()}catch{}},O=()=>{U(u,[{key:"periodo",label:"Periodo",getValue:t=>t.periodo?.nombre||""},{key:"fecha_corte",label:"Fecha de Corte"},{key:"saldo_inicial_banco",label:"Saldo Inicial"},{key:"saldo_final_banco",label:"Saldo Final"},{key:"archivo_nombre",label:"Archivo"},{key:"estado",label:"Estado",getValue:t=>_[t.estado]?.label||t.estado||""}],"conciliacion_bancaria_estados_cuenta")};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Conciliacion Bancaria"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Importacion y conciliacion de estados de cuenta bancarios"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u.length>0&&e.jsxs(n,{variant:"outline-primary",size:"sm",onClick:O,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 inline-block",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Exportar Excel"]}),e.jsxs(n,{onClick:$,disabled:!s,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 inline-block",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Importar Estado de Cuenta"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5 mb-4",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx(I,{label:"Cuenta Bancaria",placeholder:"Seleccionar cuenta bancaria...",options:z,value:s,onChange:a=>M(a.target.value)}),A&&e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Cargando cuentas bancarias..."})]})}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:s?P?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-guinda",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):e.jsx(J,{columns:R,data:u,onRowClick:V}):e.jsx("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:"Seleccione una cuenta bancaria para ver sus estados de cuenta"})}),e.jsx(K,{open:B,onClose:()=>i(!1),title:"Importar Estado de Cuenta",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(I,{label:"Periodo Contable",placeholder:"Seleccionar periodo...",options:D,value:c,onChange:a=>p(a.target.value),required:!0}),e.jsx(m,{label:"Fecha de Corte",type:"date",value:d,onChange:a=>x(a.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m,{label:"Saldo Inicial",type:"number",value:h,onChange:a=>b(a.target.value),placeholder:"0.00",required:!0}),e.jsx(m,{label:"Saldo Final",type:"number",value:v,onChange:a=>g(a.target.value),placeholder:"0.00",required:!0})]}),e.jsx(m,{label:"Nombre del Archivo",type:"text",value:f,onChange:a=>j(a.target.value),placeholder:"estado_cuenta_enero_2026.csv"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-1.5",children:"Movimientos (CSV)"}),e.jsx("textarea",{className:"w-full h-[160px] rounded-md border border-border text-[0.9375rem] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-guinda/25 focus:border-guinda font-mono text-sm resize-y",value:C,onChange:a=>y(a.target.value),placeholder:`Pegue los movimientos separados por tabulador, uno por linea:
fecha	referencia	concepto	cargo	abono
2026-01-15	REF001	Pago proveedor	5000.00	0
2026-01-20	DEP002	Deposito transferencia	0	15000.00`}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Formato por linea (separado por tabulador): fecha, referencia, concepto, cargo, abono"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(n,{variant:"ghost",onClick:()=>i(!1),children:"Cancelar"}),e.jsx(n,{onClick:L,loading:S.isPending,disabled:!c||!d,children:"Importar"})]})]})})]})}export{pe as default};
