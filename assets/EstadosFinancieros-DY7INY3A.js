import{u as W,j as e}from"./index-Cd8XIyZm.js";import{b as d}from"./vendor-DEA9Ikep.js";import{u as Z,B as P}from"./Button-BNeHdZ8F.js";import{u as q,a as J,b as K,c as Q}from"./useReportes-vGly3HhZ.js";import{S as Y}from"./Select-DacXmymb.js";import{e as C}from"./exportHelpers-CvXmrB4L.js";import{e as S}from"./exportPdfHelpers-A3uAR0yr.js";import"./export-t5FFX7R_.js";import"./supabase-DANKYb0E.js";const s=b=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(b||0),ee=[{key:"situacion",label:"Situacion Financiera"},{key:"actividades",label:"Actividades"},{key:"variacion",label:"Variacion Hacienda"},{key:"analitico",label:"Analitico Activo"},{key:"notas",label:"Notas"}];function c({title:b,rows:l=[],totalLabel:h,total:i,columns:r}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider mb-2 px-1",children:b}),e.jsx("div",{className:"bg-white rounded-lg card-shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-[#f9fafb]",children:r.map(n=>e.jsx("th",{className:`text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5 ${n.align==="right"?"text-right":"text-left"}`,children:n.label},n.key))})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:r.length,className:"px-5 py-6 text-center text-sm text-text-muted",children:"Sin datos"})}):l.map((n,I)=>e.jsx("tr",{className:"border-b border-[#f0f0f0] hover:bg-[#f9fafb]",children:r.map(o=>e.jsx("td",{className:`px-5 py-3 text-sm ${o.align==="right"?"text-right font-mono":""} ${o.key==="codigo"?"font-mono":""}`,children:o.format?o.format(n[o.key]):n[o.key]},o.key))},I))}),h!=null&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-[#f9fafb] font-bold border-t-2 border-guinda/20",children:[e.jsx("td",{colSpan:r.length-1,className:"px-5 py-3.5 text-sm text-right",children:h}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:s(i)})]})})]})})})]})}function re(){const{ejercicioFiscal:b}=W(),[l,h]=d.useState(""),[i,r]=d.useState("situacion"),{data:n=[]}=Z("periodo_contable",{filter:{ejercicio_id:b?.id},order:{column:"numero",ascending:!0}}),I=d.useMemo(()=>n.map(a=>({value:a.id,label:a.nombre||`Periodo ${a.numero}`})),[n]),{data:o,isLoading:G}=q(l),{data:p,isLoading:M}=J(l),{data:m,isLoading:V}=K(l),{data:B,isLoading:U}=Q(l),$={situacion:G,actividades:M,variacion:V,analitico:U,notas:!1}[i],E=[{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo_final",label:"Saldo Final ($)",align:"right",format:s}],_=[{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"monto",label:"Monto ($)",align:"right",format:s}],g=d.useMemo(()=>(o?.activo?.cuentas||[]).filter(a=>(a.nivel||0)>=2),[o]),u=d.useMemo(()=>(o?.pasivo?.cuentas||[]).filter(a=>(a.nivel||0)>=2),[o]),f=d.useMemo(()=>(o?.hacienda?.cuentas||[]).filter(a=>(a.nivel||0)>=2),[o]),w=o?.activo?.total||0,T=o?.pasivo?.total||0,L=o?.hacienda?.total||0,D=Math.abs(w-(T+L))<.01,N=p?.ingresos?.cuentas||[],y=p?.gastos?.cuentas||[],H=p?.ingresos?.total||0,F=p?.gastos?.total||0,R=H-F,j=m?.contribuida?.cuentas||[],k=m?.generada?.cuentas||[],v=m?.exceso?.cuentas||[],x=B?.cuentas||[],A=d.useMemo(()=>x.reduce((a,t)=>({saldo_inicial:a.saldo_inicial+(t.saldo_inicial||0),debe:a.debe+(t.debe||0),haber:a.haber+(t.haber||0),saldo_final:a.saldo_final+(t.saldo_final||0)}),{saldo_inicial:0,debe:0,haber:0,saldo_final:0}),[x]),X=()=>{switch(i){case"situacion":{const a=[...g.map(t=>({seccion:"ACTIVO",...t})),...u.map(t=>({seccion:"PASIVO",...t})),...f.map(t=>({seccion:"HACIENDA PUBLICA",...t}))];C(a,[{key:"seccion",label:"Seccion"},{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo_final",label:"Saldo Final"}],"estado_situacion_financiera");break}case"actividades":{const a=[...N.map(t=>({seccion:"INGRESOS",...t})),...y.map(t=>({seccion:"GASTOS",...t}))];C(a,[{key:"seccion",label:"Seccion"},{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"monto",label:"Monto"}],"estado_actividades");break}case"variacion":{const a=[...j.map(t=>({seccion:"HACIENDA CONTRIBUIDA",...t})),...k.map(t=>({seccion:"HACIENDA GENERADA",...t})),...v.map(t=>({seccion:"EXCESO/INSUFICIENCIA",...t}))];C(a,[{key:"seccion",label:"Seccion"},{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo",label:"Saldo"}],"estado_variacion_hacienda");break}case"analitico":{C(x,[{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo_inicial",label:"Saldo Inicial"},{key:"debe",label:"Debe"},{key:"haber",label:"Haber"},{key:"saldo_final",label:"Saldo Final"}],"estado_analitico_activo");break}}},z=()=>{switch(i){case"situacion":{const a=[...g.map(t=>({seccion:"ACTIVO",...t})),...u.map(t=>({seccion:"PASIVO",...t})),...f.map(t=>({seccion:"HACIENDA PUBLICA",...t}))];S(a,[{key:"seccion",label:"Seccion"},{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo_final",label:"Saldo Final"}],"estado_situacion_financiera",{title:"Estado de Situacion Financiera"});break}case"actividades":{const a=[...N.map(t=>({seccion:"INGRESOS",...t})),...y.map(t=>({seccion:"GASTOS",...t}))];S(a,[{key:"seccion",label:"Seccion"},{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"monto",label:"Monto"}],"estado_actividades",{title:"Estado de Actividades"});break}case"variacion":{const a=[...j.map(t=>({seccion:"HACIENDA CONTRIBUIDA",...t})),...k.map(t=>({seccion:"HACIENDA GENERADA",...t})),...v.map(t=>({seccion:"EXCESO/INSUFICIENCIA",...t}))];S(a,[{key:"seccion",label:"Seccion"},{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo",label:"Saldo"}],"estado_variacion_hacienda",{title:"Estado de Variacion en la Hacienda Publica"});break}case"analitico":{S(x,[{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo_inicial",label:"Saldo Inicial"},{key:"debe",label:"Debe"},{key:"haber",label:"Haber"},{key:"saldo_final",label:"Saldo Final"}],"estado_analitico_activo",{title:"Estado Analitico del Activo"});break}}},O={situacion:g.length>0||u.length>0||f.length>0,actividades:N.length>0||y.length>0,variacion:j.length>0||k.length>0||v.length>0,analitico:x.length>0,notas:!0}[i];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Estados Financieros"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 46-50 LGCG — Estados financieros del ente publico"})]}),e.jsx("div",{className:"bg-white rounded-lg card-shadow p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsx(Y,{label:"Periodo",placeholder:"Seleccionar periodo...",options:I,value:l,onChange:a=>h(a.target.value)}),e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end",children:[e.jsxs(P,{variant:"ghost",onClick:X,disabled:!l||!O||i==="notas",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar XLSX"]}),e.jsxs(P,{variant:"ghost",onClick:z,disabled:!l||!O||i==="notas",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Exportar PDF"]})]})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:ee.map(a=>e.jsx("button",{onClick:()=>r(a.key),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors cursor-pointer ${i===a.key?"bg-guinda text-white shadow-md":"bg-white card-shadow text-text-secondary hover:text-text-primary"}`,children:a.label},a.key))}),l?$?e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsxs("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-guinda",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Cargando estado financiero..."]})}):!O&&i!=="notas"?e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"No hay datos registrados para este periodo"})}):e.jsxs(e.Fragment,{children:[i==="situacion"&&e.jsxs("div",{children:[e.jsx(c,{title:"ACTIVO",rows:g,columns:E,totalLabel:"TOTAL ACTIVO",total:w}),e.jsx(c,{title:"PASIVO",rows:u,columns:E,totalLabel:"TOTAL PASIVO",total:T}),e.jsx(c,{title:"HACIENDA PUBLICA",rows:f,columns:E,totalLabel:"TOTAL HACIENDA",total:L}),e.jsxs("div",{className:`rounded-lg p-4 text-sm font-medium ${D?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[e.jsx("span",{className:"font-semibold",children:"Ecuacion contable: "}),"Activo = Pasivo + Hacienda →"," ",s(w)," = ",s(T+L),D?" — Cuadra correctamente":" — Diferencia detectada"]})]}),i==="actividades"&&e.jsxs("div",{children:[e.jsx(c,{title:"INGRESOS",rows:N,columns:_,totalLabel:"TOTAL INGRESOS",total:H}),e.jsx(c,{title:"GASTOS",rows:y,columns:_,totalLabel:"TOTAL GASTOS",total:F}),e.jsxs("div",{className:`rounded-lg p-4 text-sm font-medium ${R>=0?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[e.jsx("span",{className:"font-semibold",children:"Resultado del Ejercicio (Ahorro/Desahorro): "}),s(R)]})]}),i==="variacion"&&e.jsxs("div",{children:[e.jsx(c,{title:"HACIENDA CONTRIBUIDA",rows:j,columns:[{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo",label:"Saldo ($)",align:"right",format:s}],totalLabel:"TOTAL HACIENDA CONTRIBUIDA",total:m?.contribuida?.total||0}),e.jsx(c,{title:"HACIENDA GENERADA",rows:k,columns:[{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo",label:"Saldo ($)",align:"right",format:s}],totalLabel:"TOTAL HACIENDA GENERADA",total:m?.generada?.total||0}),e.jsx(c,{title:"EXCESO / INSUFICIENCIA EN LA ACTUALIZACION DE LA HACIENDA PUBLICA",rows:v,columns:[{key:"codigo",label:"Codigo"},{key:"nombre",label:"Nombre"},{key:"saldo",label:"Saldo ($)",align:"right",format:s}],totalLabel:"TOTAL EXCESO/INSUFICIENCIA",total:m?.exceso?.total||0})]}),i==="analitico"&&e.jsx("div",{className:"bg-white rounded-lg card-shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#f9fafb]",children:[e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Codigo"}),e.jsx("th",{className:"text-left text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Nombre"}),e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Saldo Inicial"}),e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Debe"}),e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Haber"}),e.jsx("th",{className:"text-right text-xs font-semibold text-text-secondary uppercase tracking-wider px-5 py-3.5",children:"Saldo Final"})]})}),e.jsx("tbody",{children:x.map((a,t)=>e.jsxs("tr",{className:"border-b border-[#f0f0f0] hover:bg-[#f9fafb]",children:[e.jsx("td",{className:"px-5 py-3 font-mono text-sm",children:a.codigo}),e.jsx("td",{className:"px-5 py-3 text-sm",children:a.nombre}),e.jsx("td",{className:"px-5 py-3 text-sm text-right font-mono",children:s(a.saldo_inicial)}),e.jsx("td",{className:"px-5 py-3 text-sm text-right font-mono",children:s(a.debe)}),e.jsx("td",{className:"px-5 py-3 text-sm text-right font-mono",children:s(a.haber)}),e.jsx("td",{className:"px-5 py-3 text-sm text-right font-mono font-semibold",children:s(a.saldo_final)})]},t))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-[#f9fafb] font-bold border-t-2 border-guinda/20",children:[e.jsx("td",{colSpan:2,className:"px-5 py-3.5 text-sm text-right",children:"TOTALES"}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:s(A.saldo_inicial)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:s(A.debe)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:s(A.haber)}),e.jsx("td",{className:"px-5 py-3.5 text-sm text-right font-mono",children:s(A.saldo_final)})]})})]})})}),i==="notas"&&e.jsxs("div",{className:"bg-white rounded-lg card-shadow p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:"Notas a los Estados Financieros"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Las notas a los estados financieros son parte integral de los mismos y proporcionan informacion adicional sobre las cifras presentadas en los estados financieros del ente publico."}),e.jsxs("div",{className:"bg-[#f9fafb] rounded-md p-4 text-sm text-text-secondary",children:[e.jsx("p",{children:"Las notas se generan como documento complementario. Incluyen:"}),e.jsxs("ul",{className:"list-disc ml-5 mt-2 space-y-1",children:[e.jsx("li",{children:"Notas de desglose"}),e.jsx("li",{children:"Notas de memoria (cuentas de orden)"}),e.jsx("li",{children:"Notas de gestion administrativa"})]})]})]})]}):e.jsx("div",{className:"bg-white rounded-lg card-shadow p-5",children:e.jsx("div",{className:"text-center py-16 text-text-muted text-sm",children:"Seleccione un periodo para ver los estados financieros"})})]})}export{re as default};
