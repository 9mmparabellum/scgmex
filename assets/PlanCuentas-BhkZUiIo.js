import{u as q,j as e}from"./index-CSPrBd4B.js";import{b as i}from"./vendor-DEA9Ikep.js";import{u as F,a as U,b as Y,c as Z,B as o}from"./Button-D3Vrtg19.js";import{b as J,T as K}from"./TreeView-DKIIh7Qc.js";import{M as Q}from"./Modal-B4ofYqvK.js";import{I as N}from"./Input-CNYH32IR.js";import{S}from"./Select-Ch7OX2yO.js";import{B as h}from"./Badge-BoxAYuIW.js";import{C as X}from"./ConfirmDialog-K7f1P5fT.js";import"./supabase-DANKYb0E.js";import"./export-t5FFX7R_.js";const T=[{value:"activo",label:"Activo"},{value:"pasivo",label:"Pasivo"},{value:"hacienda",label:"Hacienda Publica"},{value:"ingresos",label:"Ingresos"},{value:"gastos",label:"Gastos"},{value:"cierre",label:"Cierre Contable"},{value:"orden_contable",label:"Orden Contable"},{value:"orden_presupuestario",label:"Orden Presupuestario"}],H=[{value:"deudora",label:"Deudora"},{value:"acreedora",label:"Acreedora"}],v={1:"Genero",2:"Grupo",3:"Rubro",4:"Cuenta",5:"Subcuenta"},A={activo:"primary",pasivo:"danger",hacienda:"info",ingresos:"success",gastos:"warning",cierre:"default",orden_contable:"default",orden_presupuestario:"default"};function B(n){const s=T.find(d=>d.value===n);return s?s.label:n}function ee(n){const s=H.find(d=>d.value===n);return s?s.label:n}const C={codigo:"",nombre:"",nivel:1,tipo_cuenta:"",naturaleza:"",es_detalle:!1,activo:!0,padre_id:null};function me(){const{entePublico:n}=q(),{data:s=[],isLoading:d,isError:_}=F("plan_de_cuentas",{filter:{ente_id:n?.id}}),k=U("plan_de_cuentas"),y=Y("plan_de_cuentas"),w=Z("plan_de_cuentas"),[f,E]=i.useState(null),[P,c]=i.useState(!1),[g,j]=i.useState(!1),[$,b]=i.useState(!1),[r,p]=i.useState({...C}),z=i.useMemo(()=>J(s),[s]),a=i.useMemo(()=>f&&s.find(t=>t.id===f.id)||null,[s,f]),m=i.useMemo(()=>a?s.filter(t=>t.padre_id===a.id).length:0,[s,a]);function I(t){E(t)}function O(){p({...C,nivel:1,padre_id:null}),j(!1),c(!0)}function L(){a&&(a.nivel>=5||(p({...C,padre_id:a.id,nivel:a.nivel+1,tipo_cuenta:a.tipo_cuenta||"",naturaleza:a.naturaleza||"",codigo:a.codigo?a.codigo+".":""}),j(!1),c(!0)))}function G(){a&&(p({codigo:a.codigo||"",nombre:a.nombre||"",nivel:a.nivel||1,tipo_cuenta:a.tipo_cuenta||"",naturaleza:a.naturaleza||"",es_detalle:a.es_detalle||!1,activo:a.activo!==!1,padre_id:a.padre_id||null}),j(!0),c(!0))}function u(t,x){p(W=>({...W,[t]:x}))}async function D(){const t={...r,ente_id:n?.id};g&&a?await y.mutateAsync({id:a.id,...t}):await k.mutateAsync(t),c(!1)}async function R(){a&&(await w.mutateAsync(a.id),b(!1),E(null))}const M=k.isPending||y.isPending;function V(t){return e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"font-mono text-xs text-text-muted flex-shrink-0",children:t.codigo}),e.jsx("span",{className:"truncate",children:t.nombre}),t.tipo_cuenta&&e.jsx(h,{variant:A[t.tipo_cuenta]||"default",className:"flex-shrink-0 ml-auto",children:B(t.tipo_cuenta)})]})}return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Plan de Cuentas CONAC"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Art. 4, 37 — Ley General de Contabilidad Gubernamental"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:[s.length," cuenta",s.length!==1?"s":""," registrada",s.length!==1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"ghost",size:"sm",onClick:O,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nuevo Genero"]}),a&&a.nivel<5&&e.jsxs(o,{size:"sm",onClick:L,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nueva Cuenta Hija"]})]})]}),d&&e.jsxs("div",{className:"flex items-center justify-center py-16 text-text-muted text-sm",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cargando plan de cuentas..."]}),_&&e.jsx("div",{className:"bg-danger/5 border border-danger/30 rounded-lg p-4 text-sm text-danger",children:"Error al cargar el plan de cuentas. Verifique su conexion e intente de nuevo."}),!d&&!_&&e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-1/3 bg-white rounded-lg card-shadow p-4 max-h-[calc(100vh-240px)] overflow-y-auto",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-primary mb-3",children:"Estructura de Cuentas"}),z.length===0?e.jsxs("div",{className:"text-center py-12 text-text-muted text-sm",children:[e.jsx("svg",{className:"w-10 h-10 mx-auto mb-3 text-border",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"No hay cuentas registradas.",e.jsx("br",{}),"Cree un nuevo Genero para comenzar."]}):e.jsx(K,{data:z,renderNode:V,onSelect:I,selectedId:a?.id,searchable:!0})]}),e.jsx("div",{className:"w-2/3 bg-white rounded-lg card-shadow p-6 max-h-[calc(100vh-240px)] overflow-y-auto",children:a?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(h,{variant:A[a.tipo_cuenta]||"default",children:v[a.nivel]||`Nivel ${a.nivel}`}),a.es_detalle&&e.jsx(h,{variant:"success",children:"Detalle"}),a.activo===!1&&e.jsx(h,{variant:"danger",children:"Inactiva"})]}),e.jsxs("h2",{className:"text-lg font-bold text-text-primary",children:[a.codigo," — ",a.nombre]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(o,{variant:"ghost",size:"sm",onClick:G,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Editar"]}),a.nivel<5&&e.jsxs(o,{size:"sm",onClick:L,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Agregar Hija"]}),m===0&&e.jsxs(o,{variant:"danger",size:"sm",onClick:()=>b(!0),children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Eliminar"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Codigo",value:a.codigo}),e.jsx(l,{label:"Nombre",value:a.nombre}),e.jsx(l,{label:"Nivel",value:`${a.nivel} — ${v[a.nivel]||""}`}),e.jsx(l,{label:"Tipo de Cuenta",value:B(a.tipo_cuenta)}),e.jsx(l,{label:"Naturaleza",value:ee(a.naturaleza)}),e.jsx(l,{label:"Cuenta de Detalle",value:a.es_detalle?"Si":"No"}),e.jsx(l,{label:"Estado",value:a.activo!==!1?"Activa":"Inactiva"}),a.padre_id&&e.jsx(l,{label:"Cuenta Padre",value:(()=>{const t=s.find(x=>x.id===a.padre_id);return t?`${t.codigo} — ${t.nombre}`:a.padre_id})()})]}),m>0&&e.jsx("div",{className:"mt-6 pt-4 border-t border-border",children:e.jsxs("p",{className:"text-sm text-text-muted",children:["Esta cuenta tiene"," ",e.jsx("span",{className:"font-medium text-text-primary",children:m})," ","subcuenta",m!==1?"s":""," directa",m!==1?"s":"","."]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-text-muted",children:[e.jsx("svg",{className:"w-12 h-12 mb-3 text-border",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("p",{className:"text-sm",children:"Seleccione una cuenta del arbol para ver sus detalles."})]})})]}),e.jsx(Q,{open:P,onClose:()=>c(!1),title:g?"Editar Cuenta":"Nueva Cuenta",size:"lg",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),D()},className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg px-4 py-3 text-sm text-primary",children:["Nivel ",r.nivel," —"," ",e.jsx("span",{className:"font-medium",children:v[r.nivel]||`Nivel ${r.nivel}`}),r.padre_id&&e.jsxs("span",{className:"text-text-muted ml-2",children:["(Hija de"," ",(()=>{const t=s.find(x=>x.id===r.padre_id);return t?`${t.codigo} — ${t.nombre}`:r.padre_id})(),")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(N,{label:"Codigo *",value:r.codigo,onChange:t=>u("codigo",t.target.value),placeholder:"Ej. 1.1.3",required:!0}),e.jsx(N,{label:"Nombre *",value:r.nombre,onChange:t=>u("nombre",t.target.value),placeholder:"Nombre de la cuenta",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(N,{label:"Nivel",value:`${r.nivel} — ${v[r.nivel]||""}`,disabled:!0}),e.jsx(S,{label:"Tipo de Cuenta *",options:T,value:r.tipo_cuenta,onChange:t=>u("tipo_cuenta",t.target.value),placeholder:"Seleccione tipo",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(S,{label:"Naturaleza *",options:H,value:r.naturaleza,onChange:t=>u("naturaleza",t.target.value),placeholder:"Seleccione naturaleza",required:!0}),e.jsx("div",{})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-text-secondary",children:[e.jsx("input",{type:"checkbox",checked:r.es_detalle,onChange:t=>u("es_detalle",t.target.checked),className:"w-4 h-4 rounded border-border text-primary focus:ring-primary/30 cursor-pointer"}),"Cuenta de detalle (permite movimientos)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-text-secondary",children:[e.jsx("input",{type:"checkbox",checked:r.activo,onChange:t=>u("activo",t.target.checked),className:"w-4 h-4 rounded border-border text-primary focus:ring-primary/30 cursor-pointer"}),"Activa"]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[e.jsx(o,{variant:"ghost",onClick:()=>c(!1),disabled:M,children:"Cancelar"}),e.jsx(o,{type:"submit",loading:M,children:g?"Guardar Cambios":"Crear Cuenta"})]})]})}),e.jsx(X,{open:$,onClose:()=>b(!1),onConfirm:R,title:"Eliminar Cuenta",message:a?`Esta a punto de eliminar la cuenta "${a.codigo} — ${a.nombre}". Esta accion no se puede deshacer.`:"",confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger",loading:w.isPending})]})}function l({label:n,value:s}){return e.jsxs("div",{className:"py-2",children:[e.jsx("dt",{className:"text-xs font-medium text-text-muted mb-0.5",children:n}),e.jsx("dd",{className:"text-sm text-text-primary",children:s||"—"})]})}export{me as default};
